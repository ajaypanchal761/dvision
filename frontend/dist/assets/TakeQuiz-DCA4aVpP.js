import{u as $,q as L,a as _,r as o,s as h,j as e,c as I,T as Y,i as B,m as R,a7 as O,a5 as q}from"./index-BPKQ2keO.js";import{B as k}from"./BottomNav-KrGopomG.js";const H=()=>{const c=$(),{id:b}=L(),{user:n}=_(),[a,D]=o.useState(null),[l,g]=o.useState({}),[A,f]=o.useState(!0),[j,w]=o.useState(!1),[u,v]=o.useState(!1),[y,N]=o.useState(null);o.useEffect(()=>{Q(),C()},[b]);const C=async()=>{try{const t=await h.getSubmissionStatus(b);t.success&&t.data&&(v(t.data.hasSubmitted),N(t.data.submission))}catch(t){console.error("Error checking submission status:",t)}},Q=async()=>{try{f(!0);const t=await h.getQuizById(b);if(t.success&&t.data?.quiz){const s=t.data.quiz;let r=!1;if(s.type==="regular"||s.classNumber&&s.board){const p=n?.activeSubscriptions?.some(d=>d.plan?.type==="regular"&&d.plan?.board===n?.board&&d.plan?.classes?.includes(parseInt(n?.class))&&new Date(d.endDate)>new Date)||n?.subscription?.status==="active"&&n?.subscription?.plan?.type==="regular"&&n?.subscription?.plan?.board===n?.board&&n?.subscription?.plan?.classes?.includes(parseInt(n?.class))&&new Date(n.subscription.endDate)>new Date;s.classNumber===n?.class&&s.board===n?.board&&p&&(r=!0)}else if(s.type==="preparation"||s.classId){const p=s.classId?._id||s.classId;p&&n?.activeSubscriptions?.some(x=>{if(x.plan?.type!=="preparation"||!x.plan?.classId)return!1;const S=x.plan.classId._id||x.plan.classId;return S&&S.toString()===p.toString()&&new Date(x.endDate)>new Date})&&(r=!0)}if(!r){s.type==="preparation"||s.classId?alert("This quiz is not available. You need an active subscription for this preparation class."):alert("This quiz is not available for your class and board."),c("/quizzes");return}D(s);const i={};s.questions?.forEach((p,d)=>{i[d]=null}),g(i)}else alert("Quiz not found"),c("/quizzes")}catch(t){console.error("Error fetching quiz:",t),t.status===403||t.message?alert(t.message||"You do not have access to this quiz."):alert("Failed to load quiz. Please try again."),c("/quizzes")}finally{f(!1)}},F=(t,s)=>{g({...l,[t]:s})},P=t=>{if(!t)return null;const s=new Date(t),r=s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),i=s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return`${r} ${i}`},m=t=>{if(!t)return!1;const s=new Date,r=new Date(t);return s>=r},E=t=>{if(!t)return!1;const s=new Date,r=new Date(t),i=new Date(r.getTime()+6e4);return s>=i},T=async()=>{const t=a.questions?.filter((s,r)=>l[r]===null||l[r]===void 0);if(t.length>0){alert(`Please answer all questions before submitting. You have ${t.length} unanswered question(s).`);return}if(a.deadline&&m(a.deadline)){alert("The deadline for this quiz has passed. You cannot submit it.");return}try{w(!0);const s=Object.keys(l).map(i=>({questionIndex:parseInt(i),selectedOption:l[i]})),r=await h.submitQuiz(a._id,s);r.success&&(v(!0),N(r.data.submission),alert("Quiz submitted successfully!"))}catch(s){console.error("Error submitting quiz:",s),alert(s.message||"Failed to submit quiz. Please try again.")}finally{w(!1)}},z=a?.questions?.every((t,s)=>l[s]!==null&&l[s]!==void 0)||!1;return A?e.jsxs("div",{className:"min-h-screen bg-white flex items-center justify-center pb-20",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-[var(--app-dark-blue)] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-base font-medium",children:"Loading quiz..."})]}),e.jsx(k,{})]}):a?e.jsxs("div",{className:"min-h-screen bg-white pb-20",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 pt-3 sm:pt-4 md:pt-6 pb-4 sm:pb-5 md:pb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>c("/quizzes"),className:"p-1.5 sm:p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(I,{className:"text-lg sm:text-xl md:text-2xl"})}),e.jsx("h1",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold",children:a.name})]}),!u&&e.jsx("button",{onClick:()=>c("/quizzes"),className:"p-1.5 sm:p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Y,{className:"text-lg sm:text-xl md:text-2xl"})})]})})}),e.jsxs("main",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 md:py-5",children:[e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl shadow-md p-3 sm:p-4 md:p-5 mb-3 sm:mb-4 border border-gray-200",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 text-xs sm:text-sm mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-[var(--app-dark-blue)]/10 rounded-lg",children:e.jsx(B,{className:"text-[var(--app-dark-blue)] text-sm"})}),e.jsxs("span",{className:"text-gray-700 font-medium",children:[a.questions?.length||0," Questions"]})]}),a.deadline&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(R,{className:`text-sm ${m(a.deadline)?"text-red-500":"text-[var(--app-dark-blue)]"}`}),e.jsxs("span",{className:m(a.deadline)?"text-red-600 font-bold":"text-gray-700 font-medium",children:["Deadline: ",P(a.deadline),m(a.deadline)&&" (Expired)"]})]})]}),u&&a&&E(a.deadline)&&e.jsx("div",{className:"pt-2 sm:pt-3 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>c(`/quiz-results/${b}`),className:"w-full bg-[var(--app-dark-blue)] hover:bg-[var(--app-dark-blue)]/90 text-white font-bold py-2 sm:py-2.5 px-3 sm:px-4 rounded-lg sm:rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg text-sm sm:text-base",children:[e.jsx(O,{className:"text-base sm:text-lg"}),e.jsx("span",{children:"View Results"})]})})]}),u&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-500 rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5 mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-1.5 sm:mb-2",children:[e.jsx(q,{className:"text-blue-600 text-lg sm:text-xl"}),e.jsx("h3",{className:"text-sm sm:text-base md:text-lg font-bold text-blue-800",children:"Quiz Already Submitted"})]}),y&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-blue-600 text-xs sm:text-sm font-medium",children:["Submitted on: ",new Date(y.submittedAt).toLocaleString()]})}),e.jsx("p",{className:"text-blue-700 mt-2 text-xs sm:text-sm font-medium",children:"You cannot submit this quiz again."})]}),!u&&e.jsx("div",{className:"space-y-3 sm:space-y-4",children:a.questions?.map((t,s)=>e.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl shadow-md p-3 sm:p-4 md:p-5 border border-gray-200",children:[e.jsxs("div",{className:"mb-2 sm:mb-3",children:[e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-800 mb-1.5 sm:mb-2",children:["Question ",s+1]}),e.jsx("p",{className:"text-gray-800 text-sm sm:text-base leading-relaxed",children:t.question})]}),e.jsx("div",{className:"space-y-2 sm:space-y-2.5",children:t.options?.map((r,i)=>e.jsxs("label",{className:`flex items-center gap-2 sm:gap-3 p-2.5 sm:p-3 rounded-lg sm:rounded-xl border-2 cursor-pointer transition-all ${l[s]===i?"border-[var(--app-dark-blue)] bg-blue-50 shadow-md":"border-gray-200 hover:border-[var(--app-dark-blue)]/30"}`,children:[e.jsx("input",{type:"radio",name:`question-${s}`,checked:l[s]===i,onChange:()=>F(s,i),className:"w-4 h-4 sm:w-5 sm:h-5 text-[var(--app-dark-blue)] focus:ring-[var(--app-dark-blue)] cursor-pointer"}),e.jsxs("span",{className:"flex-1 text-gray-800 font-medium text-sm sm:text-base",children:[String.fromCharCode(65+i),". ",r]})]},i))})]},s))}),!u&&e.jsxs("div",{className:"mt-4 sm:mt-5 md:mt-6 bg-white rounded-lg sm:rounded-xl shadow-md p-3 sm:p-4 md:p-5 border border-gray-200",children:[e.jsx("button",{onClick:T,disabled:j||!z||a.deadline&&m(a.deadline),className:"w-full bg-[var(--app-dark-blue)] hover:bg-[var(--app-dark-blue)]/90 text-white font-bold py-2.5 sm:py-3 px-4 sm:px-5 rounded-lg sm:rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg text-sm sm:text-base",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b-2 border-white"}),e.jsx("span",{children:"Submitting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"text-base sm:text-lg"}),e.jsx("span",{children:"Submit Quiz"})]})}),!z&&e.jsx("p",{className:"text-orange-600 text-xs sm:text-sm text-center mt-2 font-medium",children:"Please answer all questions to submit"}),a.deadline&&m(a.deadline)&&e.jsx("p",{className:"text-red-600 text-xs sm:text-sm text-center mt-2 font-medium",children:"This quiz deadline has passed"})]})]}),e.jsx(k,{})]}):null};export{H as default};
