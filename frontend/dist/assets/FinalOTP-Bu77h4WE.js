import{at as A,au as C,av as E,aw as D,u as Q,r as i,ay as m,j as t}from"./index-BPKQ2keO.js";import{t as u,a as f}from"./api-CVReUq8b.js";import{I as Z}from"./Image-B_ouKXn_.js";const R={apiKey:"AIzaSyBkanF8TuSNJWYZFHWd4zjlhJrr_N-_878",authDomain:"dvision-academy.firebaseapp.com",projectId:"dvision-academy",storageBucket:"dvision-academy.firebasestorage.app",messagingSenderId:"195388337660",appId:"1:195388337660:web:67f24b5c689a05755d5679"},z=D(R);let g=null;const B="BBM4rFMYzjANGeXwTEb7pAracML52yB8_63VC9TWy5Lq2P6waPNMCg7zY5WQIg198iXnat6HOx-mSKdjjXkae1A",y=()=>{if(typeof window<"u"&&"serviceWorker"in navigator){if(!g)try{g=E(z)}catch(e){console.error("Error initializing Firebase Messaging:",e)}return g}return null},N=async()=>{try{if(!("Notification"in window))return console.warn("This browser does not support notifications"),null;if(await Notification.requestPermission()==="granted"){console.log("Notification permission granted");const s=y();if(!s)return console.warn("Firebase Messaging not available"),null;try{const a=await A(s,{vapidKey:B});return a?(console.log("FCM Token:",a),a):(console.warn("No FCM token available"),null)}catch(a){return console.error("Error getting FCM token:",a),null}}else return console.warn("Notification permission denied"),null}catch(e){return console.error("Error requesting notification permission:",e),null}},k=()=>new Promise(e=>{const s=y();s&&C(s,a=>{console.log("Message received in foreground:",a),e(a)})}),j=async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/firebase-messaging-sw.js");return console.log("Service Worker registered:",e),e}catch(e){return console.error("Service Worker registration failed:",e),null}return null},W=async()=>{try{await j();const e=await N();return e?(await T(e),e):null}catch(e){return console.error("Error initializing notifications:",e),null}},T=async e=>{try{if(!localStorage.getItem("dvision_teacher_token")){console.warn("User not logged in. FCM token will be saved after login."),localStorage.setItem("pending_fcm_token",e);return}await u.updateFcmToken(e,"web"),console.log("FCM token saved to backend"),localStorage.removeItem("pending_fcm_token")}catch(s){console.error("Error saving FCM token to backend:",s)}},V=async()=>{const e=localStorage.getItem("pending_fcm_token");e&&await T(e)},K=()=>{k().then(e=>{if(console.log("Foreground message received:",e),"Notification"in window&&Notification.permission==="granted"){const s=new Notification(e.notification?.title||"Dvision Academy",{body:e.notification?.body||"",icon:"/icon-192x192.png",badge:"/badge-72x72.png",data:e.data||{},tag:e.data?.tag||"default"});s.onclick=a=>{a.preventDefault();const l=e.data?.url||"/";window.open(l,"_blank"),s.close()}}}).catch(e=>{console.error("Error in foreground message listener:",e)})},q="dvision_agent_token",x="pending_agent_fcm_token",Y=async()=>{try{await j();const e=await N();return e?(await L(e),e):null}catch(e){return console.error("Error initializing agent notifications:",e),null}},L=async e=>{try{if(!localStorage.getItem(q)){console.warn("Agent not logged in. FCM token will be saved after login."),localStorage.setItem(x,e);return}if(!e){console.warn("No FCM token provided for agent");return}await f.updateFcmToken(e,"web"),console.log("Agent FCM token saved to backend"),localStorage.removeItem(x)}catch(s){console.error("Error saving agent FCM token to backend:",s)}},G=async()=>{const e=localStorage.getItem(x);e&&await L(e)},H=()=>{k().then(e=>{if(console.log("Agent foreground message received:",e),"Notification"in window&&Notification.permission==="granted"){const s=new Notification(e.notification?.title||"Dvision Academy",{body:e.notification?.body||"",icon:"/icon-192x192.png",badge:"/badge-72x72.png",data:e.data||{},tag:e.data?.tag||"default"});s.onclick=a=>{a.preventDefault();const l=e.data?.url||"/";window.open(l,"_blank"),s.close()}}}).catch(e=>{console.error("Error in agent foreground message listener:",e)})},$=()=>{const e=Q(),[s,a]=i.useState(""),[l,p]=i.useState(!1),[h,b]=i.useState(!1),[v,r]=i.useState(""),[c,M]=i.useState(""),[w,I]=i.useState("teacher"),d=i.useRef(null);i.useEffect(()=>{const o=sessionStorage.getItem("login_phone"),n=sessionStorage.getItem("login_mode")||"teacher";if(o)M(o),I(n);else{e(m.LOGIN);return}d.current&&d.current.focus()},[e]);const S=o=>{const n=o.target.value.replace(/\D/g,"").slice(0,6);a(n),r("")},_=o=>{o.preventDefault();const n=o.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);a(n)},P=async o=>{if(o.preventDefault(),s.length!==6){r("Please enter complete 6-digit OTP");return}p(!0),r("");try{let n;w==="agent"?(n=await f.verifyOTP(c,s),n.success&&n.data?(n.data.token&&localStorage.setItem("dvision_agent_token",n.data.token),localStorage.setItem("user_role","agent"),localStorage.setItem("agent_data",JSON.stringify(n.data.agent)),sessionStorage.removeItem("login_phone"),sessionStorage.removeItem("login_mode"),Y(),H(),G(),e(m.AGENT_DASHBOARD)):r(n.message||"Invalid OTP. Please try again.")):(n=await u.verifyOTP(c,s),n.success&&n.data?(n.data.token&&localStorage.setItem("dvision_teacher_token",n.data.token),localStorage.setItem("user_role","teacher"),sessionStorage.removeItem("login_phone"),sessionStorage.removeItem("login_mode"),W(),K(),V(),e(m.DASHBOARD)):r(n.message||"Invalid OTP. Please try again."))}catch(n){r(n.message||"Something went wrong. Please try again.")}finally{p(!1)}},F=async()=>{b(!0),r("");try{let o;w==="agent"?o=await f.sendOTP(c):o=await u.resendOTP(c),o.success?(alert("OTP resent successfully!"),a(""),d.current&&d.current.focus()):r(o.message||"Failed to resend OTP")}catch(o){r(o.message||"Failed to resend OTP")}finally{b(!1)}},O=s.length===6;return t.jsxs("div",{className:"min-h-screen w-full bg-white flex flex-col",children:[t.jsxs("div",{className:"bg-[var(--app-dark-blue)] text-white h-24 sm:h-28 md:h-32 relative overflow-hidden",style:{borderBottomRightRadius:"200px"},children:[t.jsx("div",{className:"absolute bottom-0 left-0 w-full h-12 sm:h-14 md:h-16 overflow-hidden",children:t.jsxs("svg",{className:"absolute bottom-0 w-full h-full",viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:[t.jsx("path",{d:"M0,60 Q300,20 600,60 T1200,60 L1200,120 L0,120 Z",fill:"rgba(255,255,255,0.1)",children:t.jsx("animate",{attributeName:"d",values:"M0,60 Q300,20 600,60 T1200,60 L1200,120 L0,120 Z;M0,60 Q300,40 600,60 T1200,60 L1200,120 L0,120 Z;M0,60 Q300,20 600,60 T1200,60 L1200,120 L0,120 Z",dur:"3s",repeatCount:"indefinite"})}),t.jsx("path",{d:"M0,80 Q300,40 600,80 T1200,80 L1200,120 L0,120 Z",fill:"rgba(255,255,255,0.05)",children:t.jsx("animate",{attributeName:"d",values:"M0,80 Q300,40 600,80 T1200,80 L1200,120 L0,120 Z;M0,80 Q300,60 600,80 T1200,80 L1200,120 L0,120 Z;M0,80 Q300,40 600,80 T1200,80 L1200,120 L0,120 Z",dur:"4s",repeatCount:"indefinite"})})]})}),t.jsx("div",{className:"absolute top-3 right-6 w-16 h-16 sm:w-20 sm:h-20 bg-white/10 rounded-full blur-xl"}),t.jsx("div",{className:"absolute top-8 right-16 w-12 h-12 sm:w-16 sm:h-16 bg-white/5 rounded-full blur-lg"}),t.jsx("div",{className:"absolute bottom-6 left-10 w-20 h-20 sm:w-24 sm:h-24 bg-white/10 rounded-full blur-xl"}),t.jsx("div",{className:"pt-5 sm:pt-6 md:pt-8 px-4 sm:px-6 md:px-8 relative z-10",children:t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[t.jsx("button",{onClick:()=>e(-1),className:"p-1.5 sm:p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:t.jsx("span",{className:"text-lg sm:text-xl md:text-2xl font-extrabold",children:"‚Üê"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs sm:text-sm md:text-base text-white/90 mb-0.5 sm:mb-1",children:"Verification"}),t.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-white",children:"Verify OTP"})]})]})})]}),t.jsxs("div",{className:"flex-1 px-4 sm:px-6 md:px-8 py-4 sm:py-6 md:py-8 flex items-center justify-center relative overflow-hidden",children:[t.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[t.jsx("div",{className:"absolute top-1/4 left-1/4 w-48 h-48 sm:w-64 sm:h-64 bg-[var(--app-dark-blue)]/5 rounded-full blur-3xl"}),t.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-60 h-60 sm:w-80 sm:h-80 bg-[var(--app-teal)]/5 rounded-full blur-3xl"}),t.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-72 h-72 sm:w-96 sm:h-96 bg-[var(--app-dark-blue)]/3 rounded-full blur-3xl"})]}),t.jsxs("div",{className:"w-full max-w-sm sm:max-w-md relative z-10",children:[t.jsx("div",{className:"mb-4 sm:mb-5 md:mb-6 flex justify-center",children:t.jsx(Z,{src:"/dvisionteacher.png",alt:"D'Vision Academy Logo",className:"h-28 sm:h-32 md:h-36 lg:h-40 w-auto object-contain"})}),t.jsx("div",{className:"text-center mb-4 sm:mb-5 md:mb-6",children:t.jsxs("p",{className:"text-black/80 text-xs sm:text-sm md:text-base mb-2",children:["Enter the 6-digit code sent to ",c?c.replace(/\d(?=\d{4})/g,"*"):"your mobile number"]})}),t.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl md:rounded-3xl p-3 sm:p-4 md:p-5 lg:p-6 shadow-2xl border border-gray-200",children:t.jsxs("form",{onSubmit:P,className:"space-y-3 sm:space-y-4 md:space-y-5",children:[v&&t.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-2 sm:px-3 md:px-4 py-1.5 sm:py-2 md:py-2.5 rounded-lg sm:rounded-xl text-[10px] sm:text-xs md:text-sm",children:v}),t.jsx("div",{children:t.jsx("input",{ref:d,type:"tel",inputMode:"numeric",maxLength:6,value:s,onChange:S,onPaste:_,placeholder:"Enter 6-digit OTP",className:"w-full px-2 sm:px-3 md:px-4 py-2 sm:py-2.5 md:py-3 rounded-lg sm:rounded-xl border-0 bg-gray-50 focus:outline-none focus:bg-white transition-all text-base sm:text-lg md:text-xl lg:text-2xl font-semibold text-[var(--app-black)] placeholder:text-gray-400 text-center tracking-wider",required:!0})}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1 sm:mb-1.5",children:"Didn't receive the code?"}),t.jsx("button",{type:"button",onClick:F,disabled:h,className:"text-[var(--app-dark-blue)] font-semibold text-xs sm:text-sm hover:underline disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Resending...":"Resend OTP"})]}),t.jsx("button",{type:"submit",disabled:!O||l,className:"w-full bg-[var(--app-dark-blue)] text-white py-3 sm:py-4 md:py-4.5 rounded-lg sm:rounded-xl font-semibold text-xs sm:text-sm md:text-base hover:opacity-90 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Verifying...":"Verify & Login"})]})})]})]}),t.jsxs("div",{className:"bg-[var(--app-dark-blue)] h-16 sm:h-20 md:h-24 relative mt-auto overflow-hidden",style:{borderTopLeftRadius:"300px"},children:[t.jsx("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden",children:t.jsxs("svg",{className:"absolute top-0 w-full h-full",viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:[t.jsx("path",{d:"M0,40 Q300,80 600,40 T1200,40 L1200,0 L0,0 Z",fill:"rgba(255,255,255,0.1)",children:t.jsx("animate",{attributeName:"d",values:"M0,40 Q300,80 600,40 T1200,40 L1200,0 L0,0 Z;M0,40 Q300,60 600,40 T1200,40 L1200,0 L0,0 Z;M0,40 Q300,80 600,40 T1200,40 L1200,0 L0,0 Z",dur:"3s",repeatCount:"indefinite"})}),t.jsx("path",{d:"M0,20 Q300,60 600,20 T1200,20 L1200,0 L0,0 Z",fill:"rgba(255,255,255,0.05)",children:t.jsx("animate",{attributeName:"d",values:"M0,20 Q300,60 600,20 T1200,20 L1200,0 L0,0 Z;M0,20 Q300,40 600,20 T1200,20 L1200,0 L0,0 Z;M0,20 Q300,60 600,20 T1200,20 L1200,0 L0,0 Z",dur:"4s",repeatCount:"indefinite"})})]})}),t.jsx("div",{className:"absolute bottom-3 left-6 w-16 h-16 sm:w-20 sm:h-20 bg-white/10 rounded-full blur-xl"}),t.jsx("div",{className:"absolute bottom-8 left-16 w-12 h-12 sm:w-16 sm:h-16 bg-white/5 rounded-full blur-lg"}),t.jsx("div",{className:"absolute top-6 right-10 w-20 h-20 sm:w-24 sm:h-24 bg-white/10 rounded-full blur-xl"})]})]})};export{$ as default};
