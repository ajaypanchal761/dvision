import{u as G,r as d,j as e,c as K,a2 as H,l as u,S as Z,T as I,i as p,aB as N,m as h,h as C,D as ee}from"./index-BPKQ2keO.js";import{B as te}from"./BottomNav-BGePCkyK.js";import{l as O,c as se}from"./api-CVReUq8b.js";const ce=()=>{const o=G(),[m,B]=d.useState([]),[D,$]=d.useState([]),[Y,E]=d.useState(!0),[L,g]=d.useState(""),[b,F]=d.useState(""),[n,_]=d.useState(null),[M,f]=d.useState(!1);d.useEffect(()=>{v()},[n]),d.useEffect(()=>{const t=setTimeout(()=>{v()},500);return()=>clearTimeout(t)},[b]),d.useEffect(()=>{const t=()=>{document.visibilityState==="visible"&&v()};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[]);const v=async()=>{try{if(E(!0),g(""),!localStorage.getItem("dvision_teacher_token")){g("Please login as a teacher to access this page"),o("/teacher/login");return}let s=null;if(n)if(typeof n=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(n))s=n;else{const a=new Date(n),l=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0");s=`${l}-${r}-${c}`}else{const a=new Date,l=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0");s=`${l}-${r}-${c}`}try{const a=await O.getMyLiveClasses(s,b||null,null);a.success&&a.data?.liveClasses&&B(a.data.liveClasses)}catch(a){if(a.message?.includes("not authorized")||a.message?.includes("role")){console.error("Authorization error:",a),g("You are not authorized to access this page. Please login as a teacher."),localStorage.removeItem("dvision_token"),setTimeout(()=>{o("/teacher/login")},2e3);return}throw a}if(!n||s===j()){const a=new Date,l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a.getDay()];try{const r=await se.getMySchedule(l);if(r.success&&r.data?.timetables){const c=r.data.timetables||[],x=`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`,W=c.filter(U=>{const[X,q]=U.endTime.split(":").map(Number);return`${String(X).padStart(2,"0")}:${String(q).padStart(2,"0")}`>=x});$(W)}}catch(r){if(r.message?.includes("not authorized")||r.message?.includes("role"))console.warn("Could not fetch schedule:",r);else throw r}}else $([])}catch(t){console.error("Error fetching data:",t),!t.message?.includes("not authorized")&&!t.message?.includes("role")&&g(t.message||"Failed to load classes")}finally{E(!1)}},j=()=>{const t=new Date,s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${l}`},P=t=>{const s=t.target.value;_(s)},R=()=>{_(null)},V=()=>{if(!n)return"Today";const t=n.split("-");return t.length===3?new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2])).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):n},z=t=>{if(!t)return"N/A";const[s,a]=t.split(":"),l=parseInt(s),r=l>=12?"PM":"AM";return`${l%12||12}:${a} ${r}`},i=t=>{if(!t)return{date:"N/A",time:"N/A"};const s=new Date(t),a=s.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),l=s.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",hour12:!0});return{date:a,time:l}},A=()=>{o("/teacher/create-live-class")},J=async t=>{try{(await O.startLiveClass(t)).success&&o(`/teacher/live-class/${t}`)}catch(s){alert(s.message||"Failed to start class")}},Q=t=>{o(`/teacher/live-class/${t}`)},y=t=>{const s={scheduled:"bg-yellow-100 text-yellow-700",live:"bg-green-100 text-green-700",ended:"bg-gray-100 text-gray-700",cancelled:"bg-red-100 text-red-700"};return s[t]||s.scheduled},w=m.filter(t=>t.status==="live"),S=m.filter(t=>t.status==="scheduled"),T=m.filter(t=>t.status==="ended"),k=m.filter(t=>t.status==="cancelled");return e.jsxs("div",{className:"min-h-screen bg-white pb-20 sm:pb-24 relative",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-4 sm:px-6 pt-3 sm:pt-4 pb-4 sm:pb-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>o(-1),className:"p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(K,{className:"text-lg sm:text-xl"})}),e.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl font-bold",children:"My Classes"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:A,className:"p-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-colors flex items-center gap-1.5 backdrop-blur-sm",title:"Create Live Class",children:[e.jsx(H,{className:"text-base sm:text-lg"}),e.jsx("span",{className:"hidden sm:inline text-xs sm:text-sm font-medium",children:"Create"})]}),e.jsxs("button",{onClick:()=>o("/teacher/schedule"),className:"p-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-colors flex items-center gap-1.5 backdrop-blur-sm",title:"View Schedule",children:[e.jsx(u,{className:"text-base sm:text-lg"}),e.jsx("span",{className:"hidden sm:inline text-xs sm:text-sm font-medium",children:"Schedule"})]})]})]})})}),e.jsxs("main",{className:"px-4 sm:px-6 py-4 sm:py-5",children:[e.jsxs("div",{className:"mb-4 relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg z-10"}),e.jsx("input",{type:"text",placeholder:"Search by name, subject, or date...",value:b,onChange:t=>F(t.target.value),className:"w-full pl-10 pr-12 py-2.5 sm:py-3 border border-gray-300 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--app-dark-blue)] text-sm sm:text-base"}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[b&&e.jsx("button",{onClick:()=>F(""),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(I,{className:"text-lg"})}),e.jsx("button",{onClick:()=>f(!M),className:"text-gray-400 hover:text-gray-600 transition-colors",title:n?`Selected: ${V()}`:"Select Date",children:e.jsx(u,{className:"text-lg"})})]})]}),e.jsx("input",{type:"date",value:n||j(),onChange:P,className:"hidden",id:"date-picker-hidden"}),M&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-lg border border-gray-200 p-4 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Select Date:"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(I,{className:"text-lg"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:n||j(),onChange:t=>{P(t),f(!1)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--app-dark-blue)] text-sm"}),n&&e.jsx("button",{onClick:()=>{R(),f(!1)},className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors",children:"Today"})]})]})]}),L&&e.jsx("div",{className:"mb-4 bg-red-50 border-2 border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:L}),Y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--app-dark-blue)]"})}):e.jsxs(e.Fragment,{children:[m.length>0&&e.jsxs("div",{className:"space-y-4 sm:space-y-5 mb-6",children:[w.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Live Now (",w.length,")"]}),w.map(t=>{const s=new Date(t.scheduledStartTime),{date:a,time:l}=i(s.toISOString());let r=null;if(t.scheduledEndTime){const c=new Date(t.scheduledEndTime),{time:x}=i(c.toISOString());r=x}return e.jsxs("div",{className:"bg-white border-2 border-green-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-base text-gray-800 mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-xs text-gray-600",children:[t.subjectId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"text-[var(--app-dark-blue)]"}),t.subjectId.name]}),t.classId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"text-[var(--app-dark-blue)]"}),t.classId.type==="regular"?`Class ${t.classId.class} - ${t.classId.board}`:t.classId.name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"text-[var(--app-dark-blue)]"}),a]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"text-[var(--app-dark-blue)]"}),l,r?` - ${r}`:""]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${y(t.status)}`,children:t.status})]}),e.jsxs("button",{onClick:()=>Q(t._id),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg font-semibold text-sm flex items-center justify-center gap-2 hover:bg-green-700",children:[e.jsx(C,{className:"text-base"}),"Join Class"]})]},t._id)})]}),S.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(h,{className:"text-[var(--app-dark-blue)]"}),"Starts Soon (",S.length,")"]}),S.map(t=>{const s=new Date(t.scheduledStartTime),{date:a,time:l}=i(s.toISOString());let r=null;if(t.scheduledEndTime){const c=new Date(t.scheduledEndTime),{time:x}=i(c.toISOString());r=x}return e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-base text-gray-800 mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-xs text-gray-600",children:[t.subjectId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"text-[var(--app-dark-blue)]"}),t.subjectId.name]}),t.classId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"text-[var(--app-dark-blue)]"}),t.classId.type==="regular"?`Class ${t.classId.class} - ${t.classId.board}`:t.classId.name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"text-[var(--app-dark-blue)]"}),a]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"text-[var(--app-dark-blue)]"}),l,r?` - ${r}`:""]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${y(t.status)}`,children:t.status})]}),e.jsxs("button",{onClick:()=>J(t._id),className:"w-full bg-[var(--app-dark-blue)] text-white px-4 py-2 rounded-lg font-semibold text-sm flex items-center justify-center gap-2 hover:bg-[var(--app-dark-blue)]/90",children:[e.jsx(ee,{className:"text-base"}),"Start Class"]})]},t._id)})]}),T.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(h,{className:"text-gray-500"}),"Ended (",T.length,")"]}),T.map(t=>{const s=new Date(t.scheduledStartTime),{date:a,time:l}=i(s.toISOString()),r=t.actualStartTime?i(t.actualStartTime):null,c=t.endTime?i(t.endTime):null;return e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-all opacity-75",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-base text-gray-800 mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-xs text-gray-600 mb-2",children:[t.subjectId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"text-[var(--app-dark-blue)]"}),t.subjectId.name]}),t.classId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"text-[var(--app-dark-blue)]"}),t.classId.type==="regular"?`Class ${t.classId.class} - ${t.classId.board}`:t.classId.name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"text-[var(--app-dark-blue)]"}),a]})]}),r&&e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[e.jsx("span",{className:"font-medium",children:"Started:"})," ",r.date," at ",r.time]}),c&&e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Ended:"})," ",c.date," at ",c.time]}),!r&&!c&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Scheduled: ",a," at ",l]})]}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${y(t.status)}`,children:t.status})]})},t._id)})]}),k.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(I,{className:"text-red-500"}),"Cancelled (",k.length,")"]}),k.map(t=>{const s=new Date(t.scheduledStartTime),{date:a,time:l}=i(s.toISOString());let r=null;if(t.scheduledEndTime){const c=new Date(t.scheduledEndTime),{time:x}=i(c.toISOString());r=x}return e.jsx("div",{className:"bg-white border-2 border-red-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-all opacity-75",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-base text-gray-800 mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-xs text-gray-600",children:[t.subjectId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"text-[var(--app-dark-blue)]"}),t.subjectId.name]}),t.classId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"text-[var(--app-dark-blue)]"}),t.classId.type==="regular"?`Class ${t.classId.class} - ${t.classId.board}`:t.classId.name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"text-[var(--app-dark-blue)]"}),a]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"text-[var(--app-dark-blue)]"}),l,r?` - ${r}`:""]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${y(t.status)}`,children:t.status})]})},t._id)})]})]}),D.length>0&&(!n||n===j())&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-3",children:"Today's Classes"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"These are your scheduled classes for today from timetable. You can create live classes anytime using the Create button above."}),e.jsx("div",{className:"space-y-3",children:D.map(t=>{const s=m.find(a=>a.timetableId?._id===t._id||a.timetableId===t._id);return e.jsx("div",{className:"bg-gray-50 border-2 border-gray-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-base text-gray-800 mb-1",children:t.topic||`${t.subjectId?.name||"Class"}`}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"text-[var(--app-dark-blue)]"}),t.subjectId?.name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"text-[var(--app-dark-blue)]"}),z(t.startTime)," - ",z(t.endTime)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"text-[var(--app-dark-blue)]"}),t.dayOfWeek]})]})]}),s&&e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-semibold bg-green-100 text-green-700",children:"Live Class Created"})]})},t._id)})})]}),m.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-[var(--app-dark-blue)]/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(h,{className:"text-[var(--app-dark-blue)] text-3xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-800 mb-1.5 text-center",children:(()=>{if(!n)return"No live classes today";const t=new Date(n),s=new Date;return s.setHours(0,0,0,0),t.setHours(0,0,0,0),t<s?"No live classes on this date":t>s?"No live classes scheduled":"No live classes today"})()}),e.jsx("p",{className:"text-gray-500 text-center max-w-md text-xs sm:text-sm mb-4",children:(()=>{if(!n)return"Create a live class to get started";const t=new Date(n),s=new Date;return s.setHours(0,0,0,0),t.setHours(0,0,0,0),t<s?"There were no live classes scheduled for this date":t>s?"Check back later for upcoming classes":"Create a live class to get started"})()}),e.jsxs("button",{onClick:A,className:"bg-[var(--app-dark-blue)] text-white px-6 py-2 rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-[var(--app-dark-blue)]/90",children:[e.jsx(H,{className:"text-base"}),"Create Live Class"]})]})]})]}),e.jsx(te,{})]})};export{ce as default};
