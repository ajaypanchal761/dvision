import{u as P,b as S,a as I,r as n,j as e,am as R,a5 as _,R as g,an as A,H as C}from"./index-BPKQ2keO.js";const k=()=>{const o=P(),[t]=S(),{getCurrentUser:x}=I(),[c,r]=n.useState("verifying"),[d,a]=n.useState("Verifying your payment..."),[f,i]=n.useState(""),[l,h]=n.useState(0),p=3;n.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("payment_order_id");localStorage.removeItem("payment_in_progress"),localStorage.removeItem("payment_order_id"),localStorage.removeItem("payment_timestamp"),console.log("Cleared payment flags from localStorage");const m=t.get("order_id")||s;if(!m){r("failed"),a("Payment verification failed"),i("Order ID not found in payment response");return}const b=t.get("reference_id")||t.get("payment_id")||t.get("referenceId"),v=t.get("payment_signature")||t.get("signature"),j=t.get("tx_status")||t.get("txStatus"),u=t.get("order_amount")||t.get("orderAmount");console.log("Payment return params:",{orderId:m,referenceId:b,paymentSignature:v,txStatus:j,orderAmount:u,timestamp:new Date().toISOString()}),r("verifying"),a("Verifying your payment...");const y=await C.verifyPayment(m,b||void 0,v||void 0,j||void 0,u?parseFloat(u):void 0);if(console.log("Payment verification response:",y),y.success){r("success"),a("Payment successful! Your subscription has been activated.");try{await x(),console.log("User data refreshed after payment")}catch(w){console.error("Error refreshing user data:",w)}setTimeout(()=>{o(g.DASHBOARD)},3e3)}else r("failed"),a("Payment verification failed"),i(y.message||"Unable to verify payment. Please contact support.")}catch(s){if(console.error("Payment verification error:",s),l<p&&s.message.includes("Network error")){a(`Retrying payment verification (${l+1}/${p})...`),h(l+1),setTimeout(()=>{window.location.reload()},2e3);return}r("failed"),a("Payment verification failed"),i(s.message||"An error occurred while verifying your payment. Please contact support.")}})()},[t,o,x,l]);const N=()=>{r("verifying"),a("Verifying your payment..."),i(""),h(0),window.location.reload()};return e.jsx("div",{className:"min-h-screen w-full bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-6 sm:p-8 text-center",children:[c==="verifying"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"relative",children:e.jsx(R,{className:"text-6xl text-blue-600 animate-spin"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Verifying Payment"}),e.jsx("p",{className:"text-gray-600",children:d}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Please do not close this page or refresh. It may take a few seconds..."})]}),c==="success"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-green-200 rounded-full animate-ping opacity-75"}),e.jsx(_,{className:"relative text-6xl text-green-600"})]})}),e.jsx("h2",{className:"text-2xl font-bold text-green-600 mb-2",children:"Payment Successful!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:d}),e.jsx("p",{className:"text-sm text-gray-500",children:"Redirecting to dashboard..."}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>o(g.DASHBOARD),className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all duration-200",children:"Go to Dashboard"})})]}),c==="failed"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(A,{className:"text-6xl text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-2",children:"Payment Failed"}),e.jsx("p",{className:"text-gray-600 mb-2",children:d}),f&&e.jsx("p",{className:"text-sm text-red-600 mb-4 bg-red-50 p-3 rounded-lg",children:f}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("button",{onClick:N,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all duration-200",children:"Retry Payment"}),e.jsx("button",{onClick:()=>o(g.SUBSCRIPTION_PLANS),className:"w-full border-2 border-gray-300 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-50 transition-all duration-200",children:"Back to Plans"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Note: The payment gateway server has been notified. Your subscription will be activated automatically if payment was successful."})]})]})})};export{k as default};
