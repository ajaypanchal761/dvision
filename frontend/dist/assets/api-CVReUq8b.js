const g=()=>{{const t="http://localhost:5000/api".replace(/\/$/,"");return console.log("[Teacher API] Using VITE_API_BASE_URL from env:",t),t}},y=g();console.log("[Teacher API] Final API_BASE_URL:",y);const T=()=>localStorage.getItem("user_role")==="agent"?localStorage.getItem("dvision_agent_token"):localStorage.getItem("dvision_teacher_token"),s=async(e,t={})=>{const o=T(),a=t.body instanceof FormData,c={...t,headers:{...a?{}:{"Content-Type":"application/json"},Accept:"application/json",...o&&{Authorization:`Bearer ${o}`},...t.headers},credentials:"include"};t.body&&typeof t.body=="object"&&!a?c.body=JSON.stringify(t.body):t.body&&(c.body=t.body);const n=`${y}${e}`,d=t.method||"GET";try{console.log(`[Teacher API] ${d} Request:`,{endpoint:e,fullUrl:n,hasToken:!!o,hasBody:!!t.body,isFormData:a,hasSignal:!!t.signal}),t.body&&typeof t.body=="object"&&!a&&console.log("[Teacher API] Request Body:",t.body),t.signal&&(c.signal=t.signal),console.log("[Teacher API] Sending request to:",n);const r=await fetch(n,c);if(console.log("[Teacher API] Response received:",{status:r.status,statusText:r.statusText,ok:r.ok,url:r.url}),!r.ok){let l="Something went wrong",i=null;try{i=await r.json(),l=i.message||i.error||l,console.error("[Teacher API] Error Response:",{status:r.status,statusText:r.statusText,errorData:i,errorMessage:l})}catch(m){l=r.statusText||l,console.error("[Teacher API] Error parsing response:",m),console.error("[Teacher API] Error Response (non-JSON):",{status:r.status,statusText:r.statusText,errorMessage:l})}const u=new Error(l);throw u.status=r.status,i&&(u.data=i.data||i,u.errors=i.data?.errors||i.errors),u}const h=r.headers.get("content-type");if(h&&h.includes("application/json")){const l=await r.json();return console.log("[Teacher API] Success Response:",{endpoint:e,success:l.success,hasData:!!l.data}),l}else{const l=await r.text();return console.log("[Teacher API] Success Response (non-JSON):",{endpoint:e,contentType:h,textLength:l.length}),{success:!0,data:l}}}catch(r){throw r.name==="AbortError"||t.signal&&t.signal.aborted?(console.error("[Teacher API] Request Timeout:",{endpoint:e,fullUrl:n,error:r.message}),new Error("Request timeout. The upload is taking too long. Please try again.")):r.name==="TypeError"&&r.message.includes("fetch")?(console.error("[Teacher API] Network Error:",{endpoint:e,fullUrl:n,error:r.message,errorName:r.name,stack:r.stack}),e.includes("upload-recording")?new Error("Network error while uploading recording. Please check your internet connection and try again. If the file is very large, it may take several minutes to upload."):new Error("Network error. Please check if the server is running.")):(console.error("[Teacher API] Request Error:",{endpoint:e,fullUrl:n,error:r.message,errorName:r.name,status:r.status,stack:r.stack}),r)}},P={checkTeacherExists:async e=>s(`/teacher/check/${encodeURIComponent(e)}`,{method:"GET"}),sendOTP:async e=>s("/teacher/send-otp",{method:"POST",body:{phone:e}}),verifyOTP:async(e,t)=>s("/teacher/verify-otp",{method:"POST",body:{phone:e,otp:t}}),resendOTP:async e=>s("/teacher/resend-otp",{method:"POST",body:{phone:e}}),getAll:async()=>s("/teacher",{method:"GET"}),getMe:async()=>s("/teacher/me",{method:"GET"}),updateProfile:async e=>s("/teacher/profile",{method:"PUT",body:e}),updateFcmToken:async(e,t="web")=>s("/teacher/fcm-token",{method:"PUT",body:{fcmToken:e,platform:t}}),getClasses:async()=>s("/student/classes",{method:"GET"}),getSubjects:async(e={})=>{const{classNumber:t,board:o,classId:a}=e;let c="/student/subjects";const n=new URLSearchParams;return a?n.append("classId",a):t&&o&&(n.append("class",t),n.append("board",o)),n.toString()&&(c+=`?${n.toString()}`),s(c,{method:"GET"})},getAllClasses:async()=>s("/student/classes",{method:"GET"}),getAllSubjects:async(e={})=>{const{classId:t,class:o,board:a}=e;let c="/student/subjects";const n=new URLSearchParams;return t?n.append("classId",t):o&&a&&(n.append("class",o),n.append("board",a)),n.toString()&&(c+=`?${n.toString()}`),s(c,{method:"GET"})}},b={getAll:async(e={})=>{const t=new URLSearchParams(e).toString();return s(`/teacher/quizzes${t?`?${t}`:""}`,{method:"GET"})},getStatistics:async()=>s("/teacher/quizzes/statistics",{method:"GET"}),getById:async e=>s(`/teacher/quizzes/${e}`,{method:"GET"}),create:async e=>s("/teacher/quizzes",{method:"POST",body:e}),update:async(e,t)=>s(`/teacher/quizzes/${e}`,{method:"PUT",body:t}),delete:async e=>s(`/teacher/quizzes/${e}`,{method:"DELETE"}),getResults:async e=>s(`/teacher/quizzes/${e}/results`,{method:"GET"})},p={getAboutUs:async()=>s("/about",{method:"GET"})},E={getPrivacy:async()=>s("/privacy",{method:"GET"})},f={getTerms:async()=>s("/terms",{method:"GET"})},S={getMySchedule:async(e=null)=>{const t=e?`?dayOfWeek=${e}`:"";return s(`/timetables/my-schedule${t}`,{method:"GET"})}},A={markToday:async()=>s("/teacher/attendance/mark",{method:"POST"}),getToday:async()=>s("/teacher/attendance/today",{method:"GET"}),getMyMonthly:async(e,t)=>{const o=new URLSearchParams;e&&o.append("year",String(e)),t&&o.append("month",String(t));const a=o.toString()?`?${o.toString()}`:"";return s(`/teacher/attendance${a}`,{method:"GET"})}},I={getAllDoubts:async(e={})=>{const t=new URLSearchParams(e).toString();return s(`/doubts${t?`?${t}`:""}`,{method:"GET"})},getDoubtById:async e=>s(`/doubts/${e}`,{method:"GET"}),answerDoubt:async(e,t)=>s(`/doubts/${e}/answer`,{method:"PUT",body:{answer:t}}),updateDoubtStatus:async(e,t)=>s(`/doubts/${e}/status`,{method:"PUT",body:{status:t}})},v={getMyNotifications:async()=>s("/notifications",{method:"GET"}),getUnreadCount:async()=>s("/notifications/unread-count",{method:"GET"}),markAsRead:async(e=[])=>s("/notifications/mark-read",{method:"PUT",body:{notificationIds:e}}),deleteNotifications:async e=>s("/notifications",{method:"DELETE",body:{notificationIds:e}}),deleteAllNotifications:async()=>s("/notifications/all",{method:"DELETE"})},$={getClassStatistics:async()=>s("/live-classes/teacher/statistics",{method:"GET"}),getMyLiveClasses:async(e=null,t=null,o=null)=>{const a=new URLSearchParams;e&&a.append("date",e),t&&a.append("search",t),o&&a.append("status",o);const c=a.toString()?`?${a.toString()}`:"";return s(`/live-classes/teacher/live-classes${c}`,{method:"GET"})},getAssignedOptions:async()=>s("/live-classes/teacher/live-classes/assigned-options",{method:"GET"}),createLiveClass:async(e,t,o,a,c,n)=>s("/live-classes/teacher/live-classes",{method:"POST",body:{classId:e,subjectId:t,title:o,description:a,startTime:c,endTime:n}}),startLiveClass:async e=>(console.log("[API][Teacher] startLiveClass",{id:e}),s(`/live-classes/teacher/live-classes/${e}/start`,{method:"PUT"})),endLiveClass:async e=>(console.log("[API][Teacher] endLiveClass",{id:e}),s(`/live-classes/teacher/live-classes/${e}/end`,{method:"PUT"})),joinLiveClass:async e=>(console.log("[API][Teacher] joinLiveClass",{id:e}),s(`/live-classes/${e}/join`,{method:"POST"})),getLiveClass:async e=>s(`/live-classes/${e}`,{method:"GET"}),sendChatMessage:async(e,t)=>s(`/live-classes/${e}/chat`,{method:"POST",body:{message:t}}),markChatAsRead:async e=>s(`/live-classes/${e}/chat/mark-read`,{method:"PUT"}),toggleMute:async e=>s(`/live-classes/${e}/mute`,{method:"PUT"}),toggleVideo:async e=>s(`/live-classes/${e}/video`,{method:"PUT"}),uploadRecording:async(e,t)=>{const o=new FormData;o.append("recording",t);const a=t.size/(1024*1024),c=Math.max(6e5,a*6e4);console.log("[Teacher API] Uploading recording:",{fileSize:t.size,fileSizeMB:a.toFixed(2),timeoutMs:c/1e3/60+" minutes",fileName:t.name});const n=new AbortController,d=setTimeout(()=>n.abort(),c);try{const r=await s(`/live-classes/teacher/live-classes/${e}/upload-recording`,{method:"POST",body:o,signal:n.signal});return clearTimeout(d),r}catch(r){throw clearTimeout(d),r.name==="AbortError"||n.signal.aborted?new Error(`Upload timeout. The file is too large (${a.toFixed(2)}MB). Please try again or contact support.`):r}}},k={checkAgentExists:async e=>s("/agent/check-exists",{method:"POST",body:{phone:e}}),sendOTP:async e=>s("/agent/send-otp",{method:"POST",body:{phone:e}}),verifyOTP:async(e,t)=>s("/agent/verify-otp",{method:"POST",body:{phone:e,otp:t}}),getMe:async()=>s("/agent/me",{method:"GET"}),updateMe:async e=>s("/agent/me",{method:"PUT",body:e}),getReferralLink:async()=>s("/agent/referral-link",{method:"GET"}),getStatistics:async(e=null)=>{const t=e?`/agent/statistics?month=${encodeURIComponent(e)}`:"/agent/statistics";return s(t,{method:"GET"})},updateFcmToken:async(e,t="web")=>s("/agent/fcm-token",{method:"PUT",body:{fcmToken:e,platform:t}}),exportStatistics:async(e=null)=>{const t=e?`/agent/statistics/export?month=${encodeURIComponent(e)}`:"/agent/statistics/export";return s(t,{method:"GET"})}};export{k as a,A as b,S as c,I as d,f as e,p as f,$ as l,v as n,E as p,b as q,P as t};
