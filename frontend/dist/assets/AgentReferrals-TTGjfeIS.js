import{q as L,u as B,r as n,j as e}from"./index-BPKQ2keO.js";import{k as f}from"./api-BdrZRD_7.js";const E=()=>{const{id:m}=L(),y=B(),[r,j]=n.useState(null),[h,N]=n.useState([]),[d,v]=n.useState([]),[i,w]=n.useState(""),[c,k]=n.useState(""),[S,p]=n.useState(!0),[g,o]=n.useState("");n.useEffect(()=>{I(),A()},[m,i,c]);const I=async()=>{try{const t=await f.getById(m);t.success&&t.data?.agent&&j(t.data.agent)}catch(t){o(t.message||"Failed to load agent data"),console.error("Error fetching agent:",t)}},A=async()=>{try{p(!0),o("");const t={};if(i){const[s,a]=i.split("-");t.month=a,t.year=s}c&&(t.status=c);const l=await f.getReferrals(m,t);l.success&&l.data?(N(l.data.referrals||[]),v(l.data.monthWiseBreakdown||[])):o("Failed to load referrals")}catch(t){o(t.message||"Failed to load referrals"),console.error("Error fetching referrals:",t)}finally{p(!1)}},u=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t||0),D=t=>t?new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"N/A",M=()=>{const t=[],l=new Date;new Set(d.map(s=>s.month));for(let s=0;s<24;s++){const a=new Date(l.getFullYear(),l.getMonth()-s,1),x=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,b=a.toLocaleDateString("en-IN",{year:"numeric",month:"long"});t.push({value:x,label:b})}return d.forEach(s=>{if(!t.find(a=>a.value===s.month)){const[a,x]=s.month.split("-"),C=new Date(parseInt(a),parseInt(x)-1,1).toLocaleDateString("en-IN",{year:"numeric",month:"long"});t.push({value:s.month,label:C})}}),t.sort((s,a)=>a.value.localeCompare(s.value))};return e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pt-3 sm:pt-4 md:pt-5 lg:pt-6",children:[e.jsx("div",{className:"pb-0",children:e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>y("/admin/agents"),className:"text-[#1e3a5f] hover:text-[#2a4a6f] mb-2 flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Agents"]}),e.jsx("h1",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-white",children:r?`${r.name}'s Referrals`:"Agent Referrals"}),r&&e.jsxs("p",{className:"text-white/80 text-xs sm:text-sm mt-1",children:["Phone: ",r.phone," ",r.email&&`| Email: ${r.email}`]})]})})}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-xs sm:text-sm mt-2 sm:mt-3",children:g}),e.jsx("div",{className:"mt-3 sm:mt-4 md:mt-5 lg:mt-6 bg-white rounded-lg shadow-md p-3 sm:p-4 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Filter by Month"}),e.jsxs("select",{value:i,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-xs sm:text-sm focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none",children:[e.jsx("option",{value:"",children:"All Months"}),M().map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Filter by Status"}),e.jsxs("select",{value:c,onChange:t=>k(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-xs sm:text-sm focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})]})}),d.length>0&&e.jsxs("div",{className:"mt-3 sm:mt-4 md:mt-5 lg:mt-6",children:[e.jsx("h2",{className:"text-sm sm:text-base md:text-lg font-bold text-white mb-2 sm:mb-3",children:"Month-wise Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 md:gap-4",children:d.map((t,l)=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-3 sm:p-4 border border-gray-200",children:[e.jsx("p",{className:"text-gray-500 text-xs font-medium mb-1",children:t.month}),e.jsxs("p",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-900",children:[t.count," Referrals"]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-1",children:u(t.totalAmount)})]},l))})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden mt-3 sm:mt-4 md:mt-5 lg:mt-6",children:e.jsx("div",{className:"overflow-x-auto",children:S?e.jsxs("div",{className:"p-6 sm:p-8 md:p-10 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-[#1e3a5f]"}),e.jsx("p",{className:"mt-2 sm:mt-3 text-gray-500 text-xs sm:text-sm",children:"Loading referrals..."})]}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Student Details"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider hidden sm:table-cell",children:"Class & Board"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider hidden md:table-cell",children:"Plan"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider hidden lg:table-cell",children:"Date"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-3 sm:px-4 py-6 sm:py-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"h-10 w-10 sm:h-12 sm:w-12 rounded-full bg-gray-100 flex items-center justify-center mb-2 sm:mb-3",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx("p",{className:"text-gray-500 font-medium text-xs sm:text-sm",children:"No referrals found"}),e.jsx("p",{className:"text-gray-400 text-[10px] sm:text-xs mt-1",children:"Try adjusting your filters"})]})})}):h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-all duration-200",children:[e.jsxs("td",{className:"px-2 sm:px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-900",children:t.studentId?.name||"N/A"}),e.jsx("div",{className:"text-[10px] sm:text-xs text-gray-500 mt-0.5",children:t.studentId?.phone||"N/A"}),t.studentId?.email&&e.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5",children:t.studentId.email})]}),e.jsxs("td",{className:"px-2 sm:px-3 py-2 whitespace-nowrap hidden sm:table-cell",children:[e.jsx("div",{className:"text-xs text-gray-600",children:t.studentId?.class?`Class ${t.studentId.class}`:"N/A"}),t.studentId?.board&&e.jsx("div",{className:"text-[10px] text-gray-500 mt-0.5",children:t.studentId.board})]}),e.jsx("td",{className:"px-2 sm:px-3 py-2 whitespace-nowrap hidden md:table-cell",children:e.jsx("div",{className:"text-xs text-gray-600",children:t.subscriptionPlanId?.name||"N/A"})}),e.jsx("td",{className:"px-2 sm:px-3 py-2 whitespace-nowrap",children:e.jsx("div",{className:"text-xs font-semibold text-gray-900",children:u(t.amount)})}),e.jsx("td",{className:"px-2 sm:px-3 py-2 whitespace-nowrap hidden lg:table-cell",children:e.jsx("div",{className:"text-xs text-gray-600",children:D(t.subscriptionDate)})}),e.jsx("td",{className:"px-2 sm:px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${t.status==="paid"?"bg-green-100 text-green-800":t.status==="completed"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:t.status||"N/A"})})]},t._id))})]})})})]})})};export{E as default};
