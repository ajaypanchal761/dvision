import{u as E,r,j as e,c as F,ay as $,aB as b,l as y}from"./index-BPKQ2keO.js";import{a as j}from"./api-CVReUq8b.js";import{B as L}from"./BottomNav-BGePCkyK.js";const Y=()=>{const d=E(),[l,h]=r.useState(!0),[o,c]=r.useState(""),[m,v]=r.useState([]),[u,S]=r.useState({totalReferrals:0,totalAmount:0,completed:0,pending:0}),g=()=>{const t=new Date,s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0");return`${s}-${a}`},[i,w]=r.useState(g()),[A,R]=r.useState([]);r.useEffect(()=>{D(),M()},[i]);const M=async()=>{try{const t=await j.getStatistics();if(t.success&&t.data){const s=t.data.referredStudents||[],a=new Set;s.forEach(x=>{const n=x.referredAt?new Date(x.referredAt):new Date(x.createdAt);if(n&&!isNaN(n.getTime())){const k=n.getFullYear(),C=String(n.getMonth()+1).padStart(2,"0");a.add(`${k}-${C}`)}});const f=g();a.add(f);const p=Array.from(a).sort((x,n)=>n.localeCompare(x));R(p)}}catch(t){console.error("Error fetching available months:",t)}},D=async()=>{try{h(!0),c("");const t=await j.getStatistics(i);if(t.success&&t.data){const s=t.data;S({totalReferrals:s.statistics?.totalReferrals||0,totalAmount:s.statistics?.totalAmount||0,completed:s.statistics?.successfulSubscriptions||0,pending:(s.statistics?.totalReferrals||0)-(s.statistics?.successfulSubscriptions||0)}),v(s.referredStudents||[])}else c(t.message||"Failed to load referrals")}catch(t){c(t.message||"Failed to load referrals")}finally{h(!1)}};return e.jsxs("div",{className:"min-h-screen bg-white pb-20 sm:pb-24",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsxs("div",{className:"px-3 sm:px-4 md:px-6 pt-3 sm:pt-4 md:pt-5 pb-4 sm:pb-5 md:pb-6 flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>d($.AGENT_DASHBOARD),className:"p-1.5 sm:p-2 text-white hover:bg-white/10 rounded-full transition-colors flex-shrink-0",children:e.jsx(F,{className:"text-lg sm:text-xl md:text-2xl"})}),e.jsx(b,{className:"text-lg sm:text-xl md:text-2xl"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold",children:"Referrals"}),e.jsx("p",{className:"text-[10px] sm:text-xs text-white/80",children:"Your recent referrals and status"})]})]})}),e.jsxs("div",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl p-2 sm:p-3 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(y,{className:"text-gray-600 text-sm sm:text-base"}),e.jsx("label",{className:"text-[10px] sm:text-xs md:text-sm font-medium text-gray-700",children:"Filter by Month:"}),e.jsxs("select",{value:i,onChange:t=>w(t.target.value),className:"flex-1 px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg text-[10px] sm:text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-dark-blue)] bg-white",children:[e.jsx("option",{value:"",children:"All Months"}),A.map(t=>{const[s,a]=t.split("-"),p=new Date(s,parseInt(a)-1,1).toLocaleDateString("en-US",{month:"long",year:"numeric"});return e.jsx("option",{value:t,children:p},t)})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4 mt-2 sm:mt-3",children:[e.jsx(N,{label:"Total",value:u.totalReferrals}),e.jsx(N,{label:"Completed",value:u.completed})]}),l&&e.jsx("div",{className:"w-full text-center text-[11px] sm:text-xs md:text-sm text-gray-600 py-4",children:"Loading referrals..."}),o&&!l&&e.jsx("div",{className:"w-full text-center text-[11px] sm:text-xs md:text-sm text-red-600 py-4 bg-red-50 rounded-lg px-3 py-2",children:o}),!l&&!o&&m.length===0&&e.jsxs("div",{className:"w-full text-center text-[11px] sm:text-xs md:text-sm text-gray-600 py-8",children:[e.jsx(b,{className:"mx-auto text-gray-400 text-3xl sm:text-4xl mb-3"}),e.jsx("p",{children:"No referrals yet."}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500 mt-1",children:"Share your referral link to get started!"})]}),!l&&!o&&m.length>0&&e.jsx("div",{className:"space-y-2 sm:space-y-3",children:m.map(t=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-2 sm:p-2.5 md:p-3 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-0.5 sm:mb-1",children:[e.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm font-semibold text-[var(--app-black)]",children:t.name||t.studentName||"Student"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] md:text-xs font-semibold px-1.5 sm:px-2 py-0.5 rounded-full bg-blue-50 text-blue-700",children:"Referred"})]}),(t.class||t.board)&&e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-600 mb-0.5 sm:mb-1",children:[t.class?`Class ${t.class}`:""," ",t.board?`- ${t.board}`:""]}),t.referredAt&&e.jsxs("div",{className:"flex items-center gap-1 text-[9px] sm:text-[10px] md:text-xs text-gray-500",children:[e.jsx(y,{className:"text-[10px] sm:text-xs"}),e.jsx("span",{children:new Date(t.referredAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]},t._id||`${t.studentName}-${t.subscriptionDate}`))})]}),e.jsx(L,{})]})},N=({label:d,value:l})=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-2 sm:p-2.5 md:p-3 shadow-sm",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600",children:d}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold text-[var(--app-dark-blue)] mt-0.5 sm:mt-1",children:l})]});export{Y as default};
