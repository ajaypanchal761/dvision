import{u as K,q as G,r as i,j as e,c as J,aK as X,F as Y}from"./index-BPKQ2keO.js";import{q as A,t as C}from"./api-CVReUq8b.js";import{B as Z}from"./BottomNav-BGePCkyK.js";const re=()=>{const u=K(),{id:b}=G(),[r,c]=i.useState({quizName:"",board:"",class:"",subjectId:"",status:"Active",deadlineDate:"",deadlineTime:"12:00"}),[o,m]=i.useState([]),[y,D]=i.useState([]),[N,Q]=i.useState([]),[E,I]=i.useState([]),[P,w]=i.useState([]),[T,k]=i.useState([]),[h,S]=i.useState(!0),[B,q]=i.useState(!0),[z,g]=i.useState(!1),[F,L]=i.useState({}),[f,$]=i.useState(!1);i.useEffect(()=>{b&&(async()=>{try{q(!0);const t=await A.getById(b);if(t.success&&t.data?.quiz){const a=t.data.quiz;if(a.deadline){const l=new Date,n=new Date(a.deadline);if(l>=n){$(!0),alert("This quiz deadline has passed. Editing is not allowed."),u("/teacher/quizzes");return}}if(c({quizName:a.name||"",board:a.board||"",class:a.classNumber?.toString()||"",subjectId:a.subjectId?._id||a.subjectId||"",status:a.isActive?"Active":"Inactive",deadlineDate:"",deadlineTime:"12:00"}),a.deadline){const l=new Date(a.deadline),n=l.toISOString().split("T")[0],d=l.getHours(),x=l.getMinutes(),p=`${String(d).padStart(2,"0")}:${String(x).padStart(2,"0")}`;c(v=>({...v,deadlineDate:n,deadlineTime:p}))}a.questions&&Array.isArray(a.questions)&&m(a.questions.map(l=>({question:l.question||"",options:l.options||["","","",""],correctAnswer:l.correctAnswer||0})))}}catch(t){console.error("Error fetching quiz:",t),alert("Failed to load quiz. Please try again."),u("/teacher/quizzes")}finally{q(!1)}})()},[b,u]),i.useEffect(()=>{(async()=>{try{S(!0);const[t,a]=await Promise.all([C.getAllClasses(),C.getAllSubjects()]);if(t.success&&t.data?.classes){const l=t.data.classes.filter(d=>d.isActive);D(l);const n=[...new Set(l.map(d=>d.board))].filter(Boolean).sort();I(n)}if(a.success&&a.data?.subjects){const l=a.data.subjects.filter(n=>n.isActive);Q(l)}}catch(t){console.error("Error fetching data:",t)}finally{S(!1)}})()},[]),i.useEffect(()=>{if(!r.board){w([]);return}const s=y.filter(a=>a.board===r.board).map(a=>a.class),t=[...new Set(s)].sort((a,l)=>a-l);w(t)},[r.board,y]),i.useEffect(()=>{if(!r.board||!r.class){k([]);return}const s=N.filter(t=>t.board===r.board&&t.class===parseInt(r.class));k(s)},[r.board,r.class,N]);const O=()=>{m([...o,{question:"",options:["","","",""],correctAnswer:0}])},R=s=>{if(o.length>1){const t=o.filter((a,l)=>l!==s);m(t)}else alert("At least one question is required")},M=(s,t,a)=>{const l=[...o];l[s][t]=a,m(l)},_=(s,t,a)=>{const l=[...o];l[s].options[t]=a,m(l)},H=(s,t)=>{const a=[...o];a[s].correctAnswer=parseInt(t),m(a)},U=s=>{L(t=>({...t,[s]:!t[s]}))},V=()=>{if(!r.quizName.trim())return alert("Please enter quiz name"),!1;if(!r.board)return alert("Please select a board"),!1;if(!r.class)return alert("Please select a class"),!1;if(!r.subjectId)return alert("Please select a subject"),!1;if(o.length===0)return alert("Please add at least one question"),!1;for(let s=0;s<o.length;s++){const t=o[s];if(!t.question.trim())return alert(`Please enter question ${s+1}`),!1;for(let a=0;a<4;a++)if(!t.options[a]||!t.options[a].trim())return alert(`Please enter all 4 options for question ${s+1}`),!1}return!0},W=async s=>{if(s.preventDefault(),!!V())try{g(!0);let t=null;if(r.deadlineDate&&r.deadlineTime)try{const[n,d]=r.deadlineTime.split(":");if(!n||!d||isNaN(parseInt(n))||isNaN(parseInt(d)))throw new Error("Invalid time format");const x=parseInt(n,10),p=parseInt(d,10);if(x<0||x>23||p<0||p>59)throw new Error("Invalid time value");const v=`${r.deadlineDate}T${String(x).padStart(2,"0")}:${String(p).padStart(2,"0")}`,j=new Date(v);if(isNaN(j.getTime()))throw new Error("Invalid date or time value");if(!f&&j<=new Date)throw new Error("Deadline must be in the future. Please select a future date and time.");t=j.toISOString()}catch(n){console.error("Error parsing deadline:",n),alert(n.message||"Invalid deadline date or time. Please check your input."),g(!1);return}const a={name:r.quizName.trim(),classNumber:parseInt(r.class),board:r.board,subjectId:r.subjectId,isActive:r.status==="Active",deadline:t,questions:o.map(n=>({question:n.question.trim(),options:n.options.map(d=>d.trim()),correctAnswer:n.correctAnswer}))};(await A.update(b,a)).success&&(alert("Quiz updated successfully!"),u("/teacher/quizzes"))}catch(t){console.error("Error updating quiz:",t),alert(t.message||"Failed to update quiz. Please try again.")}finally{g(!1)}};return B?e.jsx("div",{className:"min-h-screen bg-white pb-20 sm:pb-24 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500 text-xs sm:text-sm",children:"Loading quiz..."})}):e.jsxs("div",{className:"min-h-screen bg-white pb-20 sm:pb-24",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 pt-3 sm:pt-4 md:pt-6 pb-4 sm:pb-6 md:pb-8",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("button",{onClick:()=>u("/teacher/quizzes"),className:"p-1.5 sm:p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(J,{className:"text-white text-lg sm:text-xl md:text-2xl"})}),e.jsx("h1",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold",children:"Edit Quiz"})]})})}),e.jsx("div",{className:"px-3 sm:px-4 md:px-6 py-4 sm:py-5 md:py-6",children:e.jsxs("form",{onSubmit:W,className:"space-y-4 sm:space-y-5 md:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 md:gap-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Quiz Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.quizName,onChange:s=>c({...r,quizName:s.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all",placeholder:"Enter quiz name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Board ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.board,onChange:s=>{c({...r,board:s.target.value,class:"",subjectId:""})},disabled:h,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Board"}),E.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.class,onChange:s=>{c({...r,class:s.target.value,subjectId:""})},disabled:!r.board||h,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Class"}),P.map(s=>e.jsxs("option",{value:s,children:["Class ",s]},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Subject ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.subjectId,onChange:s=>c({...r,subjectId:s.target.value}),disabled:!r.class||h,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Subject"}),T.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.status,onChange:s=>c({...r,status:s.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all bg-white",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:"Deadline"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"date",value:r.deadlineDate,min:f?void 0:new Date().toISOString().split("T")[0],onChange:s=>c({...r,deadlineDate:s.target.value}),className:"flex-1 px-2 sm:px-3 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all"}),e.jsx("input",{type:"time",value:r.deadlineTime,onChange:s=>c({...r,deadlineTime:s.target.value}),className:"w-32 sm:w-36 px-2 sm:px-3 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all"})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500 mt-1",children:["Optional: Set deadline for quiz submission ",f?"(deadline has passed)":"(must be in the future)"]})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-5 md:mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-900",children:["Questions (",o.length,")"]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500 mt-1",children:"Add questions with 4 options each and select the correct answer"})]}),e.jsxs("button",{type:"button",onClick:O,className:"px-3 sm:px-4 py-2 bg-[var(--app-dark-blue)] hover:bg-blue-800 text-white rounded-lg sm:rounded-xl font-semibold text-xs sm:text-sm transition-all flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Add Question"})]})]}),o.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 sm:p-8 md:p-10 border-2 border-dashed border-gray-300 text-center",children:[e.jsx("p",{className:"text-gray-500 font-medium text-xs sm:text-sm mb-1",children:"No questions added yet"}),e.jsx("p",{className:"text-gray-400 text-[10px] sm:text-xs",children:'Click "Add Question" to start adding questions'})]}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:o.map((s,t)=>{const a=F[t];return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>U(t),className:"w-full flex items-center justify-between p-3 sm:p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 text-left",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-[var(--app-dark-blue)] text-white rounded-full flex items-center justify-center flex-shrink-0 text-xs sm:text-sm font-bold",children:t+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-xs sm:text-sm font-semibold text-gray-900 mb-1",children:["Question ",t+1]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 line-clamp-2",children:s.question||"Click to expand and add question..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.length>1&&e.jsx("button",{type:"button",onClick:l=>{l.stopPropagation(),R(t)},className:"p-1.5 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove Question",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),a?e.jsx(X,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}):e.jsx(Y,{className:"w-5 h-5 text-gray-600 flex-shrink-0"})]})]}),a&&e.jsxs("div",{className:"p-3 sm:p-4 md:p-5 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5",children:["Question Text ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{required:!0,value:s.question||"",onChange:l=>M(t,"question",l.target.value),rows:"3",className:"w-full px-3 sm:px-4 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all resize-none bg-white",placeholder:"Enter your question here...",autoFocus:!0}),s.question&&e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500 mt-1",children:"Current question text is displayed above. Edit as needed."})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5",children:["Options ",e.jsx("span",{className:"text-red-500",children:"*"})]}),s.options.map((l,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correctAnswer-${t}`,checked:s.correctAnswer===n,onChange:()=>H(t,n),className:"w-4 h-4 text-[var(--app-dark-blue)] focus:ring-[var(--app-dark-blue)] cursor-pointer"}),e.jsx("input",{type:"text",required:!0,value:l,onChange:d=>_(t,n,d.target.value),className:"flex-1 px-3 sm:px-4 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all",placeholder:`Option ${n+1}`})]},n))]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500",children:"Select the radio button next to the correct answer"})]})]},t)})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 pt-4 sm:pt-6",children:[e.jsx("button",{type:"button",onClick:()=>u("/teacher/quizzes"),className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm border-2 border-gray-300 text-gray-700 rounded-lg sm:rounded-xl font-semibold hover:bg-gray-50 transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:z,className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm bg-[var(--app-dark-blue)] hover:bg-blue-800 text-white rounded-lg sm:rounded-xl font-semibold transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:z?"Updating...":"Update Quiz"})]})]})}),e.jsx(Z,{})]})};export{re as default};
