import{u as w,r as t,j as e,c as S,ay as k,l as C,x as R,aA as D}from"./index-BPKQ2keO.js";import{B as A}from"./BottomNav-BGePCkyK.js";import{a as p}from"./api-CVReUq8b.js";const I=()=>{const h=w(),[n,d]=t.useState(!0),[m,g]=t.useState({totalReferrals:0,successfulSubscriptions:0,pendingCommissions:0}),[c,u]=t.useState([]),[x,b]=t.useState([]),[a,f]=t.useState(""),[L,E]=t.useState(new Date().getFullYear());t.useEffect(()=>{j()},[]);const j=async()=>{try{d(!0);const s=await p.getStatistics();s.success&&s.data&&(g(s.data.statistics||{totalReferrals:0,successfulSubscriptions:0,pendingCommissions:0}),b(s.data.monthWiseBreakdown||[]),u(s.data.referredStudents||[]))}catch(s){console.error("Error fetching statistics:",s)}finally{d(!1)}},y=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s),N=async()=>{try{const s=await p.exportStatistics(a);if(s&&(s.success||s.data)){const r=s.data,v=new Blob([r],{type:"text/csv"}),o=window.URL.createObjectURL(v),l=document.createElement("a");l.href=o,l.download=`referrals-${a||"all"}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o)}}catch(s){console.error("Error exporting CSV:",s)}},i=a?x.filter(s=>s.month===a):x;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 sm:pb-24",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 pt-3 sm:pt-4 md:pt-5 pb-4 sm:pb-5 md:pb-6",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>h(k.AGENT_DASHBOARD),className:"p-1.5 sm:p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(S,{className:"text-lg sm:text-xl md:text-2xl"})}),e.jsx("h1",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold",children:"Referral Statistics"})]})})}),e.jsxs("div",{className:"px-3 sm:px-4 md:px-6 mt-2 sm:mt-3 md:mt-4 space-y-3 sm:space-y-4 md:space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 mt-2 sm:mt-3",children:[e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl p-2 sm:p-5 shadow-lg",children:[e.jsx("p",{className:"text-[10px] sm:text-sm text-gray-600 font-medium mb-1 sm:mb-2",children:"Total Referrals"}),e.jsx("p",{className:"text-lg sm:text-3xl font-bold text-[var(--app-dark-blue)]",children:m.totalReferrals})]}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl p-2 sm:p-5 shadow-lg",children:[e.jsx("p",{className:"text-[10px] sm:text-sm text-gray-600 font-medium mb-1 sm:mb-2",children:"Successful Subscriptions"}),e.jsx("p",{className:"text-lg sm:text-3xl font-bold text-green-600",children:m.successfulSubscriptions})]}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl p-2 sm:p-5 shadow-lg",children:[e.jsx("p",{className:"text-[10px] sm:text-sm text-gray-600 font-medium mb-1 sm:mb-2",children:"Pending Commissions"}),e.jsx("p",{className:"text-lg sm:text-3xl font-bold text-orange-600",children:m.pendingCommissions})]})]}),e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-lg",children:e.jsxs("div",{className:"flex flex-row gap-2 sm:gap-3 md:gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex flex-row gap-2 sm:gap-3 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"text-gray-600 text-sm sm:text-base"}),e.jsxs("select",{value:a,onChange:s=>f(s.target.value),className:"px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg text-[10px] sm:text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-dark-blue)]",children:[e.jsx("option",{value:"",children:"All Months"}),x.map((s,r)=>e.jsx("option",{value:s.month,children:new Date(s.month+"-01").toLocaleDateString("en-US",{month:"long",year:"numeric"})},r))]})]})}),e.jsxs("button",{onClick:N,className:"flex items-center gap-1.5 sm:gap-2 px-2.5 sm:px-3 md:px-4 py-1.5 sm:py-2 bg-[var(--app-dark-blue)] text-white rounded-lg sm:rounded-xl hover:opacity-90 transition-all text-[10px] sm:text-xs md:text-sm font-medium",children:[e.jsx(R,{className:"text-xs sm:text-sm"}),"Export CSV"]})]})}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-lg",children:[e.jsx("h2",{className:"text-sm sm:text-base md:text-lg font-bold text-[var(--app-black)] mb-2 sm:mb-3",children:"Month-wise Breakdown"}),n?e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-gray-500 text-center py-3 sm:py-4",children:"Loading..."}):i.length>0?e.jsx("div",{className:"space-y-1.5 sm:space-y-2",children:i.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-2.5 md:p-3 bg-gray-50 rounded-lg sm:rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 bg-[var(--app-dark-blue)]/10 rounded-full flex items-center justify-center",children:e.jsx(D,{className:"text-[var(--app-dark-blue)] text-sm sm:text-lg md:text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm font-medium text-[var(--app-black)]",children:new Date(s.month+"-01").toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsxs("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-gray-600",children:[s.count," ",s.count===1?"referral":"referrals"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm font-bold text-[var(--app-dark-blue)]",children:y(s.totalAmount)})})]},r))}):e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-gray-500 text-center py-3 sm:py-4",children:"No data available for the selected period."})]})]}),e.jsx("div",{className:"px-3 sm:px-4 md:px-6 mt-2 sm:mt-3 md:mt-4",children:e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl p-3 sm:p-4 md:p-5 shadow-lg",children:[e.jsx("h2",{className:"text-sm sm:text-base md:text-lg font-bold text-[var(--app-black)] mb-2 sm:mb-3",children:"Referred Students"}),n?e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-gray-500 text-center py-3 sm:py-4",children:"Loading..."}):c.length===0?e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-gray-500 text-center py-3 sm:py-4",children:"No referrals yet."}):e.jsx("div",{className:"space-y-1.5 sm:space-y-2",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-2.5 md:p-3 bg-gray-50 rounded-lg sm:rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm font-semibold text-[var(--app-black)]",children:s.name||"Student"}),e.jsxs("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-gray-600",children:[s.class?`Class ${s.class}`:""," ",s.board||""]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-gray-500",children:s.referredAt?new Date(s.referredAt).toLocaleDateString():""})})]},s._id))})]})}),e.jsx(A,{})]})};export{I as default};
