import{u as F,r as i,j as e}from"./index-BPKQ2keO.js";import{c as O,e as I,q as R}from"./api-BdrZRD_7.js";const V=()=>{const f=F(),[s,n]=i.useState({type:"regular",quizName:"",board:"",class:"",classId:"",subjectId:"",status:"Active",deadlineDate:"",deadlineTime:"12:00",deadlineAmPm:"AM"}),[o,m]=i.useState([]),[j,q]=i.useState([]),[y,k]=i.useState([]),[P,z]=i.useState([]),[v,D]=i.useState([]),[Q,h]=i.useState([]),[N,x]=i.useState([]),[w,g]=i.useState([]),[b,S]=i.useState(!0),[C,A]=i.useState(!1);i.useEffect(()=>{(async()=>{try{S(!0);const[a,r]=await Promise.all([O.getAll(),I.getAll()]);if(a.success&&a.data?.classes){const l=a.data.classes.filter(c=>c.isActive);q(l);const d=l.filter(c=>c.type==="regular"),p=l.filter(c=>c.type==="preparation"),u=[...new Set(d.map(c=>c.board).filter(Boolean))].sort();z(u),D(p)}if(r.success&&r.data?.subjects){const l=r.data.subjects.filter(d=>d.isActive);k(l)}}catch(a){console.error("Error fetching data:",a)}finally{S(!1)}})()},[]),i.useEffect(()=>{if(s.type!=="regular"){h([]);return}if(!s.board){h([]),n(r=>({...r,class:"",subjectId:""})),x([]);return}const t=j.filter(r=>r.type==="regular"&&r.board===s.board).map(r=>r.class),a=[...new Set(t)].sort((r,l)=>r-l);h(a),s.class&&!a.includes(parseInt(s.class))&&(n(r=>({...r,class:"",subjectId:""})),x([]))},[s.type,s.board,j]),i.useEffect(()=>{if(s.type!=="regular"){x([]);return}if(!s.board||!s.class){x([]),n(a=>({...a,subjectId:""}));return}const t=y.filter(a=>a.board===s.board&&a.class===parseInt(s.class));x(t),s.subjectId&&!t.find(a=>a._id===s.subjectId)&&n(a=>({...a,subjectId:""}))},[s.type,s.board,s.class,y]),i.useEffect(()=>{if(s.type!=="preparation"||!s.classId){g([]),n(a=>({...a,subjectId:""}));return}(async()=>{try{const a=await I.getAll({classId:s.classId});if(a.success&&a.data?.subjects){const r=a.data.subjects.filter(l=>l.isActive);g(r),s.subjectId&&!r.find(l=>l._id===s.subjectId)&&n(l=>({...l,subjectId:""}))}else g([])}catch(a){console.error("Error fetching preparation subjects:",a),g([])}})()},[s.type,s.classId]),i.useEffect(()=>{s.type==="regular"?n(t=>({...t,classId:"",board:"",class:"",subjectId:""})):n(t=>({...t,board:"",class:"",classId:"",subjectId:""}))},[s.type]);const M=()=>{m([...o,{question:"",options:["","","",""],correctAnswer:0}]),n({...s,numberOfQuestions:(o.length+1).toString()})},E=t=>{if(o.length>1){const a=o.filter((r,l)=>l!==t);m(a),n({...s,numberOfQuestions:a.length.toString()})}else alert("At least one question is required")},L=(t,a,r)=>{const l=[...o];l[t][a]=r,m(l)},T=(t,a,r)=>{const l=[...o];l[t].options[a]=r,m(l)},B=(t,a)=>{const r=[...o];r[t].correctAnswer=parseInt(a),m(r)},_=()=>{if(!s.quizName.trim())return alert("Please enter quiz name"),!1;if(s.type==="regular"){if(!s.board)return alert("Please select a board"),!1;if(!s.class)return alert("Please select a class"),!1}else if(s.type==="preparation"&&!s.classId)return alert("Please select a preparation class"),!1;if(!s.subjectId)return alert("Please select a subject"),!1;if(o.length===0)return alert("Please add at least one question"),!1;for(let t=0;t<o.length;t++){const a=o[t];if(!a.question.trim())return alert(`Please enter question ${t+1}`),!1;for(let r=0;r<4;r++)if(!a.options[r]||!a.options[r].trim())return alert(`Please enter all 4 options for question ${t+1}`),!1}return!0},$=async t=>{if(t.preventDefault(),!!_())try{A(!0);let a=null;if(s.deadlineDate&&s.deadlineTime){const[d,p]=s.deadlineTime.split(":");let u=parseInt(d);s.deadlineAmPm==="PM"&&u!==12?u+=12:s.deadlineAmPm==="AM"&&u===12&&(u=0),a=new Date(`${s.deadlineDate}T${String(u).padStart(2,"0")}:${p}`).toISOString()}const r={name:s.quizName.trim(),type:s.type,subjectId:s.subjectId,isActive:s.status==="Active",deadline:a,questions:o.map(d=>({question:d.question.trim(),options:d.options.map(p=>p.trim()),correctAnswer:d.correctAnswer}))};s.type==="regular"?(r.classNumber=parseInt(s.class),r.board=s.board):s.type==="preparation"&&(r.classId=s.classId),(await R.create(r)).success&&(alert("Quiz created successfully!"),f("/admin/quizzes"))}catch(a){console.error("Error creating quiz:",a),alert(a.message||"Failed to create quiz. Please try again.")}finally{A(!1)}};return e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pt-2 sm:pt-3",children:[e.jsx("div",{className:"pb-1 sm:pb-2",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>f("/admin/quizzes"),className:"text-[#1e3a5f] hover:text-[#2a4a6f] transition-colors",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsx("h1",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold text-[#1e3a5f]",children:"Add New Quiz"})]})}),e.jsx("div",{className:"mt-2 sm:mt-3",children:e.jsxs("form",{onSubmit:$,className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4 md:p-5",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Quiz Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.type,onChange:t=>n({...s,type:t.target.value,board:"",class:"",classId:"",subjectId:""}),className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white",children:[e.jsx("option",{value:"regular",children:"Regular Class"}),e.jsx("option",{value:"preparation",children:"Preparation Class"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Quiz Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.quizName,onChange:t=>n({...s,quizName:t.target.value}),className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200",placeholder:"Enter quiz name"})]}),s.type==="regular"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Board ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.board,onChange:t=>{n({...s,board:t.target.value,class:"",subjectId:""})},disabled:b,className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Board"}),P.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),s.type==="preparation"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Preparation Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.classId,onChange:t=>{n({...s,classId:t.target.value,subjectId:""})},disabled:b||v.length===0,className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Preparation Class"}),v.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),s.type==="regular"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.class,onChange:t=>{n({...s,class:t.target.value,subjectId:""})},disabled:!s.board||b,className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Class"}),Q.map(t=>e.jsxs("option",{value:t,children:["Class ",t]},t))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Subject ",e.jsx("span",{className:"text-red-500",children:"*"})]}),s.type==="regular"?e.jsxs("select",{required:!0,value:s.subjectId,onChange:t=>n({...s,subjectId:t.target.value}),disabled:!s.class||b||N.length===0,className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:s.class?"Select Subject":"Select Class First"}),N.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}):e.jsxs("select",{required:!0,value:s.subjectId,onChange:t=>n({...s,subjectId:t.target.value}),disabled:!s.classId||b||w.length===0,className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:s.classId?"Select Subject":"Select Preparation Class First"}),w.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.status,onChange:t=>n({...s,status:t.target.value}),className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:"Deadline"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"date",value:s.deadlineDate,onChange:t=>n({...s,deadlineDate:t.target.value}),className:"w-32 sm:w-36 px-2 sm:px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200",placeholder:"Select Date"}),e.jsx("input",{type:"time",value:s.deadlineTime,onChange:t=>n({...s,deadlineTime:t.target.value}),className:"w-28 sm:w-32 md:w-36 px-2 sm:px-3 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200",placeholder:"Select Time"}),e.jsxs("select",{value:s.deadlineAmPm,onChange:t=>n({...s,deadlineAmPm:t.target.value}),className:"w-16 sm:w-20 px-2 sm:px-3 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white",children:[e.jsx("option",{value:"AM",children:"AM"}),e.jsx("option",{value:"PM",children:"PM"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select date and time for quiz deadline (optional)"})]})]})}),e.jsxs("div",{className:"mt-4 sm:mt-5 md:mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-900",children:["Questions (",o.length,")"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add questions with 4 options each and select the correct answer"})]}),e.jsxs("button",{type:"button",onClick:M,className:"px-3 sm:px-4 py-2 bg-gradient-to-r from-[#1e3a5f] to-[#2a4a6f] hover:from-[#2a4a6f] hover:to-[#1e3a5f] text-white rounded-lg font-semibold text-xs sm:text-sm transition-all duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Add Question"})]})]}),o.length===0?e.jsxs("div",{className:"bg-white rounded-xl p-8 sm:p-10 md:p-12 border-2 border-dashed border-gray-300 text-center",children:[e.jsx("svg",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),e.jsx("p",{className:"text-gray-500 font-medium text-sm sm:text-base mb-2",children:"No questions added yet"}),e.jsx("p",{className:"text-gray-400 text-xs sm:text-sm",children:'Click "Add Question" to start adding questions to your quiz'})]}):e.jsx("div",{className:"space-y-4 sm:space-y-5",children:o.map((t,a)=>e.jsxs("div",{className:"bg-white rounded-xl p-4 sm:p-5 md:p-6 border-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("h3",{className:"text-sm sm:text-base font-semibold text-gray-900",children:["Question ",a+1]}),o.length>1&&e.jsx("button",{type:"button",onClick:()=>E(a),className:"p-1.5 sm:p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove Question",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Question Text ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{required:!0,value:t.question,onChange:r=>L(a,"question",r.target.value),rows:"3",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 resize-none text-xs sm:text-sm",placeholder:"Enter your question here..."})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 mb-3 sm:mb-4",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Options ",e.jsx("span",{className:"text-red-500",children:"*"})]}),t.options.map((r,l)=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("input",{type:"radio",name:`correctAnswer-${a}`,checked:t.correctAnswer===l,onChange:()=>B(a,l),className:"w-4 h-4 sm:w-5 sm:h-5 text-dvision-blue focus:ring-dvision-blue cursor-pointer"}),e.jsx("input",{type:"text",required:!0,value:r,onChange:d=>T(a,l,d.target.value),className:"flex-1 px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 text-xs sm:text-sm",placeholder:`Option ${l+1}`})]},l))]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select the radio button next to the correct answer"})]},a))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 sm:gap-4 pt-4 sm:pt-6",children:[e.jsx("button",{type:"button",onClick:()=>f("/admin/quizzes"),className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-300 text-gray-700 rounded-lg sm:rounded-xl font-semibold hover:bg-gray-50 transition-all duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:C,className:"w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-2.5 text-xs sm:text-sm bg-gradient-to-r from-[#1e3a5f] to-[#2a4a6f] hover:from-[#2a4a6f] hover:to-[#1e3a5f] text-white rounded-lg font-semibold transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:C?"Creating...":"Add Quiz"})]})]})})]})})};export{V as default};
