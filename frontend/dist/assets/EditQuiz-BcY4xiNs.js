import{u as F,q as R,r as i,j as e}from"./index-BPKQ2keO.js";import{c as W,e as _,q as w}from"./api-BdrZRD_7.js";const O=()=>{const d=F(),{id:m}=R(),[r,c]=i.useState({name:"",board:"",class:"",subjectId:"",status:"Active",isActive:!0}),[n,u]=i.useState([]),[p,A]=i.useState([]),[h,q]=i.useState([]),[k,C]=i.useState([]),[S,g]=i.useState([]),[z,f]=i.useState([]),[x,v]=i.useState(!0),[Q,j]=i.useState(!0),[y,N]=i.useState(!1);i.useEffect(()=>{(async()=>{try{v(!0);const[t,a]=await Promise.all([W.getAll(),_.getAll()]);if(t.success&&t.data?.classes){const l=t.data.classes.filter(b=>b.isActive);A(l);const o=[...new Set(l.map(b=>b.board))].filter(Boolean).sort();C(o)}if(a.success&&a.data?.subjects){const l=a.data.subjects.filter(o=>o.isActive);q(l)}}catch(t){console.error("Error fetching data:",t)}finally{v(!1)}})()},[]),i.useEffect(()=>{m&&(async()=>{try{j(!0);const t=await w.getById(m);if(t.success&&t.data.quiz){const a=t.data.quiz;c({name:a.name||"",board:a.board||"",class:a.classNumber?.toString()||"",subjectId:a.subjectId?._id||a.subjectId||"",status:a.isActive?"Active":"Inactive",isActive:a.isActive!==void 0?a.isActive:!0}),u(a.questions||[])}else alert("Quiz not found"),d("/admin/quiz")}catch(t){console.error("Error fetching quiz:",t),alert("Failed to load quiz. Please try again."),d("/admin/quiz")}finally{j(!1)}})()},[m,d]),i.useEffect(()=>{if(!r.board){g([]);return}const s=p.filter(a=>a.board===r.board).map(a=>a.class),t=[...new Set(s)].sort((a,l)=>a-l);g(t)},[r.board,p]),i.useEffect(()=>{if(!r.board||!r.class){f([]);return}const s=h.filter(t=>t.board===r.board&&t.class===parseInt(r.class));f(s)},[r.board,r.class,h]);const P=()=>{u([...n,{question:"",options:["","","",""],correctAnswer:0}])},E=s=>{if(n.length>1){const t=n.filter((a,l)=>l!==s);u(t)}else alert("At least one question is required")},L=(s,t,a)=>{const l=[...n];l[s][t]=a,u(l)},B=(s,t,a)=>{const l=[...n];l[s].options[t]=a,u(l)},D=(s,t)=>{const a=[...n];a[s].correctAnswer=parseInt(t),u(a)},I=()=>{if(!r.name.trim())return alert("Please enter quiz name"),!1;if(!r.board)return alert("Please select a board"),!1;if(!r.class)return alert("Please select a class"),!1;if(!r.subjectId)return alert("Please select a subject"),!1;if(n.length===0)return alert("Please add at least one question"),!1;for(let s=0;s<n.length;s++){const t=n[s];if(!t.question.trim())return alert(`Please enter question ${s+1}`),!1;for(let a=0;a<4;a++)if(!t.options[a]||!t.options[a].trim())return alert(`Please enter all 4 options for question ${s+1}`),!1}return!0},M=async s=>{if(s.preventDefault(),!!I())try{N(!0);const t={name:r.name.trim(),classNumber:parseInt(r.class),board:r.board,subjectId:r.subjectId,questions:n.map(l=>({question:l.question.trim(),options:l.options.map(o=>o.trim()),correctAnswer:l.correctAnswer})),isActive:r.status==="Active"};(await w.update(m,t)).success&&(alert("Quiz updated successfully!"),d("/admin/quiz"))}catch(t){console.error("Error updating quiz:",t),alert(t.message||"Failed to update quiz. Please try again.")}finally{N(!1)}};return Q?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Loading quiz data..."})}):e.jsx("div",{className:"min-h-screen bg-gray-100",children:e.jsxs("div",{className:"px-2 sm:px-3 md:px-4 lg:px-6 xl:px-8 pt-3 sm:pt-4 md:pt-5 lg:pt-6",children:[e.jsx("div",{className:"px-2 sm:px-3 md:px-4 lg:px-6 xl:px-8 pb-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-gray-900",children:"Edit Quiz"})}),e.jsxs("button",{onClick:()=>d("/admin/quiz"),className:"px-3 sm:px-4 md:px-5 py-2 sm:py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg sm:rounded-xl font-semibold text-xs sm:text-sm md:text-base transition-all duration-200 flex items-center justify-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"Back"})]})]})}),e.jsx("div",{className:"mt-3 sm:mt-4 md:mt-5 lg:mt-6",children:e.jsxs("form",{onSubmit:M,className:"space-y-4 sm:space-y-5 md:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Quiz Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:s=>c({...r,name:s.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 text-sm sm:text-base",placeholder:"Enter quiz name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Board ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.board,onChange:s=>{c({...r,board:s.target.value,class:"",subjectId:""})},disabled:x,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white text-sm sm:text-base disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Board"}),k.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.class,onChange:s=>{c({...r,class:s.target.value,subjectId:""})},disabled:!r.board||x,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white text-sm sm:text-base disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Class"}),S.map(s=>e.jsxs("option",{value:s,children:["Class ",s]},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Subject ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.subjectId,onChange:s=>c({...r,subjectId:s.target.value}),disabled:!r.class||x,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white text-sm sm:text-base disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Subject"}),z.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.status,onChange:s=>c({...r,status:s.target.value,isActive:s.target.value==="Active"}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white text-sm sm:text-base",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-5 md:mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-900",children:["Questions (",n.length,")"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add questions with 4 options each and select the correct answer"})]}),e.jsxs("button",{type:"button",onClick:P,className:"px-3 sm:px-4 py-2 bg-dvision-blue hover:bg-dvision-blue-dark text-white rounded-lg sm:rounded-xl font-semibold text-xs sm:text-sm transition-all duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Add Question"})]})]}),n.length===0?e.jsxs("div",{className:"bg-white rounded-xl p-8 sm:p-10 md:p-12 border-2 border-dashed border-gray-300 text-center",children:[e.jsx("svg",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),e.jsx("p",{className:"text-gray-500 font-medium text-sm sm:text-base mb-2",children:"No questions added yet"}),e.jsx("p",{className:"text-gray-400 text-xs sm:text-sm",children:'Click "Add Question" to start adding questions to your quiz'})]}):e.jsx("div",{className:"space-y-4 sm:space-y-5",children:n.map((s,t)=>e.jsxs("div",{className:"bg-white rounded-xl p-4 sm:p-5 md:p-6 border-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("h3",{className:"text-sm sm:text-base font-semibold text-gray-900",children:["Question ",t+1]}),n.length>1&&e.jsx("button",{type:"button",onClick:()=>E(t),className:"p-1.5 sm:p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove Question",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Question Text ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{required:!0,value:s.question,onChange:a=>L(t,"question",a.target.value),rows:"3",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 resize-none text-sm sm:text-base",placeholder:"Enter your question here..."})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 mb-3 sm:mb-4",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Options ",e.jsx("span",{className:"text-red-500",children:"*"})]}),s.options.map((a,l)=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("input",{type:"radio",name:`correctAnswer-${t}`,checked:s.correctAnswer===l,onChange:()=>D(t,l),className:"w-4 h-4 sm:w-5 sm:h-5 text-dvision-blue focus:ring-dvision-blue cursor-pointer"}),e.jsx("input",{type:"text",required:!0,value:a,onChange:o=>B(t,l,o.target.value),className:"flex-1 px-3 sm:px-4 py-2 sm:py-2.5 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 text-sm sm:text-base",placeholder:`Option ${l+1}`})]},l))]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select the radio button next to the correct answer"})]},t))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 sm:gap-4 pt-4 sm:pt-6",children:[e.jsx("button",{type:"button",onClick:()=>d("/admin/quiz"),className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-300 text-gray-700 rounded-lg sm:rounded-xl font-semibold hover:bg-gray-50 transition-all duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y,className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base bg-dvision-blue hover:bg-dvision-blue-dark text-white rounded-lg sm:rounded-xl font-semibold transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Updating...":"Update Quiz"})]})]})})]})})};export{O as default};
