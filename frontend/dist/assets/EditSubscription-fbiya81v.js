import{u as S,q as E,r as n,j as e}from"./index-BPKQ2keO.js";import{b as P}from"./api-BdrZRD_7.js";const T=()=>{const d=S(),{id:x}=E(),[s,c]=n.useState({type:"regular",name:"",board:"",classes:[],classId:"",duration:"",price:"",originalPrice:"",description:"",features:[],isActive:!0,validityDays:null}),[m,k]=n.useState("regular"),[p,g]=n.useState(""),[f,u]=n.useState(""),[C,h]=n.useState(!0),[y,v]=n.useState(!1),[j,r]=n.useState(""),b=n.useRef(!1);n.useEffect(()=>{D()},[x]);const D=async()=>{try{h(!0),r("");const a=await P.getById(x);if(a.success&&a.data?.subscriptionPlan){const t=a.data.subscriptionPlan,i=t.type||"regular";k(i);const l=t.classId?._id||t.classId||"",w=t.classId?.name||(t.classId&&typeof t.classId=="object"?t.classId.name:"")||"";c({type:i,name:t.name||"",board:t.board||"",classes:t.classes||[],classId:l,duration:t.duration||"",price:t.price?.toString()||"",originalPrice:t.originalPrice?.toString()||"",description:t.description||"",features:t.features||[],isActive:t.isActive!==void 0?t.isActive:!0,validityDays:t.validityDays||null}),g(w),i==="preparation"&&l&&!w&&(console.warn("⚠️ Preparation plan has classId but class name is missing. Class may not exist in database."),g("⚠️ Class Not Found"))}else r("Failed to load subscription plan"),setTimeout(()=>d("/admin/subscriptions"),2e3)}catch(a){r(a.message||"Failed to load subscription plan"),console.error("Error fetching subscription plan:",a),setTimeout(()=>d("/admin/subscriptions"),2e3)}finally{h(!1)}},o=(a,t)=>{c(i=>({...i,[a]:t}))},N=a=>{if(a&&a.preventDefault(),b.current)return;const t=f.trim();t&&(s.features.some(l=>l.trim()===t)?u(""):(b.current=!0,c(l=>({...l,features:[...l.features,t]})),u(""),setTimeout(()=>{b.current=!1},100)))},F=a=>{c(t=>({...t,features:t.features.filter((i,l)=>l!==a)}))},I=async a=>{if(a.preventDefault(),r(""),!s.name){r("Please provide plan name");return}if(s.duration!=="demo"){if(!s.price){r("Please provide price");return}if(parseFloat(s.price)<=0){r("Price must be greater than 0");return}}else if(s.price&&parseFloat(s.price)<0){r("Price cannot be negative");return}if(s.duration==="demo"&&(!s.validityDays||parseInt(s.validityDays)<1)){r("Please provide validity days (must be at least 1) for demo plan");return}v(!0);try{const t={type:m,name:s.name,duration:s.duration,price:s.duration==="demo"?s.price?parseFloat(s.price):0:parseFloat(s.price),originalPrice:s.originalPrice?parseFloat(s.originalPrice):s.duration==="demo"?s.price?parseFloat(s.price):0:parseFloat(s.price),description:s.description||"",features:s.features||[],isActive:s.isActive};s.duration==="demo"&&s.validityDays&&(t.validityDays=parseInt(s.validityDays)),m==="regular"?(t.board=s.board,t.classes=s.classes):t.classId=s.classId;const i=await P.update(x,t);i.success?d("/admin/subscriptions"):r(i.message||"Failed to update subscription plan")}catch(t){r(t.message||"Failed to update subscription plan"),console.error("Error updating subscription plan:",t)}finally{v(!1)}};return C?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-[#1e3a5f]"}),e.jsx("p",{className:"mt-2 sm:mt-3 text-gray-500 text-xs sm:text-sm",children:"Loading subscription plan..."})]})}):e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pt-2 sm:pt-3",children:[e.jsx("div",{className:"pb-1 sm:pb-2",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>d("/admin/subscriptions"),className:"text-[#1e3a5f] hover:text-[#2a4a6f] transition-colors",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsx("h1",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold text-[#1e3a5f]",children:"Edit Subscription Plan"})]})}),j&&e.jsx("div",{className:"mt-2 mb-2 sm:mb-3",children:e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm",children:j})}),e.jsx("div",{className:"mt-2 sm:mt-3",children:e.jsxs("form",{onSubmit:I,className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4 md:p-5 space-y-3 sm:space-y-4",children:[e.jsx("div",{className:`grid grid-cols-1 ${m==="regular"?"md:grid-cols-4":"md:grid-cols-2"} gap-2 sm:gap-3 p-2 sm:p-3 bg-gray-50 rounded-lg border border-gray-200`,children:m==="regular"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-500 mb-0.5 sm:mb-1",children:"Type"}),e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:e.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-[10px] sm:text-xs font-semibold bg-blue-100 text-blue-700",children:"Regular"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-500 mb-0.5 sm:mb-1",children:"Board"}),e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:s.board})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-500 mb-0.5 sm:mb-1",children:"Classes"}),e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:s.classes?.map(a=>`Class ${a}`).join(", ")||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-500 mb-0.5 sm:mb-1",children:"Duration"}),e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900 capitalize",children:s.duration==="half_yearly"?"Half Yearly":s.duration==="demo"?"Demo":s.duration})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-500 mb-0.5 sm:mb-1",children:"Type"}),e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900",children:e.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-[10px] sm:text-xs font-semibold bg-purple-100 text-purple-700",children:"Preparation"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-500 mb-0.5 sm:mb-1",children:"Duration"}),e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900 capitalize",children:s.duration==="half_yearly"?"Half Yearly":s.duration==="demo"?"Demo":s.duration})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-500 mb-0.5 sm:mb-1",children:"Preparation Class"}),e.jsx("div",{className:`text-xs sm:text-sm font-medium ${p.includes("⚠️")?"text-red-600":"text-gray-900"}`,children:p||(s.classId?"⚠️ Class Not Found":"N/A")}),s.classId&&!p&&e.jsx("p",{className:"text-[10px] sm:text-xs text-red-600 mt-0.5",children:"⚠️ Class ID exists but class not found. Please update this plan with a valid class."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.name,onChange:a=>o("name",a.target.value),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200",placeholder:"Enter plan name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1",children:["Price (₹) ",s.duration!=="demo"&&e.jsx("span",{className:"text-red-500",children:"*"}),s.duration==="demo"&&e.jsx("span",{className:"text-gray-500 text-[10px] sm:text-xs",children:"(Optional - Default: Free)"})]}),e.jsx("input",{type:"number",required:s.duration!=="demo",min:"0",step:"0.01",value:s.price||"",onChange:a=>o("price",a.target.value),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200",placeholder:s.duration==="demo"?"Enter price (optional, default: 0)":"Enter price"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1",children:["Original Price (₹) ",e.jsx("span",{className:"text-gray-500 text-[10px] sm:text-xs",children:"(Optional)"})]}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:s.originalPrice,onChange:a=>o("originalPrice",a.target.value),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200",placeholder:"Enter original price (for discount)"})]}),s.duration==="demo"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1",children:["Validity (Days) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",required:!0,min:"1",step:"1",value:s.validityDays||"",onChange:a=>o("validityDays",parseInt(a.target.value)||7),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200",placeholder:"Enter validity in days (e.g., 7, 15, 30)"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1",children:["Description ",e.jsx("span",{className:"text-gray-500 text-[10px] sm:text-xs",children:"(Optional)"})]}),e.jsx("textarea",{value:s.description,onChange:a=>o("description",a.target.value),rows:"3",className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200",placeholder:"Enter plan description"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1",children:["Features ",e.jsx("span",{className:"text-gray-500 text-[10px] sm:text-xs",children:"(Optional)"})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[s.features.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-50 rounded-lg text-xs sm:text-sm",children:a}),e.jsx("button",{type:"button",onClick:()=>F(t),className:"p-1.5 sm:p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:a=>u(a.target.value),onKeyPress:a=>{a.key==="Enter"&&(a.preventDefault(),N(a))},placeholder:"Add a feature",className:"flex-1 px-2 sm:px-3 py-1.5 sm:py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none text-xs sm:text-sm"}),e.jsx("button",{type:"button",onClick:N,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-gradient-to-r from-[#1e3a5f] to-[#2a4a6f] hover:from-[#2a4a6f] hover:to-[#1e3a5f] text-white rounded-lg font-semibold text-xs sm:text-sm transition-all duration-200 shadow-md hover:shadow-lg",children:"Add"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.isActive?"true":"false",onChange:a=>o("isActive",a.target.value==="true"),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3 pt-3 sm:pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>d("/admin/subscriptions"),className:"w-full sm:w-auto px-3 sm:px-4 md:px-6 py-1.5 sm:py-2 text-xs sm:text-sm border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y,className:"w-full sm:w-auto px-3 sm:px-4 md:px-6 py-1.5 sm:py-2 text-xs sm:text-sm bg-gradient-to-r from-[#1e3a5f] to-[#2a4a6f] hover:from-[#2a4a6f] hover:to-[#1e3a5f] text-white rounded-lg font-semibold transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Updating...":"Update Subscription Plan"})]})]})})]})})};export{T as default};
