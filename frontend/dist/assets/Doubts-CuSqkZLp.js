import{u as X,a as G,r as l,$ as E,j as e,c as H,S as K,l as Z,J as C,d as ee,m as se,a0 as te,a1 as ae,a2 as re,T as U,F as le,a3 as me,a4 as ne}from"./index-BPKQ2keO.js";import{B as oe}from"./BottomNav-KrGopomG.js";const ce=()=>{const D=X(),{hasActiveSubscription:T}=G(),[f,q]=l.useState(""),[B,c]=l.useState(!1),[d,x]=l.useState(""),[b,p]=l.useState(""),[y,v]=l.useState(!1),[m,i]=l.useState([]),[j,_]=l.useState([]),[w,N]=l.useState([]),[L,F]=l.useState(!0),[g,I]=l.useState(!1),[P,R]=l.useState(!1),[o,k]=l.useState(1),[S]=l.useState(10),[u,M]=l.useState(1),[$,O]=l.useState(0);l.useEffect(()=>{(async()=>{try{I(!0);const t=await ne.getAllTeachers();if(console.log("Teachers API response:",t),t&&t.success){let r=[];t.data?.teachers&&Array.isArray(t.data.teachers)?r=t.data.teachers:Array.isArray(t.data)?r=t.data:Array.isArray(t.teachers)&&(r=t.teachers);const a=Array.isArray(r)?r.filter(n=>n&&n._id&&n.name):[];console.log("Teachers fetched from API:",a.length),a.length>0&&console.log("Sample teacher:",a[0]),N(a)}else console.error("Failed to fetch teachers - invalid response:",t),N([])}catch(t){console.error("Error fetching teachers:",t),console.error("Error details:",t.message,t.status),N([])}finally{I(!1)}})()},[]),l.useEffect(()=>{A()},[o]),l.useEffect(()=>{k(1);const s=setTimeout(()=>{A()},500);return()=>clearTimeout(s)},[f]);const A=async()=>{try{F(!0);const s={page:o,limit:S,search:f},t=await E.getMyDoubts(s);if(t.success&&t.data.doubts){const r=t.data.doubts.map(a=>({id:a._id,question:a.question,teacher:a.teacherId,status:a.status,date:new Date(a.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}),answer:a.answer||null,answeredBy:a.answeredBy||null,images:a.images||[]}));_(r),M(t.pages||1),O(t.total||0)}}catch(s){console.error("Error fetching doubts:",s)}finally{F(!1)}},z=s=>s,Q=s=>new Promise((t,r)=>{const a=new FileReader;a.onload=()=>{const n=a.result;t(n)},a.onerror=r,a.readAsDataURL(s)}),Y=s=>{switch(s){case"Pending":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"Answered":return"bg-[var(--app-dark-blue)] text-white border-[var(--app-dark-blue)]";case"Resolved":return"bg-green-100 text-green-800 border-green-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},J=s=>{const r=Array.from(s.target.files).filter(n=>n.type.startsWith("image/"));if(r.length+m.length>5){alert("You can attach maximum 5 images");return}const a=r.map(n=>({file:n,preview:URL.createObjectURL(n)}));i([...m,...a])},V=s=>{const t=m.filter((r,a)=>a!==s);URL.revokeObjectURL(m[s].preview),i(t)},W=async()=>{if(!d||!b.trim()){alert("Please select a teacher and enter your question");return}try{R(!0);let s=[];if(m.length>0)for(const a of m)try{const n=await Q(a.file);s.push(n)}catch(n){console.error("Error converting image to base64:",n)}const t={teacherId:d,question:b.trim(),images:s.length>0?s:void 0},r=await E.createDoubt(t);if(r.success)c(!1),x(""),p(""),m.forEach(a=>URL.revokeObjectURL(a.preview)),i([]),await A(),alert("Doubt submitted successfully!");else throw new Error(r.message||"Failed to submit doubt")}catch(s){console.error("Error submitting doubt:",s),alert(s.message||"Failed to submit doubt. Please try again.")}finally{R(!1)}},h=w.find(s=>s._id===d);return e.jsxs("div",{className:"min-h-screen w-full bg-white",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative animate-fade-in",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 pt-3 sm:pt-4 md:pt-6 pb-4 sm:pb-6 md:pb-8",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>D(-1),className:"p-1.5 sm:p-2 text-white hover:bg-white/10 rounded-full transition-colors hover:scale-110",children:e.jsx(H,{className:"text-lg sm:text-xl md:text-2xl"})}),e.jsx("h1",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold animate-slide-in-left",children:"Ask Doubt"})]})})}),e.jsxs("main",{className:"px-3 sm:px-4 md:px-6 py-4 sm:py-5 md:py-6 pb-20 sm:pb-24",children:[e.jsx("div",{className:"mb-4 sm:mb-5 md:mb-6 animate-fade-in",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 sm:left-4 top-1/2 transform -translate-y-1/2",children:e.jsx(K,{className:"text-gray-400 text-sm sm:text-base md:text-lg"})}),e.jsx("input",{type:"text",placeholder:"Search doubts by teacher or question...",value:f,onChange:s=>q(s.target.value),className:"w-full pl-10 sm:pl-12 pr-10 sm:pr-12 py-2.5 sm:py-3 md:py-3.5 rounded-lg sm:rounded-xl bg-white text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[var(--app-dark-blue)]/50 shadow-md border-2 border-gray-200 text-sm sm:text-base"}),e.jsx("div",{className:"absolute right-3 sm:right-4 top-1/2 transform -translate-y-1/2",children:e.jsx(Z,{className:"text-[var(--app-dark-blue)] text-sm sm:text-base md:text-lg"})})]})}),L?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[40vh] py-8 sm:py-10 md:py-12",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 border-4 border-[var(--app-dark-blue)] border-t-transparent rounded-full animate-spin mb-3 sm:mb-4"}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base font-medium",children:"Loading doubts..."})]}):T?j.length>0?e.jsx("div",{className:"space-y-3 sm:space-y-4",children:j.map((s,t)=>e.jsxs("div",{className:`bg-white rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5 shadow-md hover:shadow-lg transition-all duration-200 border border-gray-200 ${t%2===0?"animate-slide-in-left":"animate-slide-in-right"}`,style:{animationDelay:`${t*.15}s`},children:[e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[s.teacher&&e.jsx("div",{className:"mb-2 sm:mb-2.5 md:mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"text-[var(--app-dark-blue)] text-sm"}),e.jsx("span",{className:"inline-block px-2 sm:px-2.5 md:px-3 py-1 sm:py-1.5 rounded-lg text-xs sm:text-sm font-semibold bg-[var(--app-dark-blue)]/10 text-[var(--app-dark-blue)] border border-[var(--app-dark-blue)]/20",children:s.teacher.name}),s.teacher.subjects&&s.teacher.subjects.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.teacher.subjects.join(", "),")"]})]})}),e.jsx("h3",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-800 mb-2 sm:mb-2.5 md:mb-3 leading-tight",children:s.question}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsx("span",{className:`px-2 sm:px-2.5 md:px-3 py-1 sm:py-1.5 rounded-lg text-[10px] sm:text-xs md:text-sm font-bold border ${Y(s.status)}`,children:s.status}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 text-gray-500 text-xs sm:text-sm",children:[e.jsx(se,{className:"text-[var(--app-dark-blue)]"}),e.jsx("span",{className:"font-medium",children:z(s.date)})]})]})]}),s.images&&s.images.length>0&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"flex flex-col gap-1.5 sm:gap-2",children:[s.images.slice(0,3).map((r,a)=>e.jsx("div",{className:"relative",children:e.jsx("img",{src:r,alt:`Doubt image ${a+1}`,className:"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 object-cover rounded-lg border-2 border-gray-200 cursor-pointer hover:opacity-90 transition-opacity shadow-sm",onClick:()=>window.open(r,"_blank")})},a)),s.images.length>3&&e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 rounded-lg border-2 border-gray-200 bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-gray-200 transition-colors",children:e.jsxs("span",{className:"text-[10px] sm:text-xs font-bold text-gray-600",children:["+",s.images.length-3]})})]})})]}),s.answer&&e.jsxs("div",{className:"mt-3 sm:mt-3.5 md:mt-4 p-3 sm:p-3.5 md:p-4 bg-blue-50 rounded-lg sm:rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[e.jsx(C,{className:"text-[var(--app-dark-blue)] text-sm sm:text-base md:text-lg"}),e.jsxs("p",{className:"text-xs sm:text-sm font-bold text-[var(--app-dark-blue)]",children:["Answer",s.answeredBy&&s.answeredBy.name?` by ${s.answeredBy.name}`:"",":"]})]}),e.jsx("p",{className:"text-gray-700 text-xs sm:text-sm md:text-base leading-relaxed",children:s.answer})]})]},s.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[40vh] py-8 sm:py-10 md:py-12 animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 sm:w-18 sm:h-18 md:w-20 md:h-20 bg-[var(--app-dark-blue)]/10 rounded-full flex items-center justify-center mb-4 sm:mb-5 md:mb-6",children:e.jsx(C,{className:"text-[var(--app-dark-blue)] text-3xl sm:text-4xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-800 mb-1.5 sm:mb-2 text-center",children:"No doubts yet"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md text-xs sm:text-sm md:text-base px-3 sm:px-4",children:"Ask your first doubt to get help from expert teachers"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[40vh] py-8 sm:py-10 md:py-12",children:[e.jsx("div",{className:"w-16 h-16 sm:w-18 sm:h-18 md:w-20 md:h-20 bg-[var(--app-dark-blue)]/10 rounded-full flex items-center justify-center mb-4 sm:mb-5 md:mb-6",children:e.jsx(C,{className:"text-[var(--app-dark-blue)] text-3xl sm:text-4xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-800 mb-1.5 sm:mb-2 text-center",children:"No Subscription"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md text-xs sm:text-sm md:text-base px-3 sm:px-4 mb-4",children:"You need an active subscription to ask doubts. Please subscribe to a plan to continue learning."}),e.jsx("button",{onClick:()=>D("/subscription-plans"),className:"bg-[var(--app-dark-blue)] hover:bg-blue-700 text-white font-bold py-2.5 sm:py-3 px-6 sm:px-8 rounded-lg sm:rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl text-xs sm:text-sm md:text-base",children:"View Subscription Plans"})]}),!L&&j.length>0&&e.jsx("div",{className:"mt-4 sm:mt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"text-sm text-gray-500 font-medium",children:["Showing ",e.jsx("span",{className:"font-bold text-gray-900",children:(o-1)*S+1})," to ",e.jsx("span",{className:"font-bold text-gray-900",children:Math.min(o*S,$)})," of ",e.jsx("span",{className:"font-bold text-gray-900",children:$})," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>k(s=>Math.max(1,s-1)),disabled:o===1,className:`p-2 rounded-lg border flex items-center gap-1 transition-all ${o===1?"border-gray-200 text-gray-300 cursor-not-allowed":"border-gray-300 text-gray-700 hover:bg-[var(--app-dark-blue)] hover:text-white hover:border-[var(--app-dark-blue)]"}`,children:[e.jsx(te,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"Previous"})]}),e.jsx("div",{className:"flex items-center gap-1 px-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-3 py-1 rounded-md border border-gray-200",children:["Page ",o," of ",u]})}),e.jsxs("button",{onClick:()=>k(s=>Math.min(u,s+1)),disabled:o===u,className:`p-2 rounded-lg border flex items-center gap-1 transition-all ${o===u?"border-gray-200 text-gray-300 cursor-not-allowed":"border-gray-300 text-gray-700 hover:bg-[var(--app-dark-blue)] hover:text-white hover:border-[var(--app-dark-blue)]"}`,children:[e.jsx("span",{className:"hidden sm:inline font-medium",children:"Next"}),e.jsx(ae,{className:"w-5 h-5"})]})]})]})})]}),T&&e.jsxs("button",{onClick:()=>c(!0),className:"fixed bottom-24 sm:bottom-28 md:bottom-32 right-3 sm:right-4 md:right-6 bg-[var(--app-dark-blue)] text-white font-bold px-4 sm:px-5 md:px-6 py-2.5 sm:py-3 md:py-3.5 rounded-full shadow-xl hover:bg-[var(--app-dark-blue)]/90 hover:shadow-2xl hover:scale-110 transition-all flex items-center gap-1.5 sm:gap-2 z-40 animate-fade-in",children:[e.jsx(re,{className:"text-lg sm:text-xl"}),e.jsx("span",{className:"text-xs sm:text-sm md:text-base",children:"Ask New Doubt"})]}),B&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 px-4 sm:px-6",onClick:()=>{c(!1),x(""),p(""),m.forEach(s=>URL.revokeObjectURL(s.preview)),i([])},children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full shadow-2xl max-h-[90vh] flex flex-col overflow-hidden",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"px-4 sm:px-5 md:px-6 py-3 sm:py-4 md:py-5 border-b border-gray-200 bg-gradient-to-r from-[var(--app-dark-blue)] to-blue-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-white",children:"Ask New Doubt"}),e.jsx("button",{onClick:()=>{c(!1),x(""),p(""),m.forEach(s=>URL.revokeObjectURL(s.preview)),i([])},className:"p-1.5 sm:p-2 text-white hover:bg-white/20 rounded-full transition-colors",children:e.jsx(U,{className:"text-lg sm:text-xl md:text-2xl"})})]})}),e.jsxs("div",{className:"overflow-y-auto flex-1 px-4 sm:px-5 md:px-6 py-4 sm:py-5 md:py-6 space-y-3 sm:space-y-4 md:space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-bold text-gray-800 mb-1.5 sm:mb-2",children:["Select Teacher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>v(!y),disabled:g,className:"w-full flex items-center justify-between px-3 sm:px-4 py-2.5 sm:py-3 md:py-3.5 rounded-lg sm:rounded-xl border-2 border-gray-200 bg-white hover:border-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] transition-all text-left shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:`text-sm sm:text-base font-medium ${d?"text-gray-800":"text-gray-400"}`,children:h?`${h.name}${h.subjects&&h.subjects.length>0?` (${h.subjects.join(", ")})`:""}`:g?"Loading teachers...":"Select Teacher"}),e.jsx(le,{className:`text-gray-400 text-base sm:text-lg md:text-xl transition-transform ${y?"rotate-180":""}`})]}),y&&!g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>v(!1)}),e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1.5 sm:mt-2 bg-white border-2 border-[var(--app-dark-blue)]/30 rounded-lg sm:rounded-xl shadow-2xl z-20 max-h-60 overflow-y-auto",children:w.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 text-center",children:g?"Loading teachers...":"No active teachers available. Please contact admin."}):w.map(s=>e.jsxs("button",{type:"button",onClick:()=>{x(s._id),v(!1)},className:`w-full flex flex-col items-start gap-1 px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 hover:bg-blue-50 transition-colors text-left ${d===s._id?"bg-[var(--app-dark-blue)]/10 font-semibold":""}`,children:[e.jsx("span",{className:`text-sm sm:text-base ${d===s._id?"text-[var(--app-dark-blue)]":"text-gray-700"}`,children:s.name}),s.subjects&&s.subjects.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Subjects: ",s.subjects.join(", ")]})]},s._id))})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-bold text-gray-800 mb-1.5 sm:mb-2",children:["Your Question ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:b,onChange:s=>p(s.target.value),rows:"5",className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 md:py-3.5 rounded-lg sm:rounded-xl border-2 border-gray-200 bg-white focus:outline-none focus:border-[var(--app-dark-blue)] focus:ring-2 focus:ring-[var(--app-dark-blue)]/20 transition-all text-gray-800 resize-none text-sm sm:text-base placeholder-gray-400 shadow-sm",placeholder:"Type your question here in detail...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-bold text-gray-800 mb-1.5 sm:mb-2",children:["Attach Images ",e.jsx("span",{className:"text-gray-400 font-normal text-[10px] sm:text-xs",children:"(Optional, Max 5)"})]}),e.jsx("input",{type:"file",id:"image-upload",accept:"image/*",multiple:!0,onChange:J,className:"hidden"}),e.jsxs("label",{htmlFor:"image-upload",className:"flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2.5 sm:py-3 md:py-3.5 rounded-lg sm:rounded-xl border-2 border-gray-200 bg-white hover:border-[var(--app-dark-blue)] transition-all cursor-pointer shadow-sm",children:[e.jsx(me,{className:"text-[var(--app-dark-blue)] text-base sm:text-lg md:text-xl"}),e.jsx("span",{className:"text-gray-700 font-medium text-sm sm:text-base",children:"Attach Image(s)"})]}),m.length>0&&e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500 mt-1.5 sm:mt-2 font-medium",children:[m.length," image(s) selected"]})]}),m.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-3",children:m.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.preview,alt:`Preview ${t+1}`,className:"w-full h-16 sm:h-18 md:h-20 object-cover rounded-lg border-2 border-gray-200 shadow-sm"}),e.jsx("button",{type:"button",onClick:()=>V(t),className:"absolute -top-1.5 -right-1.5 sm:-top-2 sm:-right-2 w-5 h-5 sm:w-6 sm:h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors shadow-md",children:e.jsx(U,{className:"text-[10px] sm:text-xs"})})]},t))})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 p-4 sm:p-5 md:p-6 pt-3 sm:pt-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),x(""),p(""),m.forEach(s=>URL.revokeObjectURL(s.preview)),i([])},className:"flex-1 bg-gray-200 text-gray-800 font-bold py-2.5 sm:py-3 md:py-3.5 rounded-lg sm:rounded-xl hover:bg-gray-300 transition-colors text-xs sm:text-sm md:text-base shadow-sm",children:"Cancel"}),e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),W()},disabled:P||!d||!b.trim(),className:"flex-1 bg-[var(--app-dark-blue)] text-white font-bold py-2.5 sm:py-3 md:py-3.5 rounded-lg sm:rounded-xl hover:bg-[var(--app-dark-blue)]/90 transition-colors text-xs sm:text-sm md:text-base shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-[var(--app-dark-blue)]",children:P?"Submitting...":"Submit Doubt"})]})]})}),e.jsx(oe,{})]})};export{ce as default};
