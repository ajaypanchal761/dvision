import{r as a,j as e,a0 as k,a1 as C}from"./index-BPKQ2keO.js";import{t as E,d as I}from"./api-BdrZRD_7.js";const Y=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],O=()=>{const d=new Date,[u,i]=a.useState([]),[o,g]=a.useState(""),[n,f]=a.useState(d.getFullYear()),[c,b]=a.useState(d.getMonth()),[w,h]=a.useState([]),[A,j]=a.useState(!1),[p,y]=a.useState("");a.useEffect(()=>{(async()=>{try{const t=await E.getAll();if(t.success&&t.data){const r=Array.isArray(t.data)?t.data:Array.isArray(t.data.teachers)?t.data.teachers:[];i(r),r.length>0&&g(l=>l||r[0]._id)}else i([])}catch(t){console.error("Error fetching teachers:",t),i([])}})()},[]),a.useEffect(()=>{(async()=>{if(o)try{j(!0),y("");const t=await I.getMonthlyForTeacher(o,n,c+1);t.success&&t.data?.records?h(t.data.records):h([])}catch(t){console.error("Error fetching teacher attendance:",t),y(t.message||"Failed to load attendance"),h([])}finally{j(!1)}})()},[o,n,c]);const D=new Date(n,c,1),S=new Date(n,c+1,0).getDate(),M=s=>{const t=new Date(n,c,s);if(t>d)return"";const r=t.getFullYear(),l=t.getMonth(),m=t.getDate();return w.find(v=>{const x=new Date(v.date);return x.getFullYear()===r&&x.getMonth()===l&&x.getDate()===m&&v.status==="present"})?"P":"A"},T=()=>{b(s=>s===0?(f(t=>t-1),11):s-1)},F=()=>{b(s=>s===11?(f(t=>t+1),0):s+1)},P=new Date(n,c,1).toLocaleDateString("en-IN",{month:"long",year:"numeric"});return e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Teacher Attendance"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Teacher"}),e.jsxs("select",{value:o,onChange:s=>g(s.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-(--app-dark-blue)",children:[u.length===0&&e.jsx("option",{value:"",children:"No teachers found"}),u.map(s=>e.jsxs("option",{value:s._id,children:[s.name," (",s.phone,")"]},s._id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:T,className:"h-8 w-8 flex items-center justify-center rounded-full border border-gray-300 bg-white text-[var(--app-dark-blue)] hover:bg-blue-50 shadow-sm","aria-label":"Previous month",children:e.jsx(k,{className:"text-base"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:P}),e.jsx("button",{onClick:F,className:"h-8 w-8 flex items-center justify-center rounded-full border border-gray-300 bg-white text-[var(--app-dark-blue)] hover:bg-blue-50 shadow-sm","aria-label":"Next month",children:e.jsx(C,{className:"text-base"})})]})]}),p&&e.jsx("div",{className:"mb-4 text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg p-3",children:p}),A?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-(--app-dark-blue)"})}):o?e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"inline-flex items-center mr-4",children:[e.jsx("span",{className:"inline-block w-3 h-3 rounded-full bg-green-400 mr-1"})," P = Present"]}),e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx("span",{className:"inline-block w-3 h-3 rounded-full bg-red-300 mr-1"})," A = Absent"]})]})}),e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2 text-xs font-semibold text-center text-gray-600",children:Y.map(s=>e.jsx("div",{children:s},s))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-xs",children:[Array.from({length:D.getDay()}).map((s,t)=>e.jsx("div",{className:"h-8"},`empty-${t}`)),Array.from({length:S}).map((s,t)=>{const r=t+1,l=M(r),m=l==="P",N=new Date(n,c,r)>d;return e.jsxs("div",{className:`h-8 flex flex-col items-center justify-center rounded-lg border
                      ${N?"bg-white border-gray-200 text-gray-500":m?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-300 text-red-600"}`,children:[e.jsx("span",{className:"font-semibold",children:r}),l&&e.jsx("span",{className:"text-[10px] font-bold",children:l})]},r)})]})]})]}):e.jsx("div",{className:"text-gray-600 py-8 text-center",children:"Please select a teacher to view attendance."})]})};export{O as default};
