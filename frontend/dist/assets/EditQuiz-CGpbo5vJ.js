import{u as J,q as K,r as n,j as e,a2 as X,y as Y}from"./index-BPKQ2keO.js";import{c as Z,e as w,q as k}from"./api-BdrZRD_7.js";const te=()=>{const x=J(),{id:h}=K(),[s,o]=n.useState({type:"regular",quizName:"",board:"",class:"",classId:"",subjectId:"",status:"Active",deadlineDate:"",deadlineTime:"12:00",deadlineAmPm:"AM"}),[d,b]=n.useState([{question:"",options:["","","",""],correctAnswer:0}]),[N,Q]=n.useState([]),[S,E]=n.useState([]),[M,T]=n.useState([]),[q,B]=n.useState([]),[_,y]=n.useState([]),[A,j]=n.useState([]),[C,p]=n.useState([]),[g,z]=n.useState(!0),[F,I]=n.useState(!0),[P,D]=n.useState(!1);n.useEffect(()=>{(async()=>{try{z(!0);const[r,a]=await Promise.all([Z.getAll(),w.getAll()]);if(r.success&&r.data?.classes){const l=r.data.classes.filter(i=>i.isActive);Q(l);const c=l.filter(i=>i.type==="regular"),m=l.filter(i=>i.type==="preparation"),u=[...new Set(c.map(i=>i.board).filter(Boolean))].sort();T(u),B(m)}if(a.success&&a.data?.subjects){const l=a.data.subjects.filter(c=>c.isActive);E(l)}}catch(r){console.error("Error fetching data:",r)}finally{z(!1)}})()},[]);const $=t=>{if(!t)return!1;const r=new Date,a=new Date(t);return r>=a};n.useEffect(()=>{h&&(async()=>{try{I(!0);const r=await k.getById(h);if(r.success&&r.data.quiz){const a=r.data.quiz;if($(a.deadline)){alert("Cannot edit quiz after deadline has passed."),x("/admin/quizzes");return}let l="",c="12:00",m="AM";if(a.deadline){const i=new Date(a.deadline);l=i.toISOString().split("T")[0];const f=i.getHours(),v=i.getMinutes(),G=f%12||12;c=`${String(G).padStart(2,"0")}:${String(v).padStart(2,"0")}`,m=f>=12?"PM":"AM"}const u=a.classId?._id||a.classId;if(o({type:a.type||"regular",quizName:a.name||"",board:a.board||"",class:a.classNumber?.toString()||"",classId:u?.toString()||"",subjectId:a.subjectId?._id||a.subjectId||"",status:a.isActive?"Active":"Inactive",deadlineDate:l,deadlineTime:c,deadlineAmPm:m}),a.type==="preparation"&&u)try{const i=await w.getAll({classId:u.toString()});if(i.success&&i.data?.subjects){const f=i.data.subjects.filter(v=>v.isActive);p(f)}}catch(i){console.error("Error fetching preparation subjects on load:",i)}b(a.questions&&a.questions.length>0?a.questions:[{question:"",options:["","","",""],correctAnswer:0}])}else alert("Quiz not found"),x("/admin/quizzes")}catch(r){console.error("Error fetching quiz:",r),alert("Failed to load quiz. Please try again."),x("/admin/quizzes")}finally{I(!1)}})()},[h,x]),n.useEffect(()=>{if(s.type!=="regular"){y([]);return}if(!s.board){y([]);return}const t=N.filter(a=>a.type==="regular"&&a.board===s.board).map(a=>a.class),r=[...new Set(t)].sort((a,l)=>a-l);y(r)},[s.type,s.board,N]),n.useEffect(()=>{if(s.type!=="regular"){j([]);return}if(!s.board||!s.class){j([]);return}const t=S.filter(r=>r.board===s.board&&r.class===parseInt(s.class));j(t)},[s.type,s.board,s.class,S]),n.useEffect(()=>{if(s.type!=="preparation"||!s.classId){p([]),s.classId===""&&o(r=>({...r,subjectId:""}));return}(async()=>{try{const r=await w.getAll({classId:s.classId});if(r.success&&r.data?.subjects){const a=r.data.subjects.filter(l=>l.isActive);p(a),s.subjectId&&!a.find(l=>l._id===s.subjectId)&&o(l=>({...l,subjectId:""}))}else p([])}catch(r){console.error("Error fetching preparation subjects:",r),p([])}})()},[s.type,s.classId]);const L=()=>{b([...d,{question:"",options:["","","",""],correctAnswer:0}])},R=t=>{d.length>1?b(d.filter((r,a)=>a!==t)):alert("At least one question is required")},O=(t,r,a)=>{const l=[...d];l[t][r]=a,b(l)},H=(t,r,a)=>{const l=[...d];l[t].options[r]=a,b(l)},U=(t,r)=>{const a=[...d];a[t].correctAnswer=parseInt(r),b(a)},V=()=>{if(!s.quizName.trim())return alert("Please enter quiz name"),!1;if(s.type==="regular"){if(!s.board)return alert("Please select a board"),!1;if(!s.class)return alert("Please select a class"),!1}else if(s.type==="preparation"&&!s.classId)return alert("Please select a preparation class"),!1;if(!s.subjectId)return alert("Please select a subject"),!1;if(d.length===0)return alert("Please add at least one question"),!1;for(let t=0;t<d.length;t++){const r=d[t];if(!r.question.trim())return alert(`Please enter question ${t+1}`),!1;for(let a=0;a<4;a++)if(!r.options[a]||!r.options[a].trim())return alert(`Please enter all 4 options for question ${t+1}`),!1}return!0},W=async t=>{if(t.preventDefault(),!!V())try{D(!0);let r=null;if(s.deadlineDate&&s.deadlineTime){const[c,m]=s.deadlineTime.split(":");let u=parseInt(c);s.deadlineAmPm==="PM"&&u!==12?u+=12:s.deadlineAmPm==="AM"&&u===12&&(u=0),r=new Date(`${s.deadlineDate}T${String(u).padStart(2,"0")}:${m}`).toISOString()}const a={name:s.quizName.trim(),type:s.type,subjectId:s.subjectId,isActive:s.status==="Active",deadline:r,questions:d.map(c=>({question:c.question.trim(),options:c.options.map(m=>m.trim()),correctAnswer:c.correctAnswer}))};s.type==="regular"?(a.classNumber=parseInt(s.class),a.board=s.board):s.type==="preparation"&&(a.classId=s.classId),(await k.update(h,a)).success&&(alert("Quiz updated successfully!"),x("/admin/quizzes"))}catch(r){console.error("Error updating quiz:",r),alert(r.message||"Failed to update quiz. Please try again.")}finally{D(!1)}};return F?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Loading quiz details..."})}):e.jsx("div",{className:"min-h-screen bg-gray-100",children:e.jsxs("div",{className:"px-2 sm:px-3 md:px-4 lg:px-6 xl:px-8 pt-3 sm:pt-4 md:pt-5 lg:pt-6",children:[e.jsx("div",{className:"px-2 sm:px-3 md:px-4 lg:px-6 xl:px-8 pb-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-gray-900",children:"Edit Quiz"})}),e.jsxs("button",{onClick:()=>x("/admin/quizzes"),className:"px-3 sm:px-4 md:px-5 py-2 sm:py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg sm:rounded-xl font-semibold text-xs sm:text-sm md:text-base transition-all duration-200 flex items-center justify-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"Back"})]})]})}),e.jsx("div",{className:"mt-3 sm:mt-4 md:mt-5 lg:mt-6",children:e.jsxs("form",{onSubmit:W,className:"space-y-4 sm:space-y-5 md:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Quiz Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.type,onChange:t=>o({...s,type:t.target.value,board:"",class:"",classId:"",subjectId:""}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white text-sm sm:text-base",children:[e.jsx("option",{value:"regular",children:"Regular Class"}),e.jsx("option",{value:"preparation",children:"Preparation Class"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Quiz Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.quizName,onChange:t=>o({...s,quizName:t.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 text-sm sm:text-base",placeholder:"Enter quiz name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3 sm:gap-4",children:[s.type==="regular"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Board ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.board,onChange:t=>{o({...s,board:t.target.value,class:"",subjectId:""})},disabled:g,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed text-sm sm:text-base",children:[e.jsx("option",{value:"",children:"Select Board"}),M.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),s.type==="preparation"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Preparation Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.classId,onChange:t=>{o({...s,classId:t.target.value,subjectId:""})},disabled:g||q.length===0,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed text-sm sm:text-base",children:[e.jsx("option",{value:"",children:"Select Preparation Class"}),q.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),s.type==="regular"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.class,onChange:t=>{o({...s,class:t.target.value,subjectId:""})},disabled:!s.board||g,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed text-sm sm:text-base",children:[e.jsx("option",{value:"",children:"Select Class"}),_.map(t=>e.jsxs("option",{value:t,children:["Class ",t]},t))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Subject ",e.jsx("span",{className:"text-red-500",children:"*"})]}),s.type==="regular"?e.jsxs("select",{required:!0,value:s.subjectId,onChange:t=>o({...s,subjectId:t.target.value}),disabled:!s.class||g||A.length===0,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed text-sm sm:text-base",children:[e.jsx("option",{value:"",children:s.class?"Select Subject":"Select Class First"}),A.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}):e.jsxs("select",{required:!0,value:s.subjectId,onChange:t=>o({...s,subjectId:t.target.value}),disabled:!s.classId||g||C.length===0,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed text-sm sm:text-base",children:[e.jsx("option",{value:"",children:s.classId?"Select Subject":"Select Preparation Class First"}),C.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.status,onChange:t=>o({...s,status:t.target.value}),className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:"Deadline"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"date",value:s.deadlineDate,onChange:t=>o({...s,deadlineDate:t.target.value}),className:"w-32 sm:w-36 md:w-40 px-2 sm:px-3 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200",placeholder:"Select Date"}),e.jsx("input",{type:"time",value:s.deadlineTime,onChange:t=>o({...s,deadlineTime:t.target.value}),className:"w-28 sm:w-32 md:w-36 px-2 sm:px-3 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200",placeholder:"Select Time"}),e.jsxs("select",{value:s.deadlineAmPm,onChange:t=>o({...s,deadlineAmPm:t.target.value}),className:"w-16 sm:w-20 px-2 sm:px-3 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 bg-white",disabled:!s.deadlineDate,children:[e.jsx("option",{value:"AM",children:"AM"}),e.jsx("option",{value:"PM",children:"PM"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select date and time for quiz deadline (optional)"})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-5 md:mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-900",children:["Questions (",d.length,")"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add questions with 4 options each and select the correct answer"})]}),e.jsxs("button",{type:"button",onClick:L,className:"px-3 sm:px-4 py-2 bg-dvision-blue hover:bg-dvision-blue-dark text-white rounded-lg sm:rounded-xl font-semibold text-xs sm:text-sm transition-all duration-200 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Question"})]})]}),d.length===0?e.jsxs("div",{className:"bg-white rounded-xl p-8 sm:p-10 md:p-12 border-2 border-dashed border-gray-300 text-center",children:[e.jsx("svg",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),e.jsx("p",{className:"text-gray-500 font-medium text-sm sm:text-base mb-2",children:"No questions added yet"}),e.jsx("p",{className:"text-gray-400 text-xs sm:text-sm",children:'Click "Add Question" to start adding questions to your quiz'})]}):e.jsx("div",{className:"space-y-4 sm:space-y-5",children:d.map((t,r)=>e.jsxs("div",{className:"bg-white rounded-xl p-4 sm:p-5 md:p-6 border-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("h3",{className:"text-sm sm:text-base font-semibold text-gray-900",children:["Question ",r+1]}),d.length>1&&e.jsx("button",{type:"button",onClick:()=>R(r),className:"p-1.5 sm:p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove Question",children:e.jsx(Y,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Question Text ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{required:!0,value:t.question,onChange:a=>O(r,"question",a.target.value),rows:"3",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 resize-none text-sm sm:text-base",placeholder:"Enter your question here..."})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 mb-3 sm:mb-4",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Options ",e.jsx("span",{className:"text-red-500",children:"*"})]}),t.options.map((a,l)=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("input",{type:"radio",name:`correctAnswer-${r}`,checked:t.correctAnswer===l,onChange:()=>U(r,l),className:"w-4 h-4 sm:w-5 sm:h-5 text-dvision-blue focus:ring-dvision-blue cursor-pointer"}),e.jsx("input",{type:"text",required:!0,value:a,onChange:c=>H(r,l,c.target.value),className:"flex-1 px-3 sm:px-4 py-2 sm:py-2.5 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-dvision-blue focus:border-dvision-blue outline-none transition-all duration-200 text-sm sm:text-base",placeholder:`Option ${l+1}`})]},l))]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select the radio button next to the correct answer"})]},r))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 sm:gap-4 pt-4 sm:pt-6",children:[e.jsx("button",{type:"button",onClick:()=>x("/admin/quizzes"),className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base border-2 border-gray-300 text-gray-700 rounded-lg sm:rounded-xl font-semibold hover:bg-gray-50 transition-all duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:P,className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm md:text-base bg-dvision-blue hover:bg-dvision-blue-dark text-white rounded-lg sm:rounded-xl font-semibold transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:P?"Updating...":"Update Quiz"})]})]})})]})})};export{te as default};
