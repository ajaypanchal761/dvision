import{u as Y,r as o,j as e,F as J}from"./index-BPKQ2keO.js";import{c as Q,s as q,b as P}from"./api-BdrZRD_7.js";const te=()=>{const g=Y(),[s,d]=o.useState({image:null,imagePreview:null,name:"",email:"",mobile:"",class:"",board:"",password:"",status:"Active",subscriptionStatus:"none",selectedPlanId:"",prepSubscriptions:{}}),[c,x]=o.useState(!1),[S,u]=o.useState(""),[k,A]=o.useState([]),[p,I]=o.useState([]),[B,R]=o.useState([]),[X,U]=o.useState({}),[b,E]=o.useState(!0),[h,z]=o.useState("+91"),[L,y]=o.useState(!1),[W,$]=o.useState([]),[v,f]=o.useState([]),[Z,j]=o.useState([]),[w,D]=o.useState(!1),[F,M]=o.useState(!1),[_,H]=o.useState([]),[O,N]=o.useState({}),T=[{code:"+91",country:"India",countryCode:"IN",flag:"ðŸ‡®ðŸ‡³"},{code:"+1",country:"USA",countryCode:"US",flag:"ðŸ‡ºðŸ‡¸"},{code:"+44",country:"UK",countryCode:"GB",flag:"ðŸ‡¬ðŸ‡§"},{code:"+61",country:"Australia",countryCode:"AU",flag:"ðŸ‡¦ðŸ‡º"},{code:"+971",country:"UAE",countryCode:"AE",flag:"ðŸ‡¦ðŸ‡ª"}];o.useEffect(()=>{(async()=>{try{E(!0);const a=await Q.getAllWithoutPagination({isActive:!0});if(a.success&&a.data?.classes){const n=a.data.classes;R(n);const l={};n.filter(i=>i.type==="preparation").forEach(i=>{l[i._id]=i.name||i.classCode||"Preparation Class"}),U(l);const m=[...new Set(n.filter(i=>i.type==="regular").map(i=>i.board))].filter(Boolean).sort();A(m)}const r=await q.getAll();if(r.success&&r.data?.students){const n=r.data.students.map(l=>l.phone||"").filter(Boolean);$(n)}}catch(a){console.error("Error fetching data:",a),A([])}finally{E(!1)}})()},[]),o.useEffect(()=>{if(!s.board){I([]),d(r=>({...r,class:""}));return}const t=s.board.trim(),a=[...new Set(B.filter(r=>(r.board||"").trim().toLowerCase()===t.toLowerCase()&&r.type==="regular"&&r.class!=null).map(r=>parseInt(r.class)).filter(r=>!isNaN(r)&&r>=1&&r<=12))].sort((r,n)=>r-n);if(I(a),s.class){const r=parseInt(s.class);a.includes(r)||d(n=>({...n,class:""}))}},[s.board,B,s.class]),o.useEffect(()=>{(async()=>{if(s.subscriptionStatus==="active"&&s.class&&s.board)try{D(!0);const a=parseInt(s.class),r=await P.getAll({class:a,board:s.board,isActive:!0,type:"regular"});if(r.success&&(r.data?.plans||r.data?.subscriptionPlans)){const n=r.data.plans||r.data.subscriptionPlans||[];f(n)}else f([])}catch(a){console.error("Error fetching subscription plans:",a),f([])}finally{D(!1)}else f([]),d(a=>({...a,selectedPlanId:""}))})()},[s.subscriptionStatus,s.class,s.board]),o.useEffect(()=>{(async()=>{try{M(!0);const a=await P.getPreparationClasses(!0);if(a.success&&a.data?.classes){const n=a.data.classes.filter(l=>l.isActive!==!1);H(n)}const r=await P.getAll({type:"preparation",isActive:!0});if(r.success&&(r.data?.plans||r.data?.subscriptionPlans)){const n=r.data.plans||r.data.subscriptionPlans||[];j(n);const l={};n.forEach(m=>{const i=m.classId?._id||m.classId;if(i){const C=i.toString();l[C]||(l[C]=[]),l[C].push(m)}}),N(l)}else j([]),N({})}catch(a){console.error("Error fetching preparation data:",a),j([]),N({})}finally{M(!1)}})()},[]);const G=t=>{const a=t.target.files[0];if(a){const r=new FileReader;r.onloadend=()=>{d({...s,image:a,imagePreview:r.result})},r.readAsDataURL(a)}},K=async t=>{t.preventDefault(),u(""),x(!0);try{const a=s.mobile.replace(/\D/g,"");if(!a||a.length<10){u("Please enter a valid mobile number (minimum 10 digits)"),x(!1);return}if(a.length>15){u("Mobile number cannot exceed 15 digits"),x(!1);return}const r=`${h}${a}`;if(W.includes(r)){u("This mobile number is already registered. Please use a different number."),x(!1);return}const n=parseInt(s.class);if(isNaN(n)||!p.includes(n))throw new Error("Please select a valid class for the selected board");if(s.password&&s.password.length<6){u("Password must be at least 6 characters long"),x(!1);return}const l={name:s.name.trim(),phone:r,email:s.email?s.email.trim():"",class:n,board:s.board.trim(),isActive:s.status==="Active"};s.password&&(l.password=s.password),s.subscriptionStatus==="active"&&s.selectedPlanId&&(l.subscriptionPlanId=s.selectedPlanId);const m=Object.values(s.prepSubscriptions||{}).filter(Boolean);m.length>0&&(l.preparationPlanIds=m),s.imagePreview&&(l.profileImageBase64=s.imagePreview);const i=await q.create(l);i.success?g("/admin/students"):u(i.message||"Failed to create student")}catch(a){u(a.message||"Failed to create student. Please try again."),console.error("Error creating student:",a)}finally{x(!1)}},V=t=>t?t.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2):"ST";return e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pt-2 sm:pt-3",children:[e.jsx("div",{className:"pb-1 sm:pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>g("/admin/students"),className:"p-1 text-[#1e3a5f] hover:text-[#2a4a6f] transition-all duration-200 flex items-center justify-center",title:"Back",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsx("h1",{className:"text-sm sm:text-base md:text-lg font-bold text-[#1e3a5f]",children:"Add New Student"})]})}),S&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-xs sm:text-sm mt-2",children:S}),e.jsx("div",{className:"mt-2 sm:mt-3",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-3 sm:p-4 md:p-5",children:e.jsxs("form",{onSubmit:K,className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center py-2 sm:py-3",children:e.jsxs("div",{className:"relative",children:[s.imagePreview?e.jsx("img",{src:s.imagePreview,alt:"Preview",className:"h-24 w-24 sm:h-28 sm:w-28 md:h-32 md:w-32 lg:h-36 lg:w-36 rounded-full object-cover border-4 border-[#1e3a5f] shadow-lg"}):e.jsx("div",{className:"h-24 w-24 sm:h-28 sm:w-28 md:h-32 md:w-32 lg:h-36 lg:w-36 rounded-full bg-linear-to-br from-[#1e3a5f] to-[#2a4a6f] flex items-center justify-center border-4 border-[#1e3a5f] shadow-lg",children:e.jsx("span",{className:"text-white font-bold text-xl sm:text-2xl md:text-3xl",children:V(s.name)})}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-linear-to-r from-[#1e3a5f] to-[#2a4a6f] hover:from-[#2a4a6f] hover:to-[#1e3a5f] text-white rounded-full p-2 sm:p-3 md:p-4 cursor-pointer transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-110",children:[e.jsxs("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:G,className:"hidden"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.name,onChange:t=>d({...s,name:t.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 text-sm sm:text-base",placeholder:"Enter full name",disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:"Email"}),e.jsx("input",{type:"email",value:s.email,onChange:t=>d({...s,email:t.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 text-sm sm:text-base",placeholder:"Enter email address",disabled:c})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Password ",e.jsx("span",{className:"text-gray-500 text-[10px]",children:"(Optional - min 6 characters)"})]}),e.jsx("input",{type:"password",value:s.password,onChange:t=>d({...s,password:t.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 text-sm sm:text-base",placeholder:"Enter password (optional)",disabled:c,minLength:6}),s.password&&s.password.length>0&&s.password.length<6&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Password must be at least 6 characters"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Mobile ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative flex items-stretch",children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsxs("button",{type:"button",onClick:()=>y(!L),className:"flex items-center justify-center gap-1.5 px-3 sm:px-4 h-full rounded-l-lg sm:rounded-l-xl border-2 border-r-0 border-gray-200 bg-gray-50 hover:bg-gray-100 transition-colors min-h-[42px] sm:min-h-[44px] md:min-h-[48px] w-auto",children:[e.jsx("span",{className:"text-gray-700 font-medium text-xs sm:text-sm whitespace-nowrap",children:h}),e.jsx(J,{className:"text-gray-500 text-xs sm:text-sm shrink-0"})]}),L&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>y(!1)}),e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border-2 border-gray-200 rounded-lg sm:rounded-xl shadow-2xl z-20 max-h-60 overflow-y-auto w-48 sm:w-56",children:T.map(t=>e.jsxs("button",{type:"button",onClick:()=>{z(t.code),y(!1)},className:`w-full flex items-center gap-2 md:gap-3 px-3 md:px-4 py-2.5 md:py-3 hover:bg-gray-50 transition-colors ${h===t.code?"bg-[#1e3a5f]/10":""}`,children:[e.jsx("span",{className:"text-gray-700 font-bold text-xs md:text-sm w-6 md:w-8",children:t.countryCode}),e.jsx("span",{className:"text-gray-700 font-medium text-xs md:text-sm",children:t.code}),e.jsx("span",{className:"text-gray-500 text-[10px] md:text-xs ml-auto",children:t.country})]},t.code))})]})]}),e.jsx("input",{type:"tel",required:!0,value:s.mobile,onChange:t=>{const a=t.target.value.replace(/\D/g,"").slice(0,15);d({...s,mobile:a})},autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:"false",inputMode:"numeric",className:"flex-1 pl-3 sm:pl-4 pr-3 sm:pr-4 py-2 sm:py-2.5 md:py-3 rounded-r-lg sm:rounded-r-xl border-2 border-gray-200 bg-gray-50 focus:outline-none focus:border-[#1e3a5f] focus:ring-2 focus:ring-[#1e3a5f]/20 focus:bg-white transition-all text-sm sm:text-base text-gray-700 placeholder:text-gray-400 h-full min-h-[42px] sm:min-h-[44px] md:min-h-[48px]",placeholder:"Enter mobile number",disabled:c})]}),s.mobile&&s.mobile.length<10&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Mobile number must be at least 10 digits"}),s.mobile&&s.mobile.length>15&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Mobile number cannot exceed 15 digits"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Board ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.board,onChange:t=>{d({...s,board:t.target.value,class:""})},className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white text-sm sm:text-base",disabled:c||b,children:[e.jsx("option",{value:"",children:"Select Board"}),k.map(t=>e.jsx("option",{value:t,children:t},t))]}),b&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Loading boards..."}),!b&&k.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"No boards available. Please create classes first."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.class,onChange:t=>d({...s,class:t.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white text-sm sm:text-base",disabled:c||!s.board||p.length===0,children:[e.jsx("option",{value:"",children:s.board?"Select Class":"Select Board First"}),p.map(t=>e.jsxs("option",{value:t,children:["Class ",t]},t))]}),s.board&&p.length===0&&!b&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["No classes available for ",s.board,". Please create a class-board combination first."]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.status,onChange:t=>d({...s,status:t.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 md:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white text-sm sm:text-base",disabled:c,children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-700 mb-0.5 sm:mb-1",children:["Subscription Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.subscriptionStatus,onChange:t=>d({...s,subscriptionStatus:t.target.value,selectedPlanId:""}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-200 rounded-lg focus:ring-1 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white text-[10px] sm:text-xs",disabled:c,children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"active",children:"Active"})]})]}),s.subscriptionStatus==="active"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-700 mb-0.5 sm:mb-1",children:["Subscription Plan ",!s.class||!s.board?"(Select Class & Board First)":""]}),e.jsxs("select",{value:s.selectedPlanId,onChange:t=>d({...s,selectedPlanId:t.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-200 rounded-lg focus:ring-1 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white text-[10px] sm:text-xs",disabled:c||!s.class||!s.board||w,children:[e.jsx("option",{value:"",children:w?"Loading plans...":!s.class||!s.board?"Select Class & Board First":v.length===0?"No plans available":"Select Subscription Plan"}),v.map(t=>e.jsxs("option",{value:t._id,children:[t.name," - â‚¹",t.price," (",t.duration,")"]},t._id))]}),s.class&&s.board&&v.length===0&&!w&&e.jsxs("p",{className:"text-[9px] text-gray-500 mt-0.5",children:["No subscription plans available for Class ",s.class," - ",s.board]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-700 mb-1",children:"Preparation Subscriptions (optional)"}),e.jsx("p",{className:"text-[10px] text-gray-500 mb-1",children:"Assign one subscription per preparation class. You can assign multiple subscriptions for different preparation classes."}),F?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Loading preparation classes..."})}):_.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-gray-500",children:"No preparation classes available"})}):e.jsx("div",{className:"space-y-3",children:_.map(t=>{const a=t._id?.toString()||t._id,r=O[a]||[],n=s.prepSubscriptions[a]||"";return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-2 sm:p-3",children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-semibold text-gray-700 mb-1.5",children:t.name||t.classCode||"Preparation Class"}),e.jsxs("select",{value:n,onChange:l=>{const m={...s.prepSubscriptions};l.target.value?m[a]=l.target.value:delete m[a],d(i=>({...i,prepSubscriptions:m}))},className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-200 rounded-lg focus:ring-1 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white text-[10px] sm:text-xs",disabled:c||F,children:[e.jsx("option",{value:"",children:"No subscription"}),r.map(l=>e.jsxs("option",{value:l._id,children:[l.name," - â‚¹",l.price," (",l.duration,")"]},l._id))]}),r.length===0&&e.jsx("p",{className:"text-[9px] text-gray-400 mt-1",children:"No subscriptions available for this class"})]},a)})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3 pt-3 sm:pt-4 border-t-2 border-gray-100",children:[e.jsx("button",{type:"button",onClick:()=>g("/admin/students"),disabled:c,className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2 sm:py-2.5 md:py-3 border-2 border-gray-300 text-gray-700 rounded-lg sm:rounded-xl font-semibold text-sm sm:text-base hover:bg-gray-50 transition-all duration-200 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c,className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2 sm:py-2.5 md:py-3 bg-linear-to-r from-[#1e3a5f] to-[#2a4a6f] hover:from-[#2a4a6f] hover:to-[#1e3a5f] text-white rounded-lg sm:rounded-xl font-semibold text-sm sm:text-base transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50",children:c?"Creating...":"Add Student"})]})]})})})]})})};export{te as default};
