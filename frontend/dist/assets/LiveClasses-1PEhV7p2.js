import{u as H,a as _,r as c,p as Y,j as e,c as z,R as B,Q as M,S as Q,T as E,l as N,h as $,m as o,D as V}from"./index-BPKQ2keO.js";import{B as J}from"./BottomNav-KrGopomG.js";const U=()=>{const x=H(),{hasActiveSubscription:F}=_(),[b,v]=c.useState([]),[C,y]=c.useState(!0),[w,S]=c.useState(""),[h,k]=c.useState(""),[l,D]=c.useState(null),[T,f]=c.useState(!1);c.useEffect(()=>{I()},[l]),c.useEffect(()=>{const s=setTimeout(()=>{I()},500);return()=>clearTimeout(s)},[h]);const I=async()=>{try{y(!0),S("");let s=null;if(l)if(typeof l=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(l))s=l;else{const r=new Date(l),t=r.getFullYear(),d=String(r.getMonth()+1).padStart(2,"0"),i=String(r.getDate()).padStart(2,"0");s=`${t}-${d}-${i}`}else{const r=new Date,t=r.getFullYear(),d=String(r.getMonth()+1).padStart(2,"0"),i=String(r.getDate()).padStart(2,"0");s=`${t}-${d}-${i}`}console.log("[LiveClasses] Fetching with params:",{selectedDate:l,dateParam:s,search:h});const a=await Y.getStudentLiveClasses(s,h||null);a.success&&a.data?.liveClasses?(console.log("[LiveClasses] Received classes:",a.data.liveClasses.length),a.data.liveClasses.length>0&&console.log("[LiveClasses] First class scheduled time:",new Date(a.data.liveClasses[0].scheduledStartTime).toLocaleString()),v(a.data.liveClasses)):v([])}catch(s){console.error("Error fetching live classes:",s),S(s.message||"Failed to load live classes"),v([])}finally{y(!1)}},j=()=>{const s=new Date,a=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),t=String(s.getDate()).padStart(2,"0");return`${a}-${r}-${t}`},L=s=>{const a=s.target.value;console.log("[LiveClasses] Date changed:",a),D(a)},P=()=>{console.log("[LiveClasses] Resetting to today"),D(null)},R=()=>{if(!l)return"Today";const s=l.split("-");return s.length===3?new Date(parseInt(s[0]),parseInt(s[1])-1,parseInt(s[2])).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):l},A=s=>{x(`/live-class/${s}`)},O=s=>{s.recording?.isAvailable?x(`/recording/${s._id}`):alert("Recording is not available yet. Please check back later.")},m=s=>{const a=new Date(s),r=a.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),t=a.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",hour12:!0});return{date:r,time:t}};return e.jsxs("div",{className:"min-h-screen w-full bg-white",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-4 sm:px-6 pt-3 sm:pt-4 pb-4 sm:pb-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>x(B.DASHBOARD),className:"p-1.5 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(z,{className:"text-lg sm:text-xl"})}),e.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl font-bold",children:"Live Classes"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>x("/timetable"),className:"p-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-colors flex items-center gap-1.5 backdrop-blur-sm",title:"View Timetable",children:[e.jsx(M,{className:"text-base sm:text-lg"}),e.jsx("span",{className:"hidden sm:inline text-xs sm:text-sm font-medium",children:"Timetable"})]})})]})})}),e.jsxs("main",{className:"px-4 sm:px-6 py-4 sm:py-5 pb-24",children:[e.jsxs("div",{className:"mb-4 relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg z-10"}),e.jsx("input",{type:"text",placeholder:"Search by name, subject, teacher, or date...",value:h,onChange:s=>k(s.target.value),className:"w-full pl-10 pr-12 py-2.5 sm:py-3 border border-gray-300 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--app-dark-blue)] text-sm sm:text-base"}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[h&&e.jsx("button",{onClick:()=>k(""),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(E,{className:"text-lg"})}),e.jsx("button",{onClick:()=>f(!T),className:"text-gray-400 hover:text-gray-600 transition-colors",title:l?`Selected: ${R()}`:"Select Date",children:e.jsx(N,{className:"text-lg"})})]})]}),e.jsx("input",{type:"date",value:l||j(),onChange:L,max:j(),className:"hidden",id:"date-picker-hidden"}),T&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-lg border border-gray-200 p-4 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Select Date:"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(E,{className:"text-lg"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:l||j(),onChange:s=>{L(s),f(!1)},max:j(),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--app-dark-blue)] text-sm"}),l&&e.jsx("button",{onClick:()=>{P(),f(!1)},className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors",children:"Today"})]})]})]}),w&&e.jsx("div",{className:"mb-4 bg-red-50 border-2 border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:w}),C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--app-dark-blue)]"})}):F?b.length>0?e.jsx("div",{className:"space-y-4 sm:space-y-5",children:(()=>{const s=b.filter(t=>t.computedStatus==="live"),a=b.filter(t=>t.computedStatus==="scheduled"),r=b.filter(t=>t.computedStatus==="ended");return e.jsxs(e.Fragment,{children:[s.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Live Now (",s.length,")"]}),s.map(t=>{const d=new Date(t.scheduledStartTime),{date:i,time:u}=m(d.toISOString());let n=null;if(t.scheduledEndTime){const p=new Date(t.scheduledEndTime),{time:g}=m(p.toISOString());n=g}return e.jsx("div",{className:"bg-white rounded-lg sm:rounded-xl p-3 sm:p-4 shadow-md hover:shadow-lg transition-all border-2 border-green-200",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-800 mb-1.5",children:t.title}),e.jsxs("p",{className:"text-gray-600 text-xs sm:text-sm mb-2.5 font-medium",children:[t.subjectId?.name||"Subject"," · ",t.teacherId?.name||"Teacher"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 text-xs sm:text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-[var(--app-dark-blue)]/10 rounded-lg",children:e.jsx(N,{className:"text-[var(--app-dark-blue)] text-xs"})}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-[var(--app-dark-blue)]/10 rounded-lg",children:e.jsx(o,{className:"text-[var(--app-dark-blue)] text-xs"})}),e.jsxs("span",{className:"font-medium",children:[u,n?` - ${n}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded-lg",children:e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})}),e.jsx("span",{className:"font-medium text-green-600",children:"Live Now"})]})]})]}),e.jsxs("button",{onClick:()=>A(t._id),className:"bg-[var(--app-dark-blue)] hover:bg-blue-700 text-white font-bold px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg sm:rounded-xl transition-colors flex items-center gap-1.5 shadow-md text-xs sm:text-sm",children:[e.jsx($,{className:"text-xs"}),e.jsx("span",{children:"Join Live"})]})]})},t._id)})]}),a.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(o,{className:"text-[var(--app-dark-blue)]"}),"Starts Soon (",a.length,")"]}),a.map(t=>{const d=new Date(t.scheduledStartTime),{date:i,time:u}=m(d.toISOString());let n=null;if(t.scheduledEndTime){const p=new Date(t.scheduledEndTime),{time:g}=m(p.toISOString());n=g}return e.jsx("div",{className:"bg-white rounded-lg sm:rounded-xl p-3 sm:p-4 shadow-md hover:shadow-lg transition-all border border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-800 mb-1.5",children:t.title}),e.jsxs("p",{className:"text-gray-600 text-xs sm:text-sm mb-2.5 font-medium",children:[t.subjectId?.name||"Subject"," · ",t.teacherId?.name||"Teacher"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 text-xs sm:text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-[var(--app-dark-blue)]/10 rounded-lg",children:e.jsx(N,{className:"text-[var(--app-dark-blue)] text-xs"})}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-[var(--app-dark-blue)]/10 rounded-lg",children:e.jsx(o,{className:"text-[var(--app-dark-blue)] text-xs"})}),e.jsxs("span",{className:"font-medium",children:[u,n?` - ${n}`:""]})]})]})]}),e.jsx("div",{className:"px-3 py-2 text-xs sm:text-sm text-gray-500 font-medium",children:"Starts Soon"})]})},t._id)})]}),r.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(o,{className:"text-gray-500"}),"Ended (",r.length,")"]}),r.map(t=>{const d=new Date(t.scheduledStartTime),{date:i,time:u}=m(d.toISOString());let n=null;if(t.scheduledEndTime){const p=new Date(t.scheduledEndTime),{time:g}=m(p.toISOString());n=g}return e.jsx("div",{className:"bg-white rounded-lg sm:rounded-xl p-3 sm:p-4 shadow-md hover:shadow-lg transition-all border border-gray-200 opacity-75",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-800 mb-1.5",children:t.title}),e.jsxs("p",{className:"text-gray-600 text-xs sm:text-sm mb-2.5 font-medium",children:[t.subjectId?.name||"Subject"," · ",t.teacherId?.name||"Teacher"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 text-xs sm:text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-[var(--app-dark-blue)]/10 rounded-lg",children:e.jsx(N,{className:"text-[var(--app-dark-blue)] text-xs"})}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-[var(--app-dark-blue)]/10 rounded-lg",children:e.jsx(o,{className:"text-[var(--app-dark-blue)] text-xs"})}),e.jsxs("span",{className:"font-medium",children:[u,n?` - ${n}`:""]})]}),e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsx("span",{className:"font-medium text-gray-500",children:"Ended"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.recording?.isAvailable&&e.jsxs("button",{onClick:()=>O(t),className:"bg-[var(--app-dark-blue)] hover:bg-blue-700 text-white font-bold px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg sm:rounded-xl transition-colors flex items-center gap-1.5 shadow-md text-xs sm:text-sm",title:"Watch Recording",children:[e.jsx(V,{className:"text-xs"}),e.jsx("span",{children:"Watch"})]}),!t.recording?.isAvailable&&e.jsx("div",{className:"px-3 py-2 text-xs sm:text-sm text-gray-500 font-medium",children:"Ended"})]})]})},t._id)})]})]})})()}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-[var(--app-dark-blue)]/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(o,{className:"text-[var(--app-dark-blue)] text-3xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-800 mb-1.5 text-center",children:(()=>{if(!l)return"No live classes scheduled";const s=new Date(l),a=new Date;return a.setHours(0,0,0,0),s.setHours(0,0,0,0),s<a?"No live classes on this date":(s>a,"No live classes scheduled")})()}),e.jsx("p",{className:"text-gray-500 text-center max-w-md text-xs sm:text-sm px-4",children:(()=>{if(!l)return"Check back later for upcoming classes";const s=new Date(l),a=new Date;return a.setHours(0,0,0,0),s.setHours(0,0,0,0),s<a?"There were no live classes scheduled for this date":(s>a,"Check back later for upcoming classes")})()})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-[var(--app-dark-blue)]/10 rounded-full flex items-center justify-center mb-4",children:e.jsx($,{className:"text-[var(--app-dark-blue)] text-3xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-800 mb-1.5 text-center",children:"No Subscription"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md text-xs sm:text-sm px-4 mb-4",children:"You need an active subscription to access live classes. Please subscribe to a plan to continue learning."}),e.jsx("button",{onClick:()=>x("/subscription-plans"),className:"bg-[var(--app-dark-blue)] hover:bg-blue-700 text-white font-bold py-2.5 sm:py-3 px-6 sm:px-8 rounded-lg sm:rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl text-xs sm:text-sm md:text-base",children:"View Subscription Plans"})]})]}),e.jsx(J,{})]})};export{U as default};
