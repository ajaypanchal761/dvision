import{r,j as e,D as W,T as D}from"./index-BPKQ2keO.js";import{r as b}from"./api-BdrZRD_7.js";const I=c=>c?new Date(c).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",hour12:!0,day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",O=(c=0)=>{if(!c)return"—";const d=1024;if(Math.abs(c)<d)return`${c} B`;const i=["KB","MB","GB","TB"];let o=-1,n=c;do n/=d,++o;while(Math.abs(n)>=d&&o<i.length-1);return`${n.toFixed(1)} ${i[o]}`},q=()=>{const d={title:"",teacherName:"",className:"",subjectName:"",status:"",date:new Date().toISOString().split("T")[0]},[i,o]=r.useState(d),[n,j]=r.useState(d),[w,N]=r.useState([]),[p,v]=r.useState(!1),[k,S]=r.useState(null),[A,u]=r.useState(!1),[x,R]=r.useState(null),[P,C]=r.useState(!1),[L,F]=r.useState(null),[s,M]=r.useState({page:1,pages:1,total:0,count:0}),[h,B]=r.useState({totalRecordings:0,processingRecordings:0,completedRecordings:0,failedRecordings:0}),z=async()=>{try{const t=await b.getStatistics();t.success&&t.data?.statistics&&B({totalRecordings:t.data.statistics.totalRecordings||0,processingRecordings:t.data.statistics.processingRecordings||0,completedRecordings:t.data.statistics.completedRecordings||0,failedRecordings:t.data.statistics.failedRecordings||0})}catch(t){console.error("Error fetching statistics:",t)}},f=async(t,l=1)=>{try{v(!0),S(null);const a={...t,page:l,limit:10},g=await b.getAll(a),U=g?.data?.recordings||[];N(U),M({page:g.page||1,pages:g.pages||1,total:g.total||0,count:g.count||0})}catch(a){S(a?.message||"Failed to load recordings"),N([])}finally{v(!1)}};r.useEffect(()=>{z(),f(n,1)},[]),r.useEffect(()=>{f(n,1)},[n]);const y=t=>{t>=1&&t<=s.pages&&f(n,t)},m=(t,l)=>{o(a=>({...a,[t]:l}))},E=()=>{j(i)},$=()=>{o(d),j(d)},T=async t=>{try{C(!0),F(null);const a=(await b.getById(t))?.data?.recording;if(!a?.playbackUrl)throw new Error("Playback URL not available");R(a),u(!0)}catch(l){F(l?.message||"Failed to load recording"),R(null),u(!0)}finally{C(!1)}};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pt-3 sm:pt-4 md:pt-5 lg:pt-6",children:[e.jsx("div",{className:"pb-0",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-white",children:"Recorded Sessions"}),e.jsx("p",{className:"text-white/80 text-xs sm:text-sm mt-1",children:"View, filter, and watch class recordings"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 mt-3 sm:mt-4 md:mt-5 lg:mt-6",children:e.jsxs("div",{className:"p-3 sm:p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsx("input",{type:"text",value:i.title,onChange:t=>m("title",t.target.value),placeholder:"Filter by title",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] text-sm text-gray-700 placeholder-gray-400"}),e.jsx("input",{type:"text",value:i.teacherName,onChange:t=>m("teacherName",t.target.value),placeholder:"Filter by teacher",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] text-sm text-gray-700 placeholder-gray-400"}),e.jsx("input",{type:"text",value:i.className,onChange:t=>m("className",t.target.value),placeholder:"Filter by class",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] text-sm text-gray-700 placeholder-gray-400"}),e.jsx("input",{type:"text",value:i.subjectName,onChange:t=>m("subjectName",t.target.value),placeholder:"Filter by subject",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] text-sm text-gray-700 placeholder-gray-400"}),e.jsxs("select",{value:i.status,onChange:t=>m("status",t.target.value),className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] text-sm text-gray-700 bg-white",children:[e.jsx("option",{value:"",children:"All statuses"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"uploading",children:"Uploading"}),e.jsx("option",{value:"failed",children:"Failed"})]}),e.jsx("input",{type:"date",value:i.date,onChange:t=>m("date",t.target.value),className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] text-sm text-gray-700 placeholder-gray-400"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 sm:mt-4",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 bg-[#1e3a5f] text-white text-sm font-semibold rounded-lg hover:bg-[#152a44] transition-all",children:"Apply filters"}),e.jsx("button",{onClick:$,className:"px-4 py-2 bg-gray-100 text-gray-700 text-sm font-semibold rounded-lg hover:bg-gray-200 transition-all",children:"Reset to today"})]})]})}),e.jsx("div",{className:"mt-3 sm:mt-4 md:mt-5 lg:mt-6",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 md:gap-4 lg:gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-2.5 sm:p-3 md:p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-500 text-xs sm:text-sm font-medium",children:"Total Recordings"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-gray-900 mt-0.5 sm:mt-1",children:h.totalRecordings})]}),e.jsx("div",{className:"h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 lg:h-12 lg:w-12 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5 lg:w-6 lg:h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-2.5 sm:p-3 md:p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-500 text-xs sm:text-sm font-medium",children:"Processing"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-gray-900 mt-0.5 sm:mt-1",children:h.processingRecordings})]}),e.jsx("div",{className:"h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 lg:h-12 lg:w-12 rounded-lg bg-yellow-100 flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5 lg:w-6 lg:h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-2.5 sm:p-3 md:p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-500 text-xs sm:text-sm font-medium",children:"Completed"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-gray-900 mt-0.5 sm:mt-1",children:h.completedRecordings})]}),e.jsx("div",{className:"h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 lg:h-12 lg:w-12 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5 lg:w-6 lg:h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-2.5 sm:p-3 md:p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-500 text-xs sm:text-sm font-medium",children:"Failed"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-gray-900 mt-0.5 sm:mt-1",children:h.failedRecordings})]}),e.jsx("div",{className:"h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 lg:h-12 lg:w-12 rounded-lg bg-red-100 flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5 lg:w-6 lg:h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden mt-3 sm:mt-4 md:mt-5 lg:mt-6",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm sm:text-base md:text-lg font-semibold text-gray-900",children:["Recorded sessions (",n.date||"All",")"]}),p&&e.jsx("span",{className:"text-xs sm:text-sm text-gray-500",children:"Loading..."}),k&&!p&&e.jsx("span",{className:"text-xs sm:text-sm text-red-500",children:k})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Class"}),e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Subject"}),e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Teacher"}),e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Title"}),e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"File Size"}),e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 sm:px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:p?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-4 py-6 text-center text-sm text-gray-600",children:"Fetching recordings..."})}):w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-3 sm:px-4 md:px-6 py-8 sm:py-12 md:py-16 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"h-12 w-12 sm:h-14 sm:w-14 md:h-16 md:w-16 rounded-full bg-gray-100 flex items-center justify-center mb-3 sm:mb-4",children:e.jsx("svg",{className:"w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:w-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.jsx("p",{className:"text-gray-500 font-medium text-sm sm:text-base md:text-lg",children:"No recorded sessions found."}),e.jsx("p",{className:"text-gray-400 text-xs sm:text-sm mt-1",children:"Adjust filters or pick another date."})]})})}):w.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-all duration-150",children:[e.jsx("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 inline-flex text-xs font-medium rounded-lg bg-blue-50 text-blue-700",children:t.class?.name||t.class?.class||"-"})}),e.jsx("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-700 font-semibold",children:t.subject?.name||"-"})}),e.jsxs("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-700",children:t.teacher?.name||"-"}),e.jsx("div",{className:"text-[11px] text-gray-500",children:t.teacher?.email||t.teacher?.phone||""})]}),e.jsxs("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:t.title}),e.jsx("div",{className:"text-xs text-gray-500",children:t.description||"—"})]}),e.jsx("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:I(t.createdAt)}),e.jsx("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:t.duration?`${(t.duration/60).toFixed(0)} min`:"—"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:O(t.fileSize)}),e.jsx("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs font-semibold rounded-lg ${t.status==="completed"?"bg-green-100 text-green-700":t.status==="processing"?"bg-yellow-100 text-yellow-700":t.status==="uploading"?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-3 sm:px-4 py-3 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>T(t._id),className:"inline-flex items-center gap-1 px-3 py-2 rounded-lg border border-gray-200 text-xs font-semibold text-gray-700 hover:bg-gray-50 transition-all",title:"Watch recording",children:[e.jsx(W,{className:"text-gray-600"})," Watch"]})})]},t._id))})]})}),!p&&s.pages>1&&e.jsxs("div",{className:"px-3 sm:px-4 py-3 sm:py-4 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold",children:(s.page-1)*10+1})," to"," ",e.jsx("span",{className:"font-semibold",children:Math.min(s.page*10,s.total)})," ","of ",e.jsx("span",{className:"font-semibold",children:s.total})," recordings"]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>y(s.page-1),disabled:s.page===1,className:`px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded-lg transition-all ${s.page===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-[#1e3a5f] text-white hover:bg-[#2a4a6f]"}`,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,s.pages)},(t,l)=>{let a;return s.pages<=5||s.page<=3?a=l+1:s.page>=s.pages-2?a=s.pages-4+l:a=s.page-2+l,e.jsx("button",{onClick:()=>y(a),className:`px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded-lg transition-all ${s.page===a?"bg-[#1e3a5f] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a},a)})}),e.jsx("button",{onClick:()=>y(s.page+1),disabled:s.page===s.pages,className:`px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded-lg transition-all ${s.page===s.pages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-[#1e3a5f] text-white hover:bg-[#2a4a6f]"}`,children:"Next"})]})]})]})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x?.title||"Recording"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[x?.subject?.name," · ",x?.teacher?.name]})]}),e.jsx("button",{onClick:()=>u(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-600","aria-label":"Close player",children:e.jsx(D,{size:18})})]}),e.jsx("div",{className:"bg-black",children:P?e.jsx("div",{className:"p-6 text-center text-white text-sm",children:"Loading recording..."}):L?e.jsx("div",{className:"p-6 text-center text-red-100 bg-red-600 text-sm",children:L}):x?.playbackUrl?e.jsx("video",{controls:!0,className:"w-full max-h-[70vh]",src:x.playbackUrl},x.playbackUrl):e.jsx("div",{className:"p-6 text-center text-white text-sm",children:"No playback URL available."})})]})})]})};export{q as default};
