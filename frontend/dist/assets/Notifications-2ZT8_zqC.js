import{u as B,r as n,j as e,c as L,ay as z,y as q,z as H,A as C,B as D,g as O,C as U}from"./index-BPKQ2keO.js";import{n as f}from"./api-CVReUq8b.js";import{B as Y}from"./BottomNav-BGePCkyK.js";const G=()=>{const b=B(),[l,g]=n.useState([]),[a,d]=n.useState([]),[N,v]=n.useState(!0),[m,u]=n.useState(!1),[F,j]=n.useState(!1),[w,o]=n.useState(""),[i,y]=n.useState(!1),A=s=>{const t=new Date(s),h=new Date-t,c=Math.floor(h/6e4),p=Math.floor(h/36e5),x=Math.floor(h/864e5);return c<1?"Just now":c<60?`${c} minute${c>1?"s":""} ago`:p<24?`${p} hour${p>1?"s":""} ago`:x<7?`${x} day${x>1?"s":""} ago`:t.toLocaleDateString()},k=async()=>{try{v(!0),o("");const s=await f.getMyNotifications();if(s.success&&s.data?.notifications){if(g(s.data.notifications),s.data.notifications.length>0){const t=s.data.notifications.filter(r=>!r.isRead).map(r=>r._id);t.length>0&&await f.markAsRead(t)}}else o("Failed to load notifications")}catch(s){const t=s?.message||s?.toString()||"Failed to load notifications";o(typeof t=="string"?t:"Failed to load notifications")}finally{v(!1)}};n.useEffect(()=>{k()},[]);const $=()=>{a.length===l.length?d([]):d(l.map(s=>s._id))},M=s=>{d(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},_=async()=>{if(a.length!==0)try{u(!0),(await f.deleteNotifications(a)).success?(g(t=>t.filter(r=>!a.includes(r._id))),d([]),j(!1),y(!1)):o("Failed to delete notifications")}catch(s){const t=s?.message||s?.toString()||"Failed to delete notifications";o(typeof t=="string"?t:"Failed to delete notifications")}finally{u(!1)}},R=()=>{y(!0),d([])},T=()=>{y(!1),d([])},E=s=>{if(!i){if(s.type==="timetable_class_reminder"&&s.data){const{classId:t,subjectId:r,startTime:h,endTime:c,topic:p,className:x,subjectName:S}=s.data;b("/teacher/create-live-class",{state:{prefillData:{classId:t,subjectId:r,startTime:h,endTime:c,title:p||`${S||"Class"} - ${x||""}`,description:`Live class for ${S||"Subject"} - ${x||"Class"}`}}});return}s.data?.url&&b(s.data.url)}},I=async()=>{try{u(!0),(await f.deleteAllNotifications()).success?(g([]),d([]),j(!1)):o("Failed to delete all notifications")}catch(s){const t=s?.message||s?.toString()||"Failed to delete all notifications";o(typeof t=="string"?t:"Failed to delete all notifications")}finally{u(!1)}};return e.jsxs("div",{className:"min-h-screen w-full bg-white",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-6 sm:pb-8",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>b(z.DASHBOARD),className:"p-2 text-white hover:bg-white/10 rounded-full transition-colors flex-shrink-0",children:e.jsx(L,{className:"text-xl sm:text-2xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold",children:"Notifications"}),l.length>0&&!i&&e.jsxs("p",{className:"text-sm text-white/80 mt-1",children:[l.length," notification",l.length>1?"s":""]}),i&&a.length>0&&e.jsxs("p",{className:"text-sm text-white/80 mt-1",children:[a.length," selected"]})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:l.length>0&&e.jsx(e.Fragment,{children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:T,className:"px-3 py-1.5 sm:py-2 text-white hover:bg-white/10 rounded-lg text-xs sm:text-sm font-semibold transition-colors border border-white/20",children:"Cancel"}),a.length>0&&e.jsx("button",{onClick:_,disabled:m,className:"px-3 py-1.5 sm:py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs sm:text-sm font-semibold transition-colors disabled:opacity-50 shadow-lg",children:m?"Deleting...":`Delete (${a.length})`})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:R,className:"p-2 text-white hover:bg-white/10 rounded-full transition-colors",title:"Select to Delete",children:e.jsx(q,{className:"text-lg sm:text-xl"})}),e.jsx("button",{onClick:k,disabled:N,className:"p-2 text-white hover:bg-white/10 rounded-full transition-colors disabled:opacity-50",title:"Refresh",children:e.jsx(H,{className:`text-lg sm:text-xl ${N?"animate-spin":""}`})})]})})})]})})}),e.jsxs("main",{className:"px-4 sm:px-6 py-6 pb-24",children:[w&&e.jsx("div",{className:"mb-4 bg-red-50 border-2 border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm font-medium",children:w}),N?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-xl p-5 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},s))}):l.length>0?e.jsxs("div",{className:"space-y-3",children:[i&&e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("button",{onClick:$,className:"flex items-center gap-2 text-gray-700 hover:text-[var(--app-dark-blue)] transition-colors font-bold",children:[a.length===l.length?e.jsx(C,{className:"text-xl text-[var(--app-dark-blue)]"}):e.jsx(D,{className:"text-xl"}),e.jsx("span",{className:"text-sm",children:a.length===l.length?"Deselect All":"Select All"})]})}),l.map(s=>{const t=a.includes(s._id);return e.jsx("div",{className:`bg-white rounded-xl p-5 shadow-md border-2 transition-all ${i?"cursor-pointer":s.type==="timetable_class_reminder"?"cursor-pointer hover:shadow-lg":""} ${t?"border-[var(--app-dark-blue)] ring-2 ring-[var(--app-dark-blue)]/20 bg-blue-50":"border-gray-200 hover:border-[var(--app-dark-blue)]/30"} ${s.isRead?"":"bg-[var(--app-dark-blue)]/5"}`,onClick:()=>{i?M(s._id):E(s)},children:e.jsxs("div",{className:"flex items-start gap-3",children:[i&&e.jsx("div",{className:"mt-1",children:t?e.jsx(C,{className:"text-[var(--app-dark-blue)] text-xl"}):e.jsx(D,{className:"text-gray-300 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:`font-bold text-base ${s.isRead?"text-gray-800":"text-[var(--app-dark-blue)]"}`,children:s.title}),!s.isRead&&e.jsx("span",{className:"w-2 h-2 bg-[var(--app-dark-blue)] rounded-full"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-2 leading-relaxed",children:s.body}),s.type==="timetable_class_reminder"&&s.data&&e.jsxs("div",{className:"bg-[var(--app-dark-blue)]/10 rounded-lg p-2 mb-2 text-xs",children:[e.jsxs("p",{className:"text-[var(--app-dark-blue)] font-semibold",children:["ðŸ“… ",s.data.subjectName," â€¢ ",s.data.className]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["â° ",s.data.startTime," - ",s.data.endTime]}),e.jsx("p",{className:"text-[var(--app-dark-blue)] font-medium mt-2",children:"Tap to create live class â†’"})]}),e.jsx("p",{className:"text-gray-400 text-xs font-medium",children:A(s.createdAt)})]})]})},s._id)})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-200px)] py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-[var(--app-dark-blue)]/10 rounded-full flex items-center justify-center mb-6",children:e.jsx(O,{className:"text-[var(--app-dark-blue)] text-4xl"})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 mb-2 text-center",children:"All Caught Up!"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md text-sm sm:text-base px-4 mb-6",children:"You don't have any notifications right now. We'll notify you when something important happens!"}),e.jsxs("div",{className:"bg-[var(--app-dark-blue)]/10 rounded-xl px-6 py-3 flex items-center gap-3 border border-[var(--app-dark-blue)]/20",children:[e.jsx("div",{className:"bg-[var(--app-dark-blue)] rounded-full p-1.5",children:e.jsx(U,{className:"text-white text-sm"})}),e.jsx("span",{className:"text-[var(--app-dark-blue)] font-bold text-sm",children:"You're up to date"})]})]})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 px-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"Delete All Notifications?"}),e.jsx("p",{className:"text-gray-600 mb-6 text-sm",children:"Are you sure you want to delete all notifications? This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>j(!1),disabled:m,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:I,disabled:m,className:"flex-1 px-4 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 transition-colors disabled:opacity-50",children:m?"Deleting...":"Delete All"})]})]})}),e.jsx(Y,{})]})};export{G as default};
