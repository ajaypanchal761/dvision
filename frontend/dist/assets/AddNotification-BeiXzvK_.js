import{u as E,q as A,r,j as e}from"./index-BPKQ2keO.js";import{c as P,n as b}from"./api-BdrZRD_7.js";const L=()=>{const u=E(),{id:d}=A(),l=!!d,[i,n]=r.useState("students"),[m,o]=r.useState(""),[x,S]=r.useState([]),[f,h]=r.useState(""),[g,y]=r.useState(""),[p,N]=r.useState(!1),[T,j]=r.useState(!1),[v,c]=r.useState("");r.useEffect(()=>{(async()=>{try{const t=await P.getAllWithoutPagination({isActive:!0,limit:1e3});t.success&&t.data?.classes&&S(t.data.classes)}catch(t){console.error("Error fetching classes:",t)}})()},[]),r.useEffect(()=>{l&&d&&x.length>0&&(async()=>{try{j(!0);const t=await b.getCampaign(d);if(t.success&&t.data?.campaign){const a=t.data.campaign;if(h(a.title),y(a.body),a.notificationType?n(a.notificationType):a.recipientTypes?a.recipientTypes.includes("student")&&a.recipientTypes.includes("teacher")?n("both"):a.recipientTypes.includes("student")?n("students"):n("teachers"):a.recipientType&&n(a.recipientType==="student"?"students":"teachers"),a.classId)o(a.classId.toString());else if(a.classNumber){const w=x.find(C=>C.type==="regular"&&C.class===a.classNumber);o(w?w._id.toString():a.classNumber.toString())}else a.filters?.class&&o(a.filters.class.toString())}}catch(t){console.error("Error fetching campaign:",t),c("Failed to load notification. Please try again.")}finally{j(!1)}})()},[l,d,x]);const k=async()=>{if(!f.trim()||!g.trim()){c("Please enter both title and message");return}if(i==="class"&&!m){c("Please select a class for class-based notifications");return}try{N(!0),c("");const s={title:f.trim(),body:g.trim(),notificationType:i,classId:i==="class"?m:null,classNumber:null};let t;l?t=await b.updateCampaign(d,s):t=await b.createCampaign(s),t.success?(alert(l?"Notification updated successfully!":"Notification created successfully!"),u("/admin/notifications")):c(t.message||"Failed to save notification")}catch(s){console.error("Error saving notification:",s),c(s.message||"Failed to save notification. Please try again.")}finally{N(!1)}};return T?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1e3a5f] mx-auto"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-2",children:"Loading..."})]})}):e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pt-2 sm:pt-3",children:[e.jsx("div",{className:"pb-1 sm:pb-2",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>u("/admin/notifications"),className:"text-[#1e3a5f] hover:text-[#2a4a6f] transition-colors",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsx("h1",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold text-[#1e3a5f]",children:l?"Edit Notification":"Add Notification"})]})}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-xs sm:text-sm mt-2 sm:mt-3",children:v}),e.jsxs("div",{className:"mt-2 sm:mt-3 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4 md:p-5",children:[e.jsx("h2",{className:"text-sm sm:text-base font-bold text-gray-800 mb-3 sm:mb-4",children:"Select Notification Type"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 sm:gap-3 p-3 sm:p-4 border-2 rounded-lg cursor-pointer transition-all ${i==="students"?"border-[#1e3a5f] bg-blue-50":"border-gray-200 hover:border-[#1e3a5f]/30"}`,children:[e.jsx("input",{type:"radio",name:"notificationType",value:"students",checked:i==="students",onChange:s=>{n(s.target.value),o("")},className:"w-4 h-4 sm:w-5 sm:h-5 text-[#1e3a5f] border-gray-300 focus:ring-[#1e3a5f]"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-700",children:"All Students"})]}),e.jsxs("label",{className:`flex items-center gap-2 sm:gap-3 p-3 sm:p-4 border-2 rounded-lg cursor-pointer transition-all ${i==="teachers"?"border-[#1e3a5f] bg-blue-50":"border-gray-200 hover:border-[#1e3a5f]/30"}`,children:[e.jsx("input",{type:"radio",name:"notificationType",value:"teachers",checked:i==="teachers",onChange:s=>{n(s.target.value),o("")},className:"w-4 h-4 sm:w-5 sm:h-5 text-[#1e3a5f] border-gray-300 focus:ring-[#1e3a5f]"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-700",children:"All Teachers"})]}),e.jsxs("label",{className:`flex items-center gap-2 sm:gap-3 p-3 sm:p-4 border-2 rounded-lg cursor-pointer transition-all ${i==="both"?"border-[#1e3a5f] bg-blue-50":"border-gray-200 hover:border-[#1e3a5f]/30"}`,children:[e.jsx("input",{type:"radio",name:"notificationType",value:"both",checked:i==="both",onChange:s=>{n(s.target.value),o("")},className:"w-4 h-4 sm:w-5 sm:h-5 text-[#1e3a5f] border-gray-300 focus:ring-[#1e3a5f]"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-700",children:"Both (Students + Teachers)"})]}),e.jsxs("label",{className:`flex items-center gap-2 sm:gap-3 p-3 sm:p-4 border-2 rounded-lg cursor-pointer transition-all ${i==="class"?"border-[#1e3a5f] bg-blue-50":"border-gray-200 hover:border-[#1e3a5f]/30"}`,children:[e.jsx("input",{type:"radio",name:"notificationType",value:"class",checked:i==="class",onChange:s=>n(s.target.value),className:"w-4 h-4 sm:w-5 sm:h-5 text-[#1e3a5f] border-gray-300 focus:ring-[#1e3a5f]"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-700",children:"Class Based"})]})]})]}),i==="class"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4 md:p-5",children:[e.jsx("h2",{className:"text-sm sm:text-base font-bold text-gray-800 mb-3 sm:mb-4",children:"Select Class"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:m,onChange:s=>o(s.target.value),className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white",children:[e.jsx("option",{value:"",children:"Select Class"}),x.map(s=>{const t=s.type==="regular"?s.board?`Class ${s.class} - ${s.board}`:`Class ${s.class}`:s.name||s.classCode||"Preparation Class";return e.jsx("option",{value:s._id,children:t},s._id)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4 md:p-5",children:[e.jsx("h2",{className:"text-sm sm:text-base font-bold text-gray-800 mb-3 sm:mb-4",children:"Notification Details"}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:f,onChange:s=>h(s.target.value),placeholder:"Enter notification title",className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Message ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:g,onChange:s=>y(s.target.value),placeholder:"Enter notification message",rows:4,className:"w-full px-3 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-[#1e3a5f] focus:border-[#1e3a5f] outline-none transition-all duration-200 bg-white resize-none"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3 pt-3 sm:pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u("/admin/notifications"),disabled:p,className:"w-full sm:w-auto px-4 sm:px-6 py-2 text-xs sm:text-sm border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all duration-200 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:k,disabled:p||!f.trim()||!g.trim()||i==="class"&&!m,className:"w-full sm:w-auto px-4 sm:px-6 py-2 text-xs sm:text-sm bg-gradient-to-r from-[#1e3a5f] to-[#2a4a6f] hover:from-[#2a4a6f] hover:to-[#1e3a5f] text-white rounded-lg font-semibold transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50",children:p?"Saving...":l?"Update Notification":"Create Notification"})]})]})]})})};export{L as default};
