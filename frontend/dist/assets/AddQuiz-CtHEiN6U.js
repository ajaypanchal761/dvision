import{u as O,r as i,j as e,c as R}from"./index-BPKQ2keO.js";import{t as k,q as F}from"./api-CVReUq8b.js";import{B as _}from"./BottomNav-BGePCkyK.js";const G=()=>{const x=O(),[a,d]=i.useState({quizName:"",board:"",class:"",subjectId:"",status:"Active",deadlineDate:"",deadlineTime:"12:00"}),[o,u]=i.useState([]),[v,S]=i.useState([]),[j,C]=i.useState([]),[q,A]=i.useState([]),[z,y]=i.useState([]),[D,m]=i.useState([]),[p,N]=i.useState(!0),[w,b]=i.useState(!1);i.useEffect(()=>{(async()=>{try{N(!0);const[t,r]=await Promise.all([k.getAllClasses(),k.getAllSubjects()]);if(t.success&&t.data?.classes){const l=t.data.classes.filter(c=>c.isActive);S(l);const n=[...new Set(l.map(c=>c.board))].filter(Boolean).sort();A(n)}if(r.success&&r.data?.subjects){const l=r.data.subjects.filter(n=>n.isActive);C(l)}}catch(t){console.error("Error fetching data:",t)}finally{N(!1)}})()},[]),i.useEffect(()=>{if(!a.board){y([]),d(r=>({...r,class:"",subjectId:""})),m([]);return}const s=v.filter(r=>r.board===a.board).map(r=>r.class),t=[...new Set(s)].sort((r,l)=>r-l);y(t),a.class&&!t.includes(parseInt(a.class))&&(d(r=>({...r,class:"",subjectId:""})),m([]))},[a.board,v]),i.useEffect(()=>{if(!a.board||!a.class){m([]),d(t=>({...t,subjectId:""}));return}const s=j.filter(t=>t.board===a.board&&t.class===parseInt(a.class));m(s),a.subjectId&&!s.find(t=>t._id===a.subjectId)&&d(t=>({...t,subjectId:""}))},[a.board,a.class,j]);const I=()=>{u([...o,{question:"",options:["","","",""],correctAnswer:0}])},Q=s=>{if(o.length>1){const t=o.filter((r,l)=>l!==s);u(t)}else alert("At least one question is required")},E=(s,t,r)=>{const l=[...o];l[s][t]=r,u(l)},P=(s,t,r)=>{const l=[...o];l[s].options[t]=r,u(l)},B=(s,t)=>{const r=[...o];r[s].correctAnswer=parseInt(t),u(r)},T=()=>{if(!a.quizName.trim())return alert("Please enter quiz name"),!1;if(!a.board)return alert("Please select a board"),!1;if(!a.class)return alert("Please select a class"),!1;if(!a.subjectId)return alert("Please select a subject"),!1;if(o.length===0)return alert("Please add at least one question"),!1;for(let s=0;s<o.length;s++){const t=o[s];if(!t.question.trim())return alert(`Please enter question ${s+1}`),!1;for(let r=0;r<4;r++)if(!t.options[r]||!t.options[r].trim())return alert(`Please enter all 4 options for question ${s+1}`),!1}return!0},L=async s=>{if(s.preventDefault(),!!T())try{b(!0);let t=null;if(a.deadlineDate&&a.deadlineTime)try{const[n,c]=a.deadlineTime.split(":");if(!n||!c||isNaN(parseInt(n))||isNaN(parseInt(c)))throw new Error("Invalid time format");const h=parseInt(n,10),g=parseInt(c,10);if(h<0||h>23||g<0||g>59)throw new Error("Invalid time value");const $=`${a.deadlineDate}T${String(h).padStart(2,"0")}:${String(g).padStart(2,"0")}`,f=new Date($);if(isNaN(f.getTime()))throw new Error("Invalid date or time value");if(f<=new Date)throw new Error("Deadline must be in the future. Please select a future date and time.");t=f.toISOString()}catch(n){console.error("Error parsing deadline:",n),alert(n.message||"Invalid deadline date or time. Please check your input."),b(!1);return}const r={name:a.quizName.trim(),classNumber:parseInt(a.class),board:a.board,subjectId:a.subjectId,isActive:a.status==="Active",deadline:t,questions:o.map(n=>({question:n.question.trim(),options:n.options.map(c=>c.trim()),correctAnswer:n.correctAnswer}))};(await F.create(r)).success&&(alert("Quiz created successfully!"),x("/teacher/quizzes"))}catch(t){console.error("Error creating quiz:",t),alert(t.message||"Failed to create quiz. Please try again.")}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen bg-white pb-20 sm:pb-24",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 pt-3 sm:pt-4 md:pt-6 pb-4 sm:pb-6 md:pb-8",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("button",{onClick:()=>x("/teacher/quizzes"),className:"p-1.5 sm:p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(R,{className:"text-white text-lg sm:text-xl md:text-2xl"})}),e.jsx("h1",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold",children:"Create New Quiz"})]})})}),e.jsx("div",{className:"px-3 sm:px-4 md:px-6 py-4 sm:py-5 md:py-6",children:e.jsxs("form",{onSubmit:L,className:"space-y-4 sm:space-y-5 md:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 md:gap-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Quiz Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:a.quizName,onChange:s=>d({...a,quizName:s.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all",placeholder:"Enter quiz name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Board ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:a.board,onChange:s=>{d({...a,board:s.target.value,class:"",subjectId:""})},disabled:p,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Board"}),q.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:a.class,onChange:s=>{d({...a,class:s.target.value,subjectId:""})},disabled:!a.board||p,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Class"}),z.map(s=>e.jsxs("option",{value:s,children:["Class ",s]},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Subject ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:a.subjectId,onChange:s=>d({...a,subjectId:s.target.value}),disabled:!a.class||p,className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Subject"}),D.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:a.status,onChange:s=>d({...a,status:s.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all bg-white",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2",children:"Deadline"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"date",value:a.deadlineDate,min:new Date().toISOString().split("T")[0],onChange:s=>d({...a,deadlineDate:s.target.value}),className:"flex-1 px-2 sm:px-3 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all"}),e.jsx("input",{type:"time",value:a.deadlineTime,onChange:s=>d({...a,deadlineTime:s.target.value}),className:"w-32 sm:w-36 px-2 sm:px-3 py-2 sm:py-2.5 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all"})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500 mt-1",children:"Optional: Set deadline for quiz submission (must be in the future)"})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-5 md:mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-900",children:["Questions (",o.length,")"]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500 mt-1",children:"Add questions with 4 options each and select the correct answer"})]}),e.jsxs("button",{type:"button",onClick:I,className:"px-3 sm:px-4 py-2 bg-[var(--app-dark-blue)] hover:bg-blue-800 text-white rounded-lg sm:rounded-xl font-semibold text-xs sm:text-sm transition-all flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Add Question"})]})]}),o.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 sm:p-8 md:p-10 border-2 border-dashed border-gray-300 text-center",children:[e.jsx("p",{className:"text-gray-500 font-medium text-xs sm:text-sm mb-1",children:"No questions added yet"}),e.jsx("p",{className:"text-gray-400 text-[10px] sm:text-xs",children:'Click "Add Question" to start adding questions'})]}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:o.map((s,t)=>e.jsxs("div",{className:"bg-white rounded-xl p-3 sm:p-4 md:p-5 border-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-xs sm:text-sm font-semibold text-gray-900",children:["Question ",t+1]}),o.length>1&&e.jsx("button",{type:"button",onClick:()=>Q(t),className:"p-1.5 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove Question",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5",children:["Question Text ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{required:!0,value:s.question,onChange:r=>E(t,"question",r.target.value),rows:"3",className:"w-full px-3 sm:px-4 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all resize-none",placeholder:"Enter your question here..."})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5",children:["Options ",e.jsx("span",{className:"text-red-500",children:"*"})]}),s.options.map((r,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correctAnswer-${t}`,checked:s.correctAnswer===l,onChange:()=>B(t,l),className:"w-4 h-4 text-[var(--app-dark-blue)] focus:ring-[var(--app-dark-blue)] cursor-pointer"}),e.jsx("input",{type:"text",required:!0,value:r,onChange:n=>P(t,l,n.target.value),className:"flex-1 px-3 sm:px-4 py-2 text-xs sm:text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[var(--app-dark-blue)] focus:border-[var(--app-dark-blue)] outline-none transition-all",placeholder:`Option ${l+1}`})]},l))]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500",children:"Select the radio button next to the correct answer"})]},t))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 pt-4 sm:pt-6",children:[e.jsx("button",{type:"button",onClick:()=>x("/teacher/quizzes"),className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm border-2 border-gray-300 text-gray-700 rounded-lg sm:rounded-xl font-semibold hover:bg-gray-50 transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w,className:"w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 text-xs sm:text-sm bg-[var(--app-dark-blue)] hover:bg-blue-800 text-white rounded-lg sm:rounded-xl font-semibold transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Creating...":"Create Quiz"})]})]})}),e.jsx(_,{})]})};export{G as default};
