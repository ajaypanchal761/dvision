import{u as F,a8 as E,r as n,j as e,c as _,aB as A,F as v,i as D,aC as L,aD as q,m as y}from"./index-BPKQ2keO.js";import{B as O}from"./BottomNav-BGePCkyK.js";import{l as N}from"./api-CVReUq8b.js";const R=()=>{const x=F(),l=E().state?.prefillData||null,[t,m]=n.useState({classId:l?.classId||"",subjectId:l?.subjectId||"",title:l?.title||"",description:l?.description||"",startTime:l?.startTime||"",endTime:l?.endTime||""}),[i,C]=n.useState({classes:[],subjects:[],boards:[],classSubjectCombinations:{}}),[I,g]=n.useState([]),[S,f]=n.useState(!0),[p,j]=n.useState(!1),[u,d]=n.useState("");n.useEffect(()=>{(async()=>{try{f(!0),d("");const a=await N.getAssignedOptions();a.success&&a.data?C({classes:a.data.classes||[],subjects:a.data.subjects||[],boards:a.data.boards||[],classSubjectCombinations:a.data.classSubjectCombinations||{}}):d("Failed to load assigned classes/subjects")}catch(a){console.error("Error fetching assigned options:",a),d(a.message||"Failed to load assigned classes/subjects")}finally{f(!1)}})()},[]);const[h,k]=n.useState(!1);n.useEffect(()=>{if(l&&!h&&i.classes.length>0&&i.subjects.length>0){const s=i.classes.some(r=>(r._id?.toString()||r._id)===(l.classId?.toString()||l.classId)),a=i.subjects.some(r=>(r._id?.toString()||r._id)===(l.subjectId?.toString()||l.subjectId));s&&a&&(m(r=>({...r,classId:l.classId?.toString()||l.classId,subjectId:l.subjectId?.toString()||l.subjectId,title:l.title||r.title,description:l.description||r.description,startTime:l.startTime||r.startTime,endTime:l.endTime||r.endTime})),k(!0))}},[l,i.classes.length,i.subjects.length]),n.useEffect(()=>{if(t.classId&&i.classSubjectCombinations){const s=i.classSubjectCombinations[t.classId]||[],a=i.subjects.filter(r=>{const o=r._id?.toString()||r._id;return s.includes(o)});if(g(a),!h){const r=t.classId;m(o=>o.classId&&o.classId!==r&&o.subjectId?{...o,subjectId:""}:o)}}else g([])},[t.classId,i.classSubjectCombinations,i.subjects]);const c=(s,a)=>{m(r=>({...r,[s]:a}))},b=()=>t.title.trim()!==""&&t.classId&&t.subjectId&&t.startTime&&t.endTime,w=async s=>{if(s.preventDefault(),!b()){d("Please fill in all required fields");return}try{j(!0),d("");const a=await N.createLiveClass(t.classId,t.subjectId,t.title.trim(),t.description.trim(),t.startTime,t.endTime);a.success?(x("/teacher/live-classes",{replace:!0}),window.location.reload()):d(a.message||"Failed to create live class")}catch(a){console.error("Error creating live class:",a),d(a.message||"Failed to create live class")}finally{j(!1)}},T=s=>s.type==="regular"?`Class ${s.class} - ${s.board}`:s.name||"Class";return e.jsxs("div",{className:"min-h-screen bg-white pb-20",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--app-dark-blue)] text-white relative",style:{borderRadius:"0 0 50% 50% / 0 0 30px 30px"},children:e.jsx("div",{className:"px-4 sm:px-6 pt-3 sm:pt-4 pb-4 sm:pb-5",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>x("/teacher/live-classes"),className:"p-1.5 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(_,{className:"text-lg sm:text-xl"})}),e.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl font-bold",children:"Create Live Class"})]})})}),e.jsx("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 py-3 sm:py-4",children:S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--app-dark-blue)]"})}):u&&i.classes.length===0?e.jsx("div",{className:"bg-red-50 border-2 border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm mb-4",children:u||"No assigned classes found. Please contact admin to assign classes."}):e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-bold text-xs mb-1",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2",children:e.jsx(A,{className:"text-[var(--app-dark-blue)] text-sm"})}),e.jsxs("select",{required:!0,value:t.classId,onChange:s=>c("classId",s.target.value),className:"w-full pl-9 pr-3 py-2 sm:py-2.5 border-2 border-gray-200 rounded-lg bg-white focus:outline-none focus:border-[var(--app-dark-blue)] focus:ring-2 focus:ring-[var(--app-dark-blue)]/20 transition-all text-sm font-medium appearance-none",children:[e.jsx("option",{value:"",children:"Select Class"}),i.classes.map(s=>e.jsx("option",{value:s._id,children:T(s)},s._id))]}),e.jsx("div",{className:"absolute right-2.5 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx(v,{className:"text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-bold text-xs mb-1",children:["Subject ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2",children:e.jsx(D,{className:"text-[var(--app-dark-blue)] text-sm"})}),e.jsxs("select",{required:!0,value:t.subjectId,onChange:s=>c("subjectId",s.target.value),disabled:!t.classId,className:"w-full pl-9 pr-3 py-2 sm:py-2.5 border-2 border-gray-200 rounded-lg bg-white focus:outline-none focus:border-[var(--app-dark-blue)] focus:ring-2 focus:ring-[var(--app-dark-blue)]/20 transition-all text-sm font-medium appearance-none disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:t.classId?"Select Subject":"Select Class first"}),I.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]}),e.jsx("div",{className:"absolute right-2.5 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx(v,{className:"text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-bold text-xs mb-1",children:["Class Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2",children:e.jsx(L,{className:"text-[var(--app-dark-blue)] text-sm"})}),e.jsx("input",{type:"text",required:!0,placeholder:"Enter class title",value:t.title,onChange:s=>c("title",s.target.value),className:"w-full pl-9 pr-3 py-2 sm:py-2.5 border-2 border-gray-200 rounded-lg bg-white focus:outline-none focus:border-[var(--app-dark-blue)] focus:ring-2 focus:ring-[var(--app-dark-blue)]/20 transition-all text-sm font-medium"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-bold text-xs mb-1",children:"Description (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2.5 top-2.5",children:e.jsx(q,{className:"text-[var(--app-dark-blue)] text-sm"})}),e.jsx("textarea",{placeholder:"Enter class description",value:t.description,onChange:s=>c("description",s.target.value),rows:3,className:"w-full pl-9 pr-3 py-2 sm:py-2.5 border-2 border-gray-200 rounded-lg bg-white focus:outline-none focus:border-[var(--app-dark-blue)] focus:ring-2 focus:ring-[var(--app-dark-blue)]/20 transition-all text-sm resize-none font-medium"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-bold text-xs mb-1",children:["Start Time ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2",children:e.jsx(y,{className:"text-[var(--app-dark-blue)] text-sm"})}),e.jsx("input",{type:"time",required:!0,value:t.startTime,onChange:s=>c("startTime",s.target.value),className:"w-full pl-9 pr-3 py-2 sm:py-2.5 border-2 border-gray-200 rounded-lg bg-white focus:outline-none focus:border-[var(--app-dark-blue)] focus:ring-2 focus:ring-[var(--app-dark-blue)]/20 transition-all text-sm font-medium"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-bold text-xs mb-1",children:["End Time ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2",children:e.jsx(y,{className:"text-[var(--app-dark-blue)] text-sm"})}),e.jsx("input",{type:"time",required:!0,value:t.endTime,onChange:s=>c("endTime",s.target.value),min:t.startTime||void 0,className:"w-full pl-9 pr-3 py-2 sm:py-2.5 border-2 border-gray-200 rounded-lg bg-white focus:outline-none focus:border-[var(--app-dark-blue)] focus:ring-2 focus:ring-[var(--app-dark-blue)]/20 transition-all text-sm font-medium"})]})]})]}),u&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:u}),e.jsx("button",{type:"submit",disabled:!b()||p,className:`w-full bg-[var(--app-dark-blue)] text-white py-2.5 sm:py-3 rounded-lg font-bold text-sm transition-colors shadow-lg ${b()&&!p?"hover:bg-[var(--app-dark-blue)]/90 cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:p?"Creating...":"Create Live Class"})]})}),e.jsx(O,{})]})};export{R as default};
